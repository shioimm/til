# 基礎
## 概念
### ACID特性
- 参照: [ACID (コンピュータ科学)](https://ja.wikipedia.org/wiki/ACID_(%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E7%A7%91%E5%AD%A6))
- トランザクション処理に必要とされる特性
  - Atomicity(原子性)
    - トランザクションに含まれるタスクが全て実行されるか、あるいは全く実行されないこと
  - Consistency(一貫性)
    - トランザクション開始時と終了時においてデータに矛盾を生じないこと
  - Isolation(隔離性)
    - トランザクション中の処理が他のトランザクションから隠蔽されており、互いに干渉しないこと
  - Durability(耐久性)
    - 正常終了したトランザクションの処理結果は永続化され、失われないこと

### レプリケーション
- 参照: [レプリケーション](https://ja.wikipedia.org/wiki/%E3%83%AC%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3)
- 参照: [第10回　レプリケーションについて(その1)](https://oss-db.jp/dojo/dojo_10)
- 参照: [第11回　レプリケーションについて(その2)](https://oss-db.jp/dojo/dojo_11)

#### TL;DR
- 冗長なリソース間で一貫性を保ちながら情報を共有する機能
- 次の目的などのために行われる
  - 負荷分散
  - 可用性の向上
    - プライマリ - 通常利用している方のDB
    - スタンバイ - 複製の方のDB(コールドスタンバイ、ウォームスタンバイ、ホットスタンバイ)

#### データ更新
- シングルマスタレプリケーション
  - 一つの更新可能なDB(マスタ)とそれ以外の複製されたDB(スレーブ)によって構成される
  - データ更新時、アプリケーションは必ずマスタにアクセスする
  - データ参照時、アプリケーションはデータを更新できないスレーブにアクセスする(べき)(負荷分散のため)
- マルチマスタレプリケーション
  - 複数、あるいはすべての更新可能なDB群によって構成される
  - データ更新時、アプリケーションはどのDBにアクセスしても良い
  - データの同時更新に対処するため、DB側で対処が必要

#### シングルマスタレプリケーションにおける同期 / 非同期処理
- 同期レプリケーション
  - マスタのデータ更新がスレーブに反映されるまでマスタが待つ
  - 更新性能が下がるがマスタ・スレーブ間でデータの同期が保持される
- 非同期レプリケーション
  - マスタのデータ更新がスレーブに反映されるまでマスタが待たない
  - マスタの更新内容は速やかにスレーブに反映される
  - タイミングによってマスタとスレーブでデータの内容が異なる
  - マスタがデータ更新の直後にダウンした場合、データ更新が失われる可能性がある

#### マスタからスレーブへのデータ転送方式
- データの転送
  - マスタからスレーブへ更新後の行データを転送する
  - 転送されるデータのサイズが大きくる
  - 確実に同じデータが転送される
- SQLの転送
  - マスタからスレーブへ更新用のSQLを転送する
  - 転送されるデータサイズが小さい
  - SQLの内容によってはサーバによって結果が異なる

### シャーディング
- [シャーディングとは、テーブルシャーディングという可能性【水平分割】](https://pecopla.net/web-column/db-shard)

#### TL;DR
- 一つのDBを複数に分割し、分散して管理・運用を行うこと(水平分割)
  - 複数のDBに同じテーブルを用意し、一つのテーブルに保存していたレコードを分散させる
- 負荷分散を目的に用いられる
  - テーブルに格納される全体のレコード数を減少させることにより処理速度を向上させる
  - サーバーを分けることによりCPUやメモリにかかる負荷を減少させる

#### レコードの分散戦略
- プライマリキーのid等を分割するDBの数で割り、余りの値を基準にデータを格納するDataBaseを決めるなど

#### デメリット
- 他テーブルとのJOINが難しい
- シャーディングの分割対象にした値以外での検索が難しくなる

#### テーブルシャーディング
- 同じDB内で同じカラム構成を持つ複数のテーブルを用意し、
  分散の対象の値をテーブル名に入れることによって一テーブル内のデータ量を分散する
