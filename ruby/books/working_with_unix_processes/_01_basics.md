# なるほどUNIXプロセス まとめ01
- Jesse Storimer 著
- 島田浩二・角谷信太郎 翻訳

## Chapter2
- Unixシステム
  - カーネル
    - ハードウェアを制御する
    - ユーザーはシステムコールによってカーネルの操作を行う
  - ユーザーランド
    - ユーザーの書いたプログラムの実行場所
  - システムコール
    - カーネルとユーザーランドの取次を行う
```
コマンドのセクションカテゴリ
- セクション1 誰もが実行できるユーザーコマンド
- セクション2 システムコール(カーネルが提供する関数)
- セクション3 サブルーチン(Cライブラリ関数)
- セクション4 デバイス(/dev ディレクトリのスペシャルファイル)
```

- あらゆるコードはプロセス上で実行される
  - コマンドラインからrubyを起動すると、コードを実行するためのプロセスが生まれる
  - コードを実行し終わったら、プロセスは終了する

## Chapter3
- プロセスは識別子(プロセスID = pid)を持っている

```
現在実行されているプロセスのpid

Process.#pid <-> getpid(2)
```

## Chapter4
- すべてのプロセスには親がいる
  - 親プロセスのプロセスIDはppid

```
現在実行されているプロセスのppid

Process.#ppid <-> getppid(2)
```

## Chapter5
### ファイルディスクリプタ
- Unixの世界では「全てがファイル」
  - デバイス、ソケット、パイプetc
    - 総称的な意味でのファイル -> リソース
    - 一般的な意味でのファイル -> ファイル
- 実行中のプロセスでリソースを開くと、ファイルディスクリプタ番号が割り当てられる
  - ファイルディスクリプタは関連しないプロセス間では共有できない
  - プロセスが終了するとファイルディスクリプタも終了する
- Rubyでは開いたリソースはIOオブジェクト
  - IOオブジェクトはファイルディスクリプタ番号を知っている

```
開いているリソースのファイルディスクリプタ番号

IO#fileno
```

- ファイルディスクリプタ番号は、開かれているリソースに対して、未使用の整数が昇順に割り当てられる
- リソースが閉じられると、閉じたリソースに割り当てられていたファイルディスクリプタ番号が再利用できるようになる
  - カーネルは開かれているリソースにだけファイルディスクリプタ番号を割り当てて管理する

#### 標準ストリームのファイルディスクリプタ
- 標準入力(STDIN) -> 0
- 標準出力(STDOUT) -> 1
- 標準エラー出力(ETDERR) -> 2

## Chapter6
- 1プロセスが持てるファイルディスクリプタ数には制限がある
  - ソフトリミット -> 変更可能な制限数
    - 制限を超えるとErrno::EMFILE例外が創出される
  - ハードリミット -> 変更権限を持ったユーザーのみ変更可能な制限数

```
ファイルディスクリプタのソフトリミット
Process.getlimit <-> getlimit(2)

ファイルディスクリプタのソフトリミットを引き上げる
Process.setlimit <-> setlimit(2)
```

- ソフトリミットを越えると`Errno::EMFILE`が送出される

#### その他のリソースの制限
```
プロセスのユーザーが持てる最大プロセス数
Process.getrlimit(:NPROC)

プロセスが作成できるファイルサイズの最大値
Process.getrlimit(:FSIZE)

プロセススタックの最大サイズ
Process.getrlimit(:STACK)
```
