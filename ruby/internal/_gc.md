# GC
#### 特徴
- 基本アルゴリズムはマークアンドスイープ
- 保守的
- 世代別にGCを行う
- インクリメンタルにGCを行う

## 実行タイミング
- 新しいオブジェクトを生成しようとしたが、空いているスロットがなかった
- `malloc()`によるメモリ確保が一定量を超えた
- `GC.start`や`GC.stress`による強制起動

## 動作
- R~構造体として割り当てられる領域が枯渇した際、
  `gc_start()`関数が呼ばれ、マークフェーズおよびスイープフェーズを開始する

#### スロット
- R~構造体のメモリ領域

#### ページ
- スロットをまとめた領域
- メモリの確保や解放を行う単位
- `heap_page_body`構造体 / `heap_page`構造体の組みによって表現される

```c
// 16KB固定長
// 400スロットのR~構造体 (400オブジェクト) を格納できる

struct heap_page_body {
  struct heap_page_header header; // heap_pageへのアドレス
  /* char gap[];      */
  /* RVALUE values[]; */
};
```

```c
// ページの管理情報
// heap_page同士は双方向連結リストになっている

struct heap_page {
  // ページにおける先頭スロットのアドレス
  // 空きスロットリストへのポインタ
  // マーク ビットなどのビットマップ etc
};
```

#### ヒープ領域
- ページの集合・GCの管理領域

## 参照
- Rubyのウラガワ ── Rubyインタプリタに学ぶデータ構造とアルゴリズム
  - RubyのGCの基礎 GCのデータ構造とアルゴリズム
