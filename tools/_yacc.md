# yacc
- パーサジェネレータ
- 文法ファイルから構文規則を入力し、それに基づくLALR構文解析器になるCのソースプログラムを出力する
- 文法ファイルはBNF (Backus-Naur Form) によって記述する
- yaccで作ったパーサはLALR機能を持つ
  - シフトや還元をする前に次の記号を見てどうするかを判断する
- bison = GNUのyacc

#### 終端記号
- スキャナから送られてくる記号

#### 非終端記号
- スキャナから送られて来ず、パーサの中でしか使用されない記号

## 動作フロー
1. 文法ファイル (`*`.y) をyaccにかけ、構文解析器ソースプログラム (y.tab.c) を出力する
    - `$ yacc FILENAME.y`
    - 出力したプログラムはLALR解析テーブルおよびドライバルーチンを含む
2. 構文解析器ソースプログラムをgccでコンパイルし、実行ファイルを生成する
    - Lexも利用している場合はLexの出力ファイル (lex.yy.c）もコンパイラに与える
3. 生成されたファイルの実行時に標準入力から変換するファイルを読み込むと、
   ソースプログラムがスキャナの入力バッファに格納される
    - `yylex()`関数 - スキャナとして動作する
4. 入力バッファに格納されたデータは1バイトずつトークンバッファに読み込まれる
    - トークンバッファはトークンが一つ切り出せるまで文字列を保管する
5. トークンバッファに読み込まれたデータからトークン (記号とその値) ごとに
   パーサ内のスタック (セマンティックスタック) にプッシュ (シフト) される
    - シフトされた記号は随時定義した文法によって還元される
    - 記号の値はyylvalグローバル変数によって`yyparse()`関数に渡される
    - 記号の値の型はYYSTYPE型 (`%union`命令で指定した共用体のtypedef)
    - `yyparse()`関数 - セマンティックスタックにプッシュされた記号の還元を行う
4. 還元にフックして文法規則ごとに定義してあるアクションが実行され、アクションによって構文木が作られる
    - アクションの実行時には文法規則に対応する記号の値がアクションに渡される

## 文法ファイル
#### 定義部
- マクロ定義
- アクションで使用する関数と変数の宣言
- `%union` - 各記号の値の型を表す共用体の宣言
- `%token` - 終端記号とその型の宣言
- `%type` - 非終端記号とその型の宣言

#### 規則部
- どんな文法をパースしたいかを記述する
  - 見ための解析のために必要な文法
  - アクションの実行に必要なもの
- 規則部に記述した文法は`yyparse()`関数 (構文木を作るパーサ関数) に変換される

#### ユーザ定義部
- yaccに解釈をさせず、そのまま実行したい処理を記述する

## 文法ファイルに頻出の単語

| 意味             | 例                                       |
| -                | -                                        |
| プログラム全体   | program, prog, file, input, stmts, whole |
| 文 (構文木の幹)  | stmt, statement                          |
| 式 (構文木の枝)  | expr, expression                         |
| 項 (構文木の葉)  | prim, primary                            |
| 代入の左辺       | lhs (left hand side)                     |
| 代入の右辺       | rhs (right hand side)                    |
| 関数呼び出し     | funcall, call, function                  |
| メソッド呼び出し | method, call                             |
| 引数             | arg, argument                            |
| 関数定義         | defun, definition, function, fndef       |
| 宣言一般         | declaration, decl                        |
| ( )              | paren, parentheses                       |
| { }              | braces                                   |
| [ ]              | brackets                                 |
| 文を終端する記号 | terms, terminators                       |
| 省略可能         | opt, optional                            |

## 参照
- [yacc](https://ja.wikipedia.org/wiki/Yacc)
- [第9章 速習yacc](https://i.loveruby.net/ja/rhg/book/yacc.html)
- [第10章 パーサ](https://i.loveruby.net/ja/rhg/book/parser.html)
