# Amazon ECS
- Amazon Elastic Container Service
- AWS独自のコンテナオーケストレーションサービス
  - Dockerを使った計算機クラスターをAWS上に作成する
- コンテナの管理・運用を自動化できる
- マシンやOSなどの基盤をAWSが管理・運用する
- ユーザーがクラスタのスケーリングやタスク配置戦略を設定すると、
  ECSは自動的にスケーリングを行いながらユーザーが投入した計算ジョブを実行する
- クラスタのスケーリングによって対象のジョブを実行するのにちょうど十分なだけのインスタンスが起動し、
  ジョブが完了した後は不要なインスタンスはすべて停止される
- プラットフォームとしてKubernetesを使用する場合はEKSを利用する

## ECSが行う仕事

### Dockerイメージのダウンロード
- タスクで指定されたDockerイメージを外部レジストリからダウンロードする
  - 外部レジストリとしてDocker HubやECR(Elastic Container Registry: AWSのDockerレジストリ)を指定できる

### タスクの配置の管理
- ユーザーのタスク配置戦略に従ってあらかじめ定義されたクラスター内で適切な仮想インスタンスを選び出す
  - タスク配置戦略 - コンテナがどのインスタンスで起動され、スケーリング時にどのように増減するのか
  - 仮想インスタンスにDockerイメージを配置することにより、指定された計算タスクが開始される

### クラスターのスケーリング
#### 起動タイプ: Fargate
- タスクの配置の管理が不要
- コンテナイメージを指定するだけで簡単にコンテナを起動できる
- コンテナを起動していなければ料金は発生しない

#### 起動タイプ: EC2
- タスクの配置の管理が必要
- ノードのネットワーク構成などを細かく設定できる
- コンテナを起動していなくてもインスタンスを起動していれば料金が発生

## ECSの構造
- サービスが複数のタスクを含み、タスクが最大10個のコンテナを含む3層構造

#### サービス
- Kubernetesにおけるレプリカセットとデプロイメントの役割を兼ねる
- タスクのローリングアップデートや死活監視を行う
- サービスの仕様はJSON形式のテキストファイルへ宣言的に記述する(サービス定義)

#### タスク
- Kubernetesにおけるポッドの役割を担う
- タスクに含まれるコンテナは、同じタスクに含まれる他のコンテナとライフサイクルを共有する
- localhostを宛先にするとタスク内のコンテナ同士で通信が可能
- タスクごとにAWSのネットワークインターフェース(Elastic Network Interface)が割り当てられる
- タスクの仕様はJSON形式のテキストファイルへ宣言的に記述する(タスク定義)

## 利点
- インフラストラクチャの管理・運用をAWSに任せることができる
- ユーザーはアプリケーション開発など本質的な仕事に集中できる
- AWSの他のサービスと統合されており、サービス同士の連携が容易
  - Amazon EC2 - サーバー仮想化サービス
  - AWS Fargate - サーバーレスなコンテナ実行環境サービス
  - AWS IAM - アクセス管理
  - Amazon Route 53 - DNSサービス
  - Amazon CloudWatch - モニタリングサービス
  - AWS CodePipeline - 自動ビルドサービス
  - AWS CodeDeploy - 自動デプロイサービス

## 欠点
- インフラストラクチャの管理・運用の権限をAWSが持つため、
  情報セキュリティマネジメントなどの要件によってはデメリットになる
- AWSに依存することでマルチクラウドへの展開が困難化する

## 参照
- 仮想化&コンテナがこれ1冊でしっかりわかる教科書
- [7. Docker 入門](https://tomomano.github.io/learn-aws-by-coding/#sec_docker_introduction)
