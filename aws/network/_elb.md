# Elastic Load Balancing
- 複数のターゲットに渡る着信トラフィックを分配するロードバランサ
  - ALB (Application Load Balancer) - リクエストレベル (HTTP / HTTPS)
  - NLB (Network Load Balancer) - 接続レベル (TCP / UDP)
  - CLB (Classic Load Balancer)
- ELBはVPC内に仮想的に配置される

## 機能
- ヘルスチェック - ロードバランシング先に対して死活監視を行い、正常実行されているターゲットへルーティングする
- リクエストモニタリング - CloudWatchを利用して正常/異常リクエストの記録・モニタリングする
- SSL/TLSターミネーション - SSL/TLSを使った暗号化・復号を実施する
- Connection Drain - ロードバランサ終了時に残ったリクエストのために猶予時間を儲けて終了する
- スティッキーセッション - 小内jクライアントからのリクエストを固定ターゲットに振り分ける
- WebSocket対応

## 利用方法
1. 種類・利用するVPC・ゾーン・アタッチするセキュリティグループを指定する
2. AWSがそれぞれ指定されたゾーンにELBのノードを起動する
3. ELBの作成時に発行された接続先のエンドポイント (ドメイン名・ポート番号) を、
   本来利用したいドメインのCNAMEレコードとしてDNSに設定する

## ALB
- リバースプロキシ型 (応答通信もロードバランサを介して行われる) のロードバランサ
- リスナーを作成し、使用するプロトコルとポートを設定してルーティングルールを設定する
  - リスナー - どのような通信 (プロトコル・ポート番号) をターゲットへ転送するか指定するためのコンポーネント
- ルーティングオプションを設定することで柔軟にリクエストごとの挙動を制御できる
- AWS CognitoやOIDC IDプロバイダと連携するユーザー認証をサポート
- フォワード先にLambdaを選択することも可能

## NLB
- リスナーを作成し、使用するプロトコルとポートを設定してルーティングルールを設定する

## Usage
1. EC2ダッシュボード
  -> ロードバランサー
  -> ロードバランサーの作成 (-> 種類の選択)
2. ロードバランサーの設定
    - 全てのAZにチェック
3. セキュリティ設定の構成 -> セキュリティグループの設定
4. ルーティングの設定
    - ターゲットグループ - ロードバランサーの分散先となるサーバーのグループ
5. ターゲットの登録
    - インスタンスの選択 -> 登録済みに追加
6. 確認
7. ヘルスチェック
    - EC2ダッシュボード
    -> ターゲットグループ
    -> ターゲット
    -> ステータス
8. Route53でElasticIPを直接指定している箇所を修正
    - Alias - Alias Targetにロードバランサーを指定

## 参照
- [Elastic Load Balancing](https://aws.amazon.com/jp/elasticloadbalancing/)
- AWSをはじめよう　～AWSによる環境構築を1から10まで～
- サーバ・インフラエンジニアの基本がこれ一冊でしっかり身につく本 9.3
- AWSの知識地図〜現場必修の基礎から構築・セキュリティまで 2.3
- AWSの基本・仕組み・重要用語が全部わかる教科書 03-03
