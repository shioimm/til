# VPC (Amazon Virtual Private Cloud)
- AWS内に仮想的なネットワーク空間を構築する (= リージョン内にユーザー専用の論理空間を作成する) サービス
- VPCで構築した仮想プライベートネットワーク上のIPアドレスをEC2やRDSなどのAWSリソースに割り当て、
  これらのAWSリソースが仮想的にそのアドレスに存在するように配置する
- あるVPCおよびサブネットは、ネットワークを細分化したセグメントに相当する
- あるVPCは他のVPCや外部のネットワークと通信することが可能

## サブネット
- VPCは複数のAZを跨いで構築できるが、サブネットはAZごとに作成する必要がある
- ネットワークノードであるAWSリソースはサブネット上に配置される
- サブネットごとの接続制御はネットワークACLの設定によって行う
- ノードごとの接続制御はセキュリティグループ (FW) の設定によって行う

#### パブリックサブネット
- インターネットゲートウェイへのルーティングを設定したサブネット
  (デフォルトルートがインターネットゲートウェイ)
- SSHで外部からログイン可能

#### プライベートサブネット
- インターネットゲートウェイへのルーティングを設定しないサブネット
  (デフォルトルートがインターネットゲートウェイ以外)

## 外部通信
#### インターネットゲートウェイ
- VPC内からインターネットへの通信を行うためのゲートウェイ
- VPC -> インターネット / VPC <- インターネット
- ネットワークノードに振られたプライベートIPアドレスとパブリックIPアドレスを1:1で紐づけ、
  外部のインターネットとVPC間の通信を中継する

#### NATゲートウェイ
- プライベートサブネット内でインターネットへの通信を行う場合に
  パブリックサブネットへ設置する中継用ゲートウェイ
- プライベートサブネット -> インターネット
- 送信元ノードのIPアドレスをNATゲートウェイのIPアドレスに置き換えて通信を行う
- AZ上に構築し、パブリックサブネットに配置される
- 設置は有料

#### 仮想プライベートゲートウェイ
- VPCとオンプレミス環境を接続するために作成されるゲートウェイ

#### カスタマーゲートウェイ
- 仮想プライベートゲートウェイの利用時にオンプレミス側に配置するゲートウェイ

#### VPCピアリング接続
- 独立したVPC同士を接続 (ピアリング) し、プライベートアドレスを使用して相互に通信する

#### VPCエンドポイント
- VPCからAWSリソースへアクセスするためのサービス
- 同じVPC・サブネット内に構築されていない (リージョン単位で提供される) S3、DynamoDBなどのリソースに
  アクセスする際、通常はインターネット経由での接続が必要
- インターネットを経由せずにアクセスを行う場合はAWSリソース側にVPCエンドポイントの設置が必要

#### トランジットゲートウェイ
- VPC間の接続を統合し、接続設定を一元管理するための集約型のネットワーク管理サービス

## ルートテーブル
- サブネット内からゲートウェイまでのルーティングをCIDR表記で定義するためのテーブル
- VPC内のサブネットは何らかのルートテーブルに関連づけられる必要がある
  - 明示的な指定がない場合はメインルートテーブルに関連づけられる
- ルートテーブルをサブネットにアタッチすることによりゲートウェイを利用できるようになる

## アクセス制御
#### セキュリティグループ
- アクセスを許可するソース・プロトコル・ポートなどのルール単位で通信を制御する機能
- 発生した通信に対する応答通信には許可は不要

#### ネットワークACL
- サブネットレベルで通信を制御する機能
- 発生した通信に対する応答通信にも許可が必要

## VPCフローログ
- VPC内のネットワークトラフィックをキャプチャする機能
  - ENIのID、送信元・送信先IPアドレス、ポート番号、パケット数やバイト数を記録する
  - 記録した情報はS3やCloudWatch Logsに保存できる

## 参照
- AWSの知識地図〜現場必修の基礎から構築・セキュリティまで 2.2
- AWSの基本・仕組み・重要用語が全部わかる教科書 03-01, 20-04
