# SQS (Simple Queue Service)
- フルマネージド型の分散メッセージキューサービス
- Producer (メッセージの送信元) とConsumer (メッセージの取得者) の間をキューが仲介し、両者を疎に結合する
  - Producerが生成したメッセージがキューに送信された後、Consumerは自らメッセージを取得する
  - 複数のAZにキューを構成可能
  - キューに対するアクセス制御・KMSを利用した保管データの暗号化が可能

## 構成要素
### Producer
- メッセージをキューに送信するアプリケーション
  - EC2、Fargate、Lambda、SNSなどにAWS SDKやAPIを用いてメッセージを送信するアプリケーションを実装するなど

### Consumer
- メッセージをキューから取得するアプリケーション
  - EC2、Fargate、LambdaなどにAWS SDKやAPIを用いてメッセージを取得するアプリケーションを実装するなど

#### キューからのメッセージ取得
1. Consumerからキューに対するポーリング (キューイング状態の監視) を行う
    - ショートポーリング (一部サーバーを確認・APIコール回数多)
    - ロングポーリング (全サーバーを確認・APIコール回数少)
    - 遅延キュー / メッセージタイマー - Consumerがメッセージを取得可能になるまでの時間を遅延させる機能
    - 可視性タイムアウト - Consumerによるメッセージ取得後、他のConsumerによるメッセージ取得の待ち時間設定
2. Consumerがメッセージを取得して処理を行う
3. Consumerが処理済みメッセージをキューから削除
    - デッドレターキュー - 正常に処理できないメッセージがキューに滞留し続けることを防止する機能

### キュー
- Producerから送信されたメッセージを保管する
- デフォルトで4日間、最大14日間補完可能

## キューの種類

|              | スタンダード (At least Once)            | FIFO (順序保持・Exactly-Once)  |
| -            | -                                       | -                              |
| 配信順序     | 順序性は保証されない                    | 順序性が保証される             |
| 配信方式     | 少なくとも1回 (2回以上の配信可能性あり) | 1回のみ                        |
| スループット | ほぼ無制限                              | 最大300件/秒のメッセージを処理 |

- スタンダードキューはConsumer側でスタンダードキューの特徴を考慮した処理を設計する必要あり
  - 冪等性の担保
  - DynamoDBで処理済みフラグを持つ

## 参照
- サーバ・インフラエンジニアの基本がこれ一冊でしっかり身につく本 9.3
- AWSの基本・仕組み・重要用語が全部わかる教科書 07-02
