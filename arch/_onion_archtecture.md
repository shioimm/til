# オニオンアーキテクチャ
- レイヤードアーキテクチャのインフラ層とドメイン層の依存関係を逆転させる

#### 依存関係の方向
- アプリケーション (ユースケース) とその外側には境界があり、アダプタを通じて通信する
- 依存関係は外側の層から内側の層のみ許可する
  - ブラウザ、ネイティブアプリ -> アダプタ (プレゼンテーション層) -> ユースケース層 -> ドメイン層
  - DB、ファイル、外部サービス -> アダプタ (インフラ層) -> ユースケース層 -> ドメイン層
  - 結合テスト -> アダプタ (テスト層) -> ユースケース層 -> ドメイン層

#### リクエストの方向
- ブラウザ、ネイティブアプリ -> アダプタ (プレゼンテーション層) -> アプリケーション
- アプリケーション -> アダプタ (インフラ層) -> DB、ファイル、外部サービス
- 結合テスト -> アダプタ (テスト層) -> アプリケーション

## レイヤ
#### プレゼンテーション層
- クライアントとの入出力
  - エンドポイント定義
  - HTTPリクエストで渡された値をユースケース層に渡す
  - 入力値のバリデーション

#### ユースケース層 (アプリケーション層)
- ドメイン層が公開している操作を組み合わせてユースケースを実現
  - プレゼンテーション層からの入力
  - ドメインオブジェクトの生成・使用・永続化依頼
  - プレゼンテーション層への出力の定義
- 特定のクライアントへ依存しない
- 1クラス1パブリックメソッド

#### ドメイン層
- ドメイン知識の表現
  - ドメインオブジェクト
    - エンティティ - 同一判定を識別子で行うもの
    - 値オブジェクト - 同一判定を値で行うもの
    - ドメインイベント
  - ドメインオブジェクトを利用するもの
    - ドメインサービス - 個別のドメインオブジェクトそのもの以外を表現するもの
    - リポジトリ - 集約単位で永続化層へのアクセスを提供するインターフェース
    - ファクトリ - オブジェクトの生成を担うもの
- 他の層へ依存しない
- 整合性が保証できるメソッドのみ他の層に公開

#### インフラ層
- ユースケース層・ドメイン層で定義されているインターフェイスの実際の実装
  - ドメインオブジェクトの永続化・検索

## 参照
- ドメイン駆動設計 モデリング実践ガイド
