# 並列プログラムの基礎
#### 並列プログラムの書き順
1. 問題を最も自然に表す並列パラダイムを選ぶ
2. そのパラダイムに最も合った手法でプログラムを書く
3. 出来上がったプログラムが効率的でない場合はより効率の良い手法へプログラムを変換する

## 並列パラダイム
#### 結果並列法
- プログラムの実行結果をその構成要素別に分類し、それぞれの要素を作る作業ごとに作業者を割り当てる
- 各作業は他の作業の終了を待ち合わせることが必要になる時点まで並列に実行する
- 各構成要素の作成が終了し次第構成要素を組み立てて結果を得る

```ruby
[1, 2, 3].map do |n|
  Thread.new(n) { |n| n * 2 }.value
end
# => [2, 4, 6]
```

#### 専門家並列法
- それぞれ特定の仕事を割り当てた作業者によって作業の流れを分割し、パイプライン的に並列に作業を進める

|               | 作業者1 | 作業者2  | 作業者3  | 作業者4 | 作業者5  | 作業の完了 |
| -             | -       | -        | -        | -       | -        | -          |
| 家1の作業進捗 | 測量    | 土を掘る | 基礎作り | 大工    | 屋根葺き | OK         |
| 家2の作業進捗 | 測量    | 土を掘る | 基礎作り | 大工    |          |            |
| 家3の作業進捗 | 測量    | 土を掘る | 基礎作り |         |          |            |
| 家4の作業進捗 | 測量    | 土を掘る |          |         |          |            |
| 家5の作業進捗 | 測量    |          |          |         |          |            |

#### 手順並列法
- 必要な作業をリストアップし、その中からひとつを選んでは作業者に割り当て作業者をその作業に従事させる
- リストアップされた作業全体が終了するまで繰り返す
- e.g. マスターワーカーパラダイム

#### 専門家並列法 + 手順並列法
- それぞれ特定の仕事を割り当てた作業者のグループを用意する
- 作業の流れの中の各段階で必要な作業をリストアップし、
  その中からひとつを選んでは作業者のグループのうち一人に割り当てる

## 並列プログラミング手法
### ライブデータ構造体 (live data structure) (プロセスがデータ構造体に融合する)
- 結果として得られるデータ構造体の形で並列プロセスを生成する
- プロセスの計算が終わった時点でこれをデータ構造体として扱えるようになる
- 他のプロセスが生成する値が必要になった場合、そのプロセスを内包しているデータ構造体の値を読む

### メッセージパッシング (データ構造体がプロセスに内包される)
- たくさんの並列プロセスを生成し、それぞれのデータ構造体をどれかのプロセスに内包させる
- プロセスはsend-receive命令を持ち、プロセス同士はメッセージの交換によって通信する
- バッファがあると便利

### 分散データ構造体 (distributed data structure)
- 並列プロセスとデータ構造体は独立しており、各プロセスは同じデータ構造体を共用して値を読み書きする

#### 分散データ構造の種類
- Bag
  - 自身に含まれる要素が全て同じまたは区別できない集合構造
  - 同じ要素を複数持つことができ、要素に順序が無い
  - タプルスペースで表現できる最も自然なデータ構造
  - 要素の追加 (out操作) ・削除 (in操作) を行うことができる
- Struct, Hash
  - 要素に名前が存在する構造体
  - `名前と値`を組みにしたタプルによって表現する
  - 同じ名前のタプルをin -> outすることによって当該タプルの値を更新することが可能
- Array, Stream
  - 要素に順序や位置が存在する構造体 (行列、配列、ストリーム)
  - `位置と値`を組みにしたタプルによって表現する
    - inストリーム - 読み出した要素が消費される (Queueのイメージ)
    - rdストリーム - 読み出した要素が消費されない

## 参考
- 並列プログラムの作り方
