# 状態遷移についての理解 (7)
- selectが複数の値を返すケースを考慮する

```
扱うリソース
- Resolved addrinfos
- Connecting sockets
- Hostname resolution queue # TODO キューである必要性があるかどうかを考える
- Resolution waiting pipe

---

Thread.new { IPv6 Addrinfo.getaddrinfo }
Thread.new { IPv4 Addrinfo.getaddrinfo }

loop do
  select(Resolution waiting pipe, Connecting sockets, Ends at)

  if イベント発生: Writable sockets: any
    # ...
  end

  if イベント発生: Hostname resolution queue: any
    # TODO 空になるまで取得が必要
    Resolved family, Resolved addrinfos = Hostname resolution queue.pop
    Resolved addrinfos.add(Resolved family, Resolved addrinfos)

    if (Resolved family: IPv4) && !(Resolved addrinfos: resolved IPv6)
      Ends at = now + Resolution Delay
      # この場合はこのループでは接続試行を開始しない
    end
  end

  if (Ends at: 現在時刻を超過) && (Resolved addrinfos: any)
    # ...
  end
end
```
