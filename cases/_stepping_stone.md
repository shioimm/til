# 踏み台サーバー
- 目的のサーバーにログインする際に別のサーバーを中継する

```
クライアント -> | -> 踏み台サーバー -> 対象ホスト
```

#### 踏み台サーバーをトンネルして対象ホストに接続するケース

```
$ ssh -L <ローカルで使用するポート>:<対象ホストのアドレス>:<対象ホストのポート> <踏み台サーバーのユーザー名>@<踏み台サーバーのアドレス>
```

```
$ ssh -vvv -L 9999:***.ap-northeast-1.rds.amazonaws.com:5432 misaki-shioi@***-***.aws.***.jp
$ psql -U *** -h localhost -p 9999 -d ***
```

#### 踏み台サーバーを介して対象ホストに多段SSHする場合

```
$ scp -i path/to/<踏み台サーバーの鍵ファイル> -p path/to/<対象ホストの鍵ファイル> <踏み台サーバーのユーザー名>@<踏み台サーバーのアドレス>:~/.ssh/
$ ssh -A <踏み台サーバーのユーザー名>@<踏み台サーバーのアドレス>
$ chmod 400 ~/.ssh/<対象ホストの鍵ファイル>
$ ssh -i ~/.ssh/<対象ホストの鍵ファイル> <対象ホストのユーザー名>@<対象ホストのプライベートIPアドレス>
```

```
$ scp -i ~/.ssh/id_rsa -p ~/***.pem misaki-shioi@***-***.aws.***.jp:~/.ssh/
$ ssh -A misaki-shioi@***-***.aws.***.jp
$ chmod 400 ~/.ssh/***.pem
$ ssh -i ~/.ssh/***.pem ***@****.****.****.****

# 対象サーバーのDockerコンテナの中に入る
$ docker ps
$ docker exec -it *** /bin/sh
$ # 操作したいコマンドを実行
```

## 参照
- [楽しいトンネルの掘り方(オプション: -L, -R, -f, -N -g)](https://www.kmc.gr.jp/advent-calendar/ssh/2013/12/09/tunnel2.html)
