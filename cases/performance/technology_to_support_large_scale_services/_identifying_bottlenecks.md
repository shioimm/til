# パフォーマンスのボトルネックを見つける
## ロードアベレージ (実行待ちになっている平均プロセス数) を見る
- top(1)、uptime(1)コマンド
- ロードアベレージが低いのにシステムのスループットが上がらない場合:
  - ソフトウェアの不具合
  - ネットワークやリモートホスト側の問題
- ロードアベレージが高い場合:
  - CPUとI/Oどちらがボトルネックか見極める

## CPUとI/Oどちらがボトルネックか見極める
### CPU負荷が高い場合
- ユーザープログラムとシステムプログラムどちらがボトルネックなのか見極める
  - top(1)、sar(1)コマンド
- 原因のプロセスを見極める
  - ps(1)コマンド
- 原因のプロセスの詳細を確認する
  - strace(1)、oprofile(1)コマンド

#### システムのスループットに問題がある場合:
- サーバー増設、プログラムのロジック・アルゴリズムの改善

#### プログラムが暴走してCPUに負荷がかかっている場合:
- プログラムの不具合を取り除く

### I/O負荷が高い場合
- プログラムからの入出力が多いかスワップが発生しているか見極める
  - sar(1)、vmstat(1)コマンド

#### プログラムからの入出力が多く負荷が高い場合:
- キャッシュに必要なメモリが不足している
- サーバーの持つデータ容量と増設可能なメモリ量を比較する
- メモリ増設でキャッシュ領域を拡大させることができる場合:
  - メモリ増設
- メモリ増設で対応しきれない場合:
  - データの分散、キャッシュサーバーの導入、プログラムの改善によるI/O頻度の軽減

#### スワップ発生によりディスクアクセスが発生している場合:
- 特定のプロセスが極端にメモリを消費していないか確認する
  - ps(1)コマンド
- プログラムの不具合でメモリを使い過ぎている場合:
  - プログラムを改善する
- 搭載メモリが不足している場合:
  - メモリ増設
- メモリ増設で対応できない場合:
  - データの分散

## 参照
- ［Web開発者のための］大規模サービス技術入門 ― データ構造、メモリ、OS、DB、サーバ/インフラ
