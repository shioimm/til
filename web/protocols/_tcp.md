# TCP
- 参照: よくわかるHTTP/2の教科書P21-22/40-41

### TCPによる通信の特徴
- データの信頼性
  - 失われたパケットの再送
  - 順番の入れ替わったパケットの並べ直し
- 輻輳制御
  - スロースタート
  - 輻輳状態の検知
- フロー制御

## 接続手順(TCP 3 wayハンドシェイク)
- (1)クライアント -> サーバーへ開始メッセージを送信
  - SYNフラグ
- (2)サーバー -> クライアントへ開始メッセージを送信
  - SYNフラグ、ACKフラグ
- (3)クライアント -> サーバーへ受信メッセージを送信
  - ACKフラグ
- (4)一コネクションが確立(TCPコネクション)

## ポート番号
- TCP通信のサービスを識別する番号
- ポート番号は使用するプロトコル別に指定される(Well-Knownポート)
  - サーバー -> 80番(送信先ポート番号)
  - クライアント -> 空いているポート番号(送信元ポート番号)

## KeepAlive
- 一度確立したTCPコネクション上で複数のHTTP通信を行う技術(HTTP/1.1)
- クライアントは複数のリクエストを送信できる
- サーバーは複数のレスポンスを送信できる
  - サーバーはクライアントがリクエストを送信した順でレスポンスを返す必要がある
- クライアントがKeepAlive接続を要求する際はConnectionリクエストヘッダをkeep-aliveに設定する
- サーバーがKeepAlive接続を行う場合はConnectionレスポンスヘッダをkeep-aliveに設定する
  - サーバーがKeepAlive接続を行わない場合はConnectionレスポンスヘッダをcloseに設定する

## TCP FAST OPEN
- 参照: [TCP FAST OPENとは？](https://blog.redbox.ne.jp/tcp-fast-open-cdn.html)
- TCPレイヤーにおける高速化の手法のひとつ
- 通信確立時の1RTTを節約する

### 手法
- 初回通信開始時、クライアントからSYNにFast Open Cookieを付けてハンドシェイクを行う
  - サーバーはTCPオプション34番でTFOクッキーを返す
  - クライアントはTFOクッキーをキャッシュする
- 初回以降の通信時、クライアントはSYNパケットにTFOクッキーとリクエストデータを含めて送信する
  - サーバーはクライアントから送られてきたTFOクッキーと自身の生成したTFOクッキーを比較検証
  - 正しければサーバーはリクエストデータをアプリケーションに渡し、クライアントにはSYN-ACKを返却
