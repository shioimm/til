# 優先度
- 参照: よくわかるHTTP/2の教科書P99-107

## 優先度とは
- サーバーが使用するリソースの割合
  - リソース -> 一般的にはデータの転送量

## 優先度指定
- クライアントはリクエスト送信時にレスポンスの優先度を設定することができる
- サーバーは優先度を考慮してレスポンスを送信する
  - 優先度は考慮されるが厳守される訳ではない

## ストリームの優先度
- 全てのストリームがHEADERSフレーム内に優先度情報を持っている
  - 優先度が指定されていないストリームはデフォルトの優先度が適用される
  - 優先度はPRIORITYフレームによって後から変更できる

## 優先度計算
- 優先度はWeightとDependencyの組み合わせから計算される
```
# Weight
- 1~256で指定される重み
- デフォルトは16
- サーバーがリソースを分配する割合を計算するときに使用される
```
```
# Dependency
- あるストリームが依存する別のストリームを指定する
- デフォルトは0
```
- 優先度は木構造の優先順位ツリーによって表せられる
  - rootストリームはストリーム0(リソースは割り当てられない)
  - Dependency0のストリームはrootストリーム直下に配置される
  - 各ストリームに対してDependencyを持つストリーム(子)はその配下に配置される
    - 子ストリームは親ストリームの処理が終わった後に処理を開始する
      - 各ストリームは同じレイヤーの全体の重みに占める割合に応じてリソースが割り当てられる
      - 送信が終わったストリームの分、空いたリソースは同じレイヤーの他のストリームに割り当てられる

## PRIORITYフレーム
- PRIORITYフレームによって特定のストリームのWeightとDependencyを再設定できる
- 親ストリームのDependencyを変更すると子ストリームも一緒に移動する
