# HTTP/2 (High Performance Browser Networking | O'Reilly)まとめ
- 引用: [HTTP/2](https://hpbn.co/http2/)

## Stream Prioritization
- 引用: [Stream Prioritization](https://hpbn.co/http2/#stream-prioritization)
- フレームの多重化に伴い、クライアントとサーバーが
  フレームをインターリーブして配信する順序がパフォーマンス上の重要な考慮事項になる

### ストリームの優先順位
- HTTP/2では各ストリームに関連する重みと依存性を持たせることができる
  - 各ストリームには、1から256までの整数で重みを割り当てることができる
  - 各ストリームには、別のストリームへの明示的な依存関係を与えることができる

### 優先順位ツリー
- クライアントはストリーム依存性と重みの組み合わせから優先順位ツリーを構築し、通信する
  - 優先順位ツリー -> どのようにレスポンスを受け取りたいかを表現する木構造
  - クライアントは任意の時点で優先順位の設定を更新することができる
- サーバはツリーを活用してストリーム処理に優先順位を付ける
  - サーバーはCPU、メモリ、およびその他のリソースの割り当てを制御する
  - レスポンス可能になると、帯域幅の割り当てによって、優先順位の高いレスポンスからクライアントに配信する

### ストリーム間の依存関係と利用可能リソース
- ストリーム依存性は、別のストリームの一意の識別子を親として参照することによって宣言される
  - 親識別子を持たないストリームはrootストリームに依存しているとみなされる
- ストリーム依存性を宣言することにより、親ストリームは子ストリームより先にリソースが割り当てられる
- 同じ親を共有する兄弟ストリームには、その重みに応じてリソースが割り当てられる
```
重みが12のAストリームと重みが4のBストリームがある場合、

12 + 4 = 16
A = 12/16
B = 4/16

Aは使用可能リソースのうち3/4、Bは使用可能リソースのうち1/4を使うことになる
```

### 注意事項
- クライアントによる優先順位の指定は転送の優先度を示すが、
  サーバ側の特定の処理や送信順序を保証しない
  - 優先順位の高いリソースがブロックされた場合に、
    サーバーは優先順位の低いリソースから処理を行うことができる
