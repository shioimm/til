# 安全なWebアプリケーションの作り方(脆弱性が生まれる原理と対策の実践) まとめ
- 徳丸浩 著

## 文字コードとセキュリティ
- 文字コード
  - 文字集合
  - 文字エンコーディング(文字符号化方式)

### 文字集合
- 文字集合 -> コンピュータ上で扱う文字を集めたもの
  - 各文字に符号(番号)をつけて扱う(符号化文字集合)
    - US-ASCII
    - ISO-8859-1
    - JIS X 0201
    - Unicode -> 21ビットで全ての文字を表現する世界共通の文字集合
    - etc
- 文字の符号が同じでも、文字集合によって割り当てられている文字が異なる場合がある
  - この問題によって、正しくエスケープ処理が行われないなど脆弱性になりうる

### 文字エンコーディング
- 文字エンコーディング -> 複数の文字集合を併用するための符号化
  - Shift_JIS
    - 5C問題
    - 半端な先行バイト
  - EUC-JP
    - 半端な先行バイト
  - UTF-8
    - 非最短形式
  - UTF-16

### 文字コードによる脆弱性
- 文字エンコーディングとして不正なバイト列による脆弱性
  - 半端な先行バイト
  - 非最短形式
- 文字エンコーディングの扱いの不備による脆弱性
  - 5C問題
- 文字集合の変更に起因する脆弱性

### 対策
- アプリケーション全体を通して文字集合を統一する
- 入力時に不正な文字エンコーディングをエラーにする
- 処理の中で文字エンコーディングを正しく扱う
  - マルチバイト文字に対応した処理系・関数のみを扱う
  - 関数の引数として文字エンコーディングを明示する
- 出力時に文字エンコーディングを正しく指定する
  - Content-Typeレスポンスヘッダで文字エンコーディングを指定する
  - DBの文字エンコーディングを指定する
    - utf8mb4を指定する
    - 「尾骶骨」「𠮷(つちよし)」テスト
  - 文字エンコーディングの指定が必要な箇所はもれなく指定する
- 文字エンコーディングの自動判定を避ける
