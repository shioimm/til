# 安全なWebアプリケーションの作り方(脆弱性が生まれる原理と対策の実践) まとめ
- 徳丸浩 著

## 04 SQL呼び出しに伴う問題
### SQLインジェクション
- 発生箇所: SQL呼び出しをしている箇所
- 影響範囲: アプリケーション全体
- 影響の種類: 情報漏洩、データ改ざん、プログラムの実行、ファイルの参照・更新
- 影響度合い: 大
- 利用者関与の範囲: 不要
- 対策: 静的プレースホルダをるようしてSQLを呼び出す

#### 事例
- エラーメッセージ経由で情報を漏洩させる
- UNION SELECTを用いた情報漏洩
- ログインページのパスワード欄で認証を回避する
- データを改ざんするSQLを実行する
- OSコマンドの実行
- ファイルの読み出し・書き出し
- HTTPリクエストによる他のサーバーの攻撃

#### 原因
- 文字列リテラル
  - 続けて「';」を入力されると構文が終わる
- 数値項目
  - 続けて「;」を入力されると構文が終わる

#### 対策
- プレースホルダによるSQL文組み立て
```sql
-- ?部分を直接入力させない
SELECT * FROM books WHERE author = ? ORDER BY ID
```
```ruby
Book.where('author = ?', author)
```
```
- 静的プレースホルダ
  - 値のバインドをDBエンジン側で行う
  - 原理的にSQLインジェクションを防ぐ
- 動的プレースホルダ
  - 値のバインドをアプリケーション側で行う
```
- 詳細なエラーの抑止
- 入力値の妥当性検討
- DBの権限設定
