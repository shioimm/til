# ハイブリッド暗号方式
- 暗号化したい平文を共通鍵暗号化方式で暗号化し、その暗号化鍵を公開鍵暗号化方式で暗号化する方式
  - 鍵カプセル化メカニズム (KEM) + データカプセル化メカニズム (DEM) = KEM-DEMフレームワーク
- メッセージ(平文)を共通鍵暗号で暗号化する
- 共通鍵暗号の暗号化で使用するセッション鍵(通信毎に一回限り使用する鍵)は擬似乱数生成器で生成する
- セッション鍵を公開鍵暗号で暗号化する
- 公開鍵暗号の暗号化で使う鍵はハイブリッド暗号システムの外部から与える

## 動作フロー
### 暗号化
1. 送信者は擬似乱数生成器でセッション鍵を生成する
2. 送信者はメッセージをセッション鍵で暗号化する
3. 送信者はセッション鍵を受信者の公開鍵で暗号化する
4. 暗号化したメッセージと暗号化したセッション鍵を結合して暗号文とする

### 復号
1. 受信者は暗号文を受け取り、セッション鍵部とメッセージ部を分割する
2. 受信者はセッション鍵を受信者の秘密鍵で復号する
3. 受信者は復号したセッション鍵でメッセージを復号する

## HPKE
- 共通鍵の生成と公開鍵を利用する仕組み全体を定めたもの
- 楕円曲線を用いた鍵共有ECDH、シードから安全な鍵を生成する鍵導出関数HKDF、
  正しく暗号化されているかを検証できるAEADを用いて構成する

#### 動作フロー
1. Bobは秘密鍵bから公開鍵bPを作成しAliceに渡す
2. 鍵カプセル化: Aliceは一時的な乱数tを作成しtPを作成する
3. 鍵カプセル化: Aliceは共有秘密鍵`key = HKDF(tbP, tP, bP)`を作成しtPをBobに送る
4. 鍵デカプセル化: Bobは自分の秘密鍵bとtPから共有秘密鍵`key = HKDF(btP, tP, bP)`を計算する
5. 以降Bobはkeyを使ってAEADで平文を暗号化して送信する


## 参照
- 食べる！SSL！　―HTTPS環境構築から始めるSSL入門
- プロフェッショナルSSL/TLS
- マスタリングTCP/IP 入門編
- マスタリングTCP/IP 情報セキュリティ編
- 暗号技術入門 第3版
