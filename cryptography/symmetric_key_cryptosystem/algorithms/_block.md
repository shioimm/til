# ブロック暗号アルゴリズム
- 平文を特定のビット数のまとまり (ブロック) に分割し、ブロックごとにかき混ぜて暗号化するアルゴリズム
- ブロックに分割した際に端数がある場合、パディングで埋め合わせて一つのブロックを作る
- ブロック長単位で処理が完了するため、どこまで暗号化されたかを管理するための内部状態を持たない
- データ攪拌部と鍵生成部から構成される

#### ブロック暗号アルゴリズムによる暗号
- DES
- 3DES
- AES

## パディング
- 平文がブロック長に満たない場合、ブロック長に足りない部分に特定のデータを埋め込む
  - パディングは暗号化と復号いずれの処理でも一意である必要があるため、
    標準的に規定されたパディング方式を利用する
  - パディング方式は暗号文の送信者から受信者へ知らされる

#### パディングオラクル攻撃
- CBCモードのパディングに関する脆弱性をついた攻撃
- 攻撃者は受信者(サーバー)に対し、パディング内容を少しずつ変化させて暗号文を何度も送信する
- 攻撃者はサーバーが正しく復号できなかった場合に返すエラーから平文の一部を得ようとする

## 暗号化利用モード
- 1ブロック以上の平文を暗号化する際、ブロック暗号化を繰り返し適用する(モード = 繰り返しの方法)
  - 平文ブロック - ブロック暗号アルゴリズムで暗号化の対象となる平文
  - 暗号文ブロック - ブロック暗号アルゴリズムを使って平文ブロックを暗号化した暗号文

#### ECBモード
- 平文をブロックに分割し、それぞれを暗号化して暗号文を作る方式
- 決定的アルゴリズムであるため使用してはいけない
  - 暗号文ブロック同士を入れ替えることで暗号を解読しなくても平文を改竄できてしまう

#### CBCモード
- 平文をブロックに分割し、一つ前の暗号文ブロックと今回暗号化する平文ブロックのXORをとってから
  暗号化したものを暗号文ブロックとする方式
  - 最初の平文ブロックを暗号化する際は一つ前の暗号文ブロックの代わりに初期化ベクトル (IV) を使う
    - IV (Initialization Vector) - 毎回異なる1ブロック分のランダムなビット列
    - 予測可能なIVに対してはビット反転による改竄がが可能

#### CFBモード
- 平文をブロックに分割し、一つ前の暗号文ブロックを暗号化し、今回暗号化する平文ブロックとのXORをとったものを
  暗号文ブロックとする方式
  - 最初の平文ブロックを暗号化する際は一つ前の暗号文ブロックの代わりに初期化ベクトル(IV)を使う
- CFBモードは、鍵ストリームを利用して平文のデータを1ビットずつ暗号化するに等しい
  - 鍵ストリーム - 一つ前の暗号文ブロックを暗号化してできたビット列
- 攻撃者が暗号文ブロックを過去の暗号文ブロックへすり替える再生攻撃が可能
- パディング不要

#### OFBモード
- 平文をブロックに分割し、一つ前の暗号アルゴリズムの出力と今回暗号化する平文ブロックのXORをとったものを
  暗号文ブロックとする方式
- 一つ前の暗号アルゴリズムの出力を次の暗号アルゴリズムの入力とする
  - 最初の暗号アルゴリズムの入力の代わりに初期化ベクトル(IV)を使う
- 暗号文ブロックのビットを反転させることで複合化した時の平文ブロックのbittogahantendekiteshimau
- パディング不要

#### CTRモード
- ブロック暗号を使って疑似乱数を生成し、ストリーム暗号として利用する方式
- ブロックを暗号化するごとに一つずつ増加していくカウンタを暗号化し、鍵ストリームを作り出す
  - カウンタ = nonce(暗号化のたびに異なる値) + ブロック番号(カウントアップする)
  - カウンタの初期値はnonceを元にしてつくる
- カウンタを暗号化したビット列と平文ブロックとのXORを取った結果を暗号文ブロックとする
- 暗号文ブロックのビットを反転させることで複合化した時の平文ブロックのbittogahantendekiteshimau
- パディング不要

## 参照
- プロフェッショナルSSL/TLS
- マスタリングTCP/IP 情報セキュリティ編
- 暗号技術入門 第3版
- 図解即戦力　暗号と認証のしくみと理論がこれ1冊でしっかりわかる教科書
