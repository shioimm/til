# 時間
- `time_t`型 - Epochからの経過秒(カレンダー時間)
- `timeval`構造体 - Epochからの経過秒・マイクロ秒
- `tm`構造体 - 要素分解した時刻
- `tms`構造体 - プロセス時間
- `clock_t`型 - クロックティック
- 固定形式文字列
- ユーザー指定文字列

### `timeval`構造体
```c
struct timeval {
  time_t      tv_sec;  // Epochからの経過秒
  suseconds_t tv_usec; // マイクロ秒
};
```

### `tm`構造体
```c
struct tm {
  int tm_sec;   // 秒 0-60 うるう秒に対応するため60までをカバーしている
  int tm_min;   // 分 0-59
  int tm_hour;  // 時 0-23
  int tm_mday;  // 日 1-31
  int tm_mon;   // 月 0-11
  int tm_year;  // 年 1900からの経過年数
  int tm_wday;  // 曜日 0-6
  int tm_yday;  // 通し日数 0-365
  int tm_isdst; // 夏時間フラグ > 0(期間内) / = 0(期間外) / < 0(不明)
};
```

### `tms`構造体
```c
struct tms  {
  clock_t tms_utime;  // ユーザーCPU時間
  clock_t tms_stime;  // システムCPU時間
  clock_t tms_cutime; // 終了した子のユーザーCPU時間
  clock_t tms_cstime; // 終了した子のシステムCPU時間
};
```

### `timespec`構造体
```c
struct timespec {
  time_t tv_sec;  // 秒
  long   tv_nsec; // ナノ秒
};
```

## 現在時刻の取得
### `gettimeofday(3)`
- システムのカレンダー時間(Epochからの経過秒)を`timeval`構造体で取得
  - `settimeofday(3)` - システムのカレンダー時間を変更
    - 特権が必要
    - 通常はNTPデーモンが行う

#### 引数
- `*tv`、`*tz`を指定する
  - `*tv` - 結果を格納する`timeval`構造体へのポインタ
  - `*tz` - NULLを指定する
    - 元はタイムゾーンを表す`timezone`構造体へのポインタが指定されていたが現在は使用されない

#### 返り値
- 数値0を返す
  - エラー時は数値-1を返す

### `time(2)`
- システムのカレンダー時間(Epochからの経過秒)を`time_t`型で取得
  - `stime(2)` - システムのカレンダー時間を変更
    - 特権が必要
    - 通常はNTPデーモンが行う

#### 引数
- `*timep`を指定する
  - `*timep` - 結果を格納する`time_t`型へのポインタ

#### 返り値
- Epochからの経過秒を返す
  - エラー時は数値-1を返す

### `adjtime`
- システムクロックに同期する時刻を徐々にずらして最終的に変更する

#### 引数
- `*delta`、`*olddelta`を指定する
  - `*delta` - 時計の針をずらす秒数orマイクロ秒数を示す`timeval`構造体へのポインタ
  - `*olddelta` - 過去の調整でまだ完了せず残っている時間を格納する`timeval`構造体へのポインタ

#### 返り値
- 数値0を返す
  - エラー時は数値-1を返す

### `times(2)`
- プロセス時間を取得する

#### 引数
- `*buf`を指定する
  - `*buf` - プロセス時間を格納する`tms`構造体へのポインタ

#### 返り値
- 任意の時間からのクロックティックを返す
  - エラー時は`clock_t`-1を返す

## CPU時間の取得
### `clock(3)`
- 自プロセスが消費したユーザーCPU時間 + システムCPU時間の合計を返す
- ソフトウェアクロックの解像度に依存しない

#### 返り値
- 自プロセスが消費したCPU時間を`CLOCKS_PER_SEC`(100万)単位で返す
  - エラー時は`clock_t`-1を返す

## 変換
### `ctime(3)`
- `time_t`の値を可読な文字列へ変換

#### 引数
- `*timep`を指定する
  - `*timep` - 変換元の`time_t`型へのポインタ

#### 返り値
- 変換後の文字列(26バイト・'\0'終端)へのポインタを返す
  - Ex. `Fri May 11 21:44:53 2001\n\0`
  - エラー時はNULLを返す

- `clock_gettime(3)` - クロック時間を取得
- `clock_settime(3)` - クロック時間を設定
- `localtime(3) - タイムゾーンや夏時間を考慮の上カレンダー時間をローカル時間に変換`
- `gmtime(3) - カレンダー時間をUTC時間に変換`
- `strftime(3)` - `tm`構造体を字列を成形
- `strftime(3)` - 文字列を`tm`構造体へ変換

### `gmtime(3)`
- `time_t`の要素を分解し、`tm`構造体に変換する

#### 引数
- `*timep`を指定する
  - `*timep` - 変換元の`time_t`型へのポインタ

#### 返り値
- 変換後の`tm`構造体へのポインタを返す
  - エラー時はNULLを返す

### `localtime(3)`
- `time_t`の要素を分解し、システムのローカルタイムを考慮した`tm`構造体に変換する

#### 引数
- `*timep`を指定する
  - `*timep` - 変換元の`time_t`型へのポインタ

#### 返り値
- 変換後の`tm`構造体へのポインタを返す
  - エラー時はNULLを返す

### `mktime(3)`
- `tm`構造体を`time_t`に変換する

#### 引数
- `*timeptr`を指定する
  - `*timeptr` - 変換元の`tm`型へのポインタ

#### 返り値
- 変換後の`time_t`を返す
  - エラー時はNULLを返す

### `asctime(3)`
- `tm`構造体を可読な文字列へ変換

#### 引数
- `*timeptr`を指定する
  - `*timeptr` - 変換元の`tm`型へのポインタ

#### 返り値
- 変換後の文字列(26バイト・'\0'終端)へのポインタを返す
  - Ex. `Fri May 11 21:44:53 2001\n\0`
  - エラー時はNULLを返す

### `strftime(3)`
- `tm`構造体を可読な文字列へ変換
- ユーザー指定のフォーマットで変換を行う

#### 引数
- `*outstr`、`maxsize`、`*format`、`*timeptr`を指定する
  - `*outstr` - 結果文字列を格納する領域
  - `maxsize` - `*outstr`の領域サイズ
  - `*format` - フォーマット
  - `*timeptr` - 変換元の`tm`型へのポインタ

#### 返り値
- `*outstr`へコピーしたバイト数を返す
  - エラー時は数値0を返す

### `strptime(3)`
- 日付と文字列を`tm`構造体へ変換
- ユーザー指定のフォーマットで変換を行う

#### 引数
- `*str`、`*format`、`*timeptr`を指定する
  - `*str` - 変換元文字列
  - `*format` - フォーマット
  - `*timeptr` - 結果`tm`型へのポインタ

#### 返り値
- `*str`の処理しなかった先頭文字へのポインタ
  - エラー時は数値0を返す

## タイムゾーン
### `tzset(3)`
- グローバル変数`*tzname` / `daylight` / `timezone`の初期化
  - `*tzname` - タイムゾーン名とDST名
  - `daylight` - DST期間内なら真
  - `timezone` - タイムゾーン標準時とDSTの差(秒)

## 参照
- Linuxプログラミングインターフェース 10章
- 詳解UNIXプログラミング第3版 6. システムデータファイルと情報
