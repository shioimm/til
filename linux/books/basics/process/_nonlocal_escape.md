# 非局所脱出
- 深い関数呼び出しの入れ子からプログラムの実行制御を一気にリターンさせる機能
  - `goto`文   - 現在実行中の関数の中でのみジャンプ可能
  - 非局所脱出 - 関数の範囲を超えてジャンプ可能(ただしリターンする方向だけ)

## 仕組み
1. 事前にグローバル変数`static jmp_buf env;`を宣言しておく
    - レジスタ値を保存するために使用する
2. ジャンプ先の登録(`setjmp(3)`呼び出し)
3. レジスタ値が変数`env`に退避される
    - プログラムカウンタレジスタ - 現在実行中の機械語命令
    - スタックポインタレジスタ - スタックトップ
4. ジャンプの呼び出し(`longjmp(3)`呼び出し)
5. 保存しておいたレジスタ値が元に戻される
    - スタックポインタに`env`が持つ値を再代入する(スタック巻き戻し)
      = `setjmp(3)`呼び出し位置から`longjmp(3)`するまでに呼ばれた関数のスタックフレームは破棄される
    - プログラムカウントを`env`が持つ値を使って変更する
6. `setjmp(3)`の続きから処理を再開する
    - 自動変数やレジスタの値は`setjmp(3)`した時の値に戻ることがある
    - 対象の変数に`volatile`をつけると元に戻らないことを保証する
    - 確実に元に戻す方法はない

## 制限
- 条件分岐(`if` / `switch`)、繰り返し処理(`while` / `for`)の中で使用可能
- 単項演算子`!`のオペランドで使用可能
- 比較演算子`==` / `!=` / `<`で使用可能
- 単独の関数コールの中で使用可能

## 参照
- 例解UNIX/Linuxプログラミング教室P433-448
- Linuxプログラミングインターフェース 6章

## TL;DR
