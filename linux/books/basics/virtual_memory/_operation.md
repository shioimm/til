# 仮想メモリ操作
## 仮想メモリ保護フラグの変更
### `mprotect(2)`
- 仮想メモリページのメモリ保護フラグを変更する
- 設定したメモリ保護フラグに反するアクセスがなされると、
  カーネルがプロセスへ`SIGSEGV`を送信する

#### 引数
- `*addr`、`length`、`prot`を指定する
  - `*addr` - メモリ領域の先頭アドレスへのポインタ(システムページサイズの倍数)
  - `length` - 領域のサイズ(バイト単位)
  - `prot` - 設定するメモリ保護フラグのビットマスク

#### 返り値
- 数値0を返す
  - エラー時は数値-1を返す

## メモリのロック・アンロック
- 仮想メモリを物理メモリ上にロックする
- ロックしたメモリは常に物理メモリ上に存在するようになる
- プロセスがメモリ上にロック可能なバイト数は`RLIMIT_MEMLOCK`によって制御される
  - デフォルト値はソフトリミット・ハードリミットともに32768バイト(8ページ)
- 子プロセスは親プロセスのメモリロックを受け継がない

### `mlock(2)` / `munlock(2)`
- メモリ領域をロック / アンロックする

#### 引数
- `*addr`、`length`を指定する
  - `*addr` - 自プロセスの仮想アドレスを指すポインタ
  - `length` - ロック / アンロックするメモリサイズ

#### 返り値
- 数値0を返す
  - エラー時は数値-1を返す

### `mlockall(2)` / `munlockall(2)`
- 自プロセスのメモリ領域全体をロック / アンロックする

#### 引数
- `mlockall(2)` - `flags`を指定する
  - `flags` - 対象とするメモリページを制御するフラグ

#### 返り値
- 数値0を返す
  - エラー時は数値-1を返す

### `mincore(2)`
- 指定した仮想アドレス空間内のページが現在RAMに存在するか検査する

#### 引数
- `*addr`、`length`、`*vec`を指定する
  - `*addr` - 対象の仮想アドレスを指すポインタ
  - `length` - 対象のメモリサイズ
  - `*vec` - 検査結果を格納する文字列へのポインタ

#### 返り値
- 数値0を返す
  - エラー時は数値-1を返す

## メモリアクセスパターンのヒント
### `madvise(2)`
- 対象のメモリを時プロセスがどのように使用するかをカーネルへ通知する
- カーネルは通知内容に応じてメモリ管理を最適化する

#### 引数
- `*addr`、`length`、`advice`を指定する
  - `*addr` - 対象の仮想アドレスを指すポインタ
  - `length` - 対象のメモリサイズ
  - `advice` - カーネルへ通知する内容を示す定数マクロ

#### 返り値
- 数値0を返す
  - エラー時は数値-1を返す

## 参照
- Linuxプログラミングインターフェース 50章
