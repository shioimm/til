# Pthreads API
- 参照: 詳解UNIXプログラミング第3版 11. スレッド
- 参照: 詳解UNIXプログラミング第3版 12. スレッドの制御
- 参照: Linuxプログラミングインターフェース 29章

## スレッドID
### `pthread_self(3)`
- スレッドIDを返す

#### 返り値
- 自スレッドのIDを返す

### `pthread_equal(3)`
- 二つのスレッドIDを比較し、等しいかどうかを検査する

#### 引数
- `t1`、`t2`を指定する

#### 返り値
- 等しい場合は数値0以外を返す
- 等しくない場合は数値0を返す

## スレッドの作成
### `pthread_create(3)`
- スレッドを新規に作成する
- スレッド作成後、新しく作成されたスレッドと呼び出し側のスレッドのうち
  どちらが先に動き出すかについては保証がない

#### 引数
- `*thread`、`*attr`、`*start`、`*arg`を指定する
  - `*thread` - 作成するスレッドのスレッドIDを保管する`pthread_t`へのポインタ
  - `*attr` - 作成するスレッドのスレッド属性
  - `*start` - 作成するスレッドが開始する関数
  - `*arg` - `*start`への引数

#### 返り値
- 数値0を返す
  - エラー時は正のエラー番号を返す

## スレッドの終了
### `pthread_exit(3)`
- 自スレッドを終了させる

#### 引数
- `*retval`を指定する
  - `*retval` - スレッドの返り値へのポインタ

## スレッドの終了の待機
### `pthread_join(3)`
- 指定のスレッドの終了を待機する
  - すでに終了していた場合は即時リターンする
- どのスレッドからも呼び出し可能
- 指定のスレッドが終了するまで呼び出し側スレッドの処理がブロックされる
- 対象スレッドを自動的にデタッチ状態にしてリソースを解放する効果がある

#### 引数
- `thread`、`**retval`を指定する
  - `thread` - 指定のスレッドのスレッドID
  - `**retval` - スレッドの返り値を代入する変数へのポインタ

#### 返り値
- 数値0を返す
  - エラー時は正のエラー番号を返す

## スレッドのデタッチ
- 指定のスレッドをjoinさせず、終了時に自動的に破棄するようにさせる

#### 引数
- `thread`を指定する
  - `thread` - 指定のスレッドのスレッドID

#### 返り値
- 数値0を返す
  - エラー時は正のエラー番号を返す

## mutex
### mutexの初期化(スタティック)
- スタティックに割り当て、デフォルトの属性を持つmutexに対する初期化

```c
pthread_mutex_t mtx = PTHREAD_MUTEX_INITIALIZER;
```

### `pthread_mutex_init(3)`
- mutexの初期化(ダイナミック)
  - mutexオブジェクトをヒープ上にダイナミックに割り当てる場合
  - mutexオブジェクトがスタック上に割り当てられているオート変数である場合
  - mutexオブジェクトはスタティックに割り当てたがデフォルト以外の属性で初期化する場合

#### 引数
- `*mutex`、`*attr`を指定する
  - `*mutex` - 指定のmutexへのポインタ
  - `*attr` - 予め属性を設定した`pthread_mutexattr_t`構造体へのポインタ

#### 返り値
- 数値0を返す
  - エラー時は正のエラー番号を返す

### `pthread_mutex_lock(3)`
- 指定のmutexをロックする
- mutexがアンロック状態 -> ロック状態へ遷移させる
- mutexがロック状態 -> アンロックされるまで待つ
  - 自スレッドがロックしたmutexへ`pthread_mutex_lock(3)`を呼ぶ -> デッドロック(Linux)
- `pthread_mutex_trylock(3)` - 対象のmutexがロック状態の場合`EBUSY`を返す
- `pthread_mutex_timedlock(3)` - 対象のmutexがロック状態の場合アンロックされるのを待つ時間の上限を設定する

#### 引数
- `*mutex`を指定する
  - `*mutex` - 指定のmutexへのポインタ

#### 返り値
- 数値0を返す
  - エラー時は正のエラー番号を返す

### `pthread_mutex_unlock(3)`
- 指定のmutexをアンロックする
- mutexがロック状態 -> アンロック状態へ遷移させる
- mutexがアンロック状態 -> エラー

#### 引数
- `*mutex`を指定する
  - `*mutex` - 指定のmutexへのポインタ

#### 返り値
- 数値0を返す
  - エラー時は正のエラー番号を返す

### `pthread_mutex_destroy`
- ダイナミックに割り当てたmutexを破棄する
- ダイナミックに割り当てたメモリの中にmutexがある場合、メモリを解放する前に破棄する
- オート変数のmutexは関数がリターンする前に破棄する

#### 引数
- `*mutex`を指定する
  - `*mutex` - 指定のmutexへのポインタ

#### 返り値
- 数値0を返す
  - エラー時は正のエラー番号を返す

## 条件変数
### 条件変数の初期化(スタティック)
- スタティックに割り当て、デフォルトの属性を持つ条件変数に対する初期化

```c
pthread_cond_t mtx = PTHREAD_COND_INITIALIZER;
```

### `pthread_cond_init(3)`
- 条件変数の初期化(ダイナミック)
  - 条件変数オブジェクトをヒープ上にダイナミックに割り当てる場合
  - 条件変数オブジェクトがスタック上に割り当てられているオート変数である場合
  - 条件変数オブジェクトはスタティックに割り当てたがデフォルト以外の属性で初期化する場合

#### 引数
- `*cond`、`*attr`を指定する
  - `*cond` - 指定の条件変数へのポインタ
  - `*attr` - 予め属性を設定した`pthread_condattr_t`構造体へのポインタ

#### 返り値
- 数値0を返す
  - エラー時は正のエラー番号を返す

### `pthread_cond_wait(3)`
- 指定の条件変数から通知が届くまで待つ
- `pthread_cond_timedwait(3)` - 待機時間の条件を設定する

#### 引数
- `*cond`、`*mutex`を指定する
  - `*cond` - 指定の条件変数へのポインタ
  - `*mutex` - 対象となるmutexへのポインタ

#### 返り値
- 数値0を返す
  - エラー時は正のエラー番号を返す

### `pthread_cond_signal(3)`
- 指定の条件変数へ通知を送信する
- 複数のスレッドが`pthread_cond_wait(3)`しているとき、
  待機中のスレッドのうちどれかの待機を終了させる

#### 引数
- `*cond`を指定する
  - `*cond` - 指定の条件変数へのポインタ

#### 返り値
- 数値0を返す
  - エラー時は正のエラー番号を返す

### `pthread_cond_broadcast(3)`
- 指定の条件変数へ通知を送信する
- 複数のスレッドが`pthread_cond_wait(3)`しているとき、
  待機中の全スレッドの待機を終了させる

#### 引数
- `*cond`を指定する
  - `*cond` - 指定の条件変数へのポインタ

#### 返り値
- 数値0を返す
  - エラー時は正のエラー番号を返す

### `pthread_cond_destroy`
- ダイナミックに割り当てた条件変数を破棄する
- ダイナミックに割り当てたメモリの中に条件変数がある場合、メモリを解放する前に破棄する
- オート変数の条件変数は関数がリターンする前に破棄する

#### 引数
- `*cond`を指定する
  - `*cond` - 指定の条件変数へのポインタ

#### 返り値
- 数値0を返す
  - エラー時は正のエラー番号を返す

### `pthread_once(3)`
- ワンタイムイニシャライゼーションの設定を行う

#### 引数
- `*once_control`、`*init`を指定する
  - `*once_control` - `*init`を実行するかしないか状態を示す`pthread_once_t`へのポインタ
  - `*init` - 実行する初期化関数へのポインタ

```c
// *once_controlの設定

pthread_once_t once_var = PTHREAD_ONCE_INIT

// *initの設定

void init(void)
{
  // 実行する処理
}
```

#### 返り値
- 数値0を返す
  - エラー時は正のエラー番号を返す

### `pthread_key_create(3)`
- スレッド固有データのためのグローバル配列のインデックスを
  スレッド固有データのキーとしてマークし、確保する
- キーに対応するスレッドが終了すると自動的にデストラクタが実行される

#### 引数
- `*key`、`*destructor`を指定する
  - `*key` - スレッド固有データのキーを保管する`pthread_key_t`へのポインタ
  - `*destructor` - デストラクタ関数へのポインタ

```c
// *destructorの設定

void dest(void *value)
{
  // *valueのメモリ領域を解放する処理
}
```

#### 返り値
- 数値0を返す
  - エラー時は正のエラー番号を返す

### `pthread_setspecific(3)` / `*pthread_getspecific(3)`
- `pthread_setspecific(3)` - 自スレッドのキーに対応する`value`を設定する
- `pthread_getspecific(3)` - 自スレッドのキーに対応する`value`を返す

#### 引数
- `pthread_setspecific(3)` - `*key`、`*value`を指定する
  - `*key` - スレッド固有データのキーを保管する`pthread_key_t`へのポインタ
  - `*value` - 自スレッドが割り当てたメモリ領域へのポインタ(デストラクタの引数)
- `pthread_getspecific(3)` - `*key`を指定する
  - `*key` - スレッド固有データのキーを保管する`pthread_key_t`へのポインタ

#### 返り値
- 数値0を返す
  - エラー時は正のエラー番号を返す
