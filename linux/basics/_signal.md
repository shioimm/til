# シグナル(ソフトウェア割り込み)
- 参照: 例解UNIX/Linuxプログラミング教室P323-374

## TL;DR
- シグナルはプロセスに対して非同期的に送られる通知
- シグナルは`<signal.h>`にマクロとして定義されており、コンパイル時に整数に展開される

### シグナルを受け取ったプロセスが行う動作
- 終了
- コアダンプ(コアファイルを生成して終了)
- 無視
- シグナルハンドラを実行
- その他

### シグナルが送信される状況
- ユーザーがキーボードからシグナルを送ったとき
- `kill`コマンド / `kill`システムコールが呼ばれたとき
  - `kill(2)`  - 指定のプロセスに対して任意のシグナルを送信する
  - `raise(3)` - 自プロセスに対して任意のシグナルを送信する
- OSがシグナルを送った時
- ハードウェアがOSを介してシグナルを送った時

### シグナルを送信する条件
- 送信側の実ユーザーIDあるいは実行ユーザーIDが
  受信側の実ユーザーIDあるいは保存セットユーザーIDに一致していること

## シグナルハンドラ
- 「シグナルの捕捉」 - シグナルハンドラを使ってシグナルを処理すること
- `signal(2)` - 指定のシグナルを受信した際、指定の関数(シグナルハンドラ)を実行する
  - プロセスがシグナルを受け取った際、それまで実行していたプログラムは一時停止する
  - プロセスはいつシグナルを受け取るかわからない
  - `handler`型 - 引数が`int`、返り値が`void`である関数型
  - OSによって挙動が異なる、シグナルが紛失する場合がある、受け取れる情報が少ないなどの問題がある
    -> `signal(2)`の代わりに`sigaction(2)`を使用する
- `sigaction(2)` - 指定のシグナルを受信した際の新しい動作と以前の動作をそれぞれ`sigaction`構造体に保存する
```c
// sigaction構造体
struct sigaction {
  sigset_t sa_mask;  // シグナルハンドラ実行中にブロックするシグナルの設定
  int      sa_flags; // オプション設定フラグ

  // どちらか一つだけ設定
  void (*sa_handler)(int);                        // 引数が一つのシグナルハンドラ
  void (*sa_sigaction)(int, siginfo_t *, void *); // 引数が三つのシグナルハンドラ
};

// sa_maskの設定
// sigset_t - シグナルの集合を表すシステムデータ型
// int sigemptyset(sigset_t *set);                  // シグナル集合を空にする
// int sigfillset(sigset_t *set);                   // シグナル集合に全てのシグナルを加える
// int sigaddset(sigset_t *set, int signo);         // シグナル集合に任意のシグナルを加える
// int sigdelset(sigset_t *set, int signo);         // シグナル集合から任意のシグナルを削除
// int sigismember(const sigset_t *set, int signo); // シグナル集合に任意のシグナルが含まれるか確認
```

## シグナル待機
- `pause(2)` - シグナルが来るまで以降の操作をブロックする
  - `pause`する前にシグナルが届いた場合、ブロックが永遠に解除されない
