# 内部構造
- 参照: Linuxプログラミングインターフェース 14章
- 参照: 詳解UNIXプログラミング第3版 4. ファイルとディレクトリ

## ディスクドライブ
- 物理ディスク
- ディスクドライブは一つ以上のパーティションから構成される
  - システム管理者が`fdisk(1)`を用いて
    ディスク上のパーティションの数・サイズ・種類を決定する
  - `/proc/partitions` - 全てのディスクパーティションのデバイスID、サイズ、デバイス名を格納

## ディスクパーティション
- ディスクドライブの分割領域
- `/dev`以下に各パーティションに対応する専用のデバイスファイルを持つ
- パーティションは次のいずれかを保存する
  - ファイルシステム(通常ファイル、ディレクトリの集合体)
    - `/proc/filesystems` - カーネルが認識している全てのファイルシステム種類を格納
  - スワップ領域(カーネルのメモリ管理用)
    - `/proc/swaps` - 現在使用中のスワップ領域の全体サイズ・使用サイズを格納
  - rawデバイスとして使用するデータ領域(Direct IOが利用する Ex. データベースシステム)

## ファイルシステム
- ディスクパーティションが保存する情報のうちの一つ
- 論理ブロック単位でファイルシステム内で領域を割り当てる
  - 論理ブロック - ディスクデバイス上の連続する物理ブロック
- ファイルシステムは次の要素から構成される
  - ブートブロック - OSを起動する情報を格納する
  - スーパブロック - ファイルシステム全体に関するパラメータを格納する
    Ex. i-nodeテーブルサイズ、論理ブロックサイズ、論理ブロック数
  - i-nodeテーブル - i-nodeエントリを格納する
  - データブロック - 実際のファイル、ディレクトリを構成する情報を格納する

### VFS
- 仮想ファイルシステム(virtual filesystem)
- ファイルシステムの抽象化レイヤ
  - 実装の異なる多様なファイルシステムを統一インターフェースで扱うための層
  - VFSはファイルシステムの汎用インターフェースを定義する
  - 各ファイルシステムはVFSが定義したインターフェースを実装する

### ジャーナリングファイルシステム
- ファイルシステムのメタデータを保存するためのファイルシステム
  - メタデータ - ディレクトリエントリ、i-node、ファイルブロックポインタなど
  - システムクラッシュ時、ファイルシステムの整合性を確認し復旧するために使用する

#### 種類
- Reiserfs
- ext3 / ext4
- JFS
- XFS
- Btrfs

### 仮想メモリファイルシステム
- メモリ上に存在する擬似ファイルシステム(pseudo filesystem)
  - 仮想メモリファイルシステムはファイルシステムの汎用インターフェースを定義する
  - ディスクアクセスが発生しないため高速にファイル処理を行うことができる

#### tmpfs
- Linux2.4で導入された仮想メモリファイルシステム
- デフォルトではtmpfsのサイズはRAMサイズの50%まで増大しうる
- tmpfsはアンマウントされるかシステムクラッシュすると保持しているデータを破棄する
- tmpfsはユーザーアプリケーション用か、
  SystemV共有メモリおよび共有無名メモリマッピング用か、
  `/dev/shm`にマウントしてPOSIX共有メモリおよびPOSIXセマフォ用に使用される
