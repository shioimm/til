# Unixドメインソケット
- 参照: 詳解UNIXプログラミング第3版 17. 高度なプロセス間通信

## TL;DR
- 同一コンピュータ上で動くプロセス群の通信に使用するソケット通信
  - データをコピーするだけであるためインターネットドメインに比べオーバーヘッドが少ない
- ソケットとパイプの混ぜ合わせで実装される
- ストリームとデータグラムそれぞれのインターフェースを提供する

## 作成
- `socketpair(2)` - 接続済みのUnixドメインソケットの組を生成する
  - 各ソケットはユーザープロセスが持つ二つのファイルディスクリプタに対応する
  - Unixドメインの接続済みの組は全二重パイプのように動作する(読み書き両方でオープンされている) = `fd`パイプ

## アドレシング
- `socketpair(2)`で作成された各ソケットは名前を持たない
  - 関連しないプロセスから指定することができない
- `bind(2)`を利用してUnixドメインソケットにアドレスを紐付け理必要がある
- Unixドメインソケットのアドレス形式は`sockaddr_un`構造体で表現される

```c
#include <sys/un.h>

struct sockaddr_un {
  sa_family_t sun_family;    // AF_UNIX
  char        sun_path[108]; // パス名
};
```

- Unixドメインソケットにアドレスをつけると、
  システムはファイル種別`S_IFSOCK`として同じ名前のファイルを作成する
  - ソケット名をクライアントに告知するためだけに使用される
  - ソケットをクローズしてもファイルは自動的に削除されないため
    主導で削除する必要がある

## 接続
- サーバープロセス - クライアントプロセス間では
  インターネットドメインソケットと同じシステムコールを使用して
  接続を行うことができる
