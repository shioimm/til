# システムが設ける制限とオプション機能
- 参照: Linuxプログラミングインターフェース 11章

## TL;DR
- すべてのUNIXシステムはリソースに何らかの範囲を設けて制限している
  - プロセスが同時にオープン可能なファイル数
  - リアルタイムシグナル対応の可否
  - `int`が表現できる最大値
  - コマンドラインパラメータ数の上限
  - 最長パス名
- 可搬性においては下記を考慮する必要がある
  - UNIXシステム間での差異
  - 実行環境への依存性
  - ファイルシステムの差異

## システムが設ける制限
- SUSv3が定める最小値は`<limits.h>`にマクロ定数`POSIX_XXX_MAX`として定義されている
  - アプリケーションの上限値としては小さすぎるため
    `<limits.h>`以外に`sysconf(3)` / `pathconf(3)`を参照してアプリケーションの上限値を決定する
- 実際の制限名は`<limits.h>`にマクロ定数`XXX_MAX`と命名されている
  - マクロ定数`XXX_MAX`が定義されていれば、
    その値は常にマクロ定数`POSIX_XXX_MAX`の最小値以上の値になる

### 制限の種類
#### 実行時固定
- システムにより値が固定されているもの
  - `<limits.h>`に定義されていない場合がある
  - `sysconf(3)`で取得可能
  - Ex. `MQ_PRIO_MAX`

#### パス名依存
- ファイル・ディレクトリ・端末などパス名により値が異なるもの
  - `pathconf(3)` / `fpathconf(3)`で取得可能
  - Ex. `NAME_MAX`

#### 実行時拡張可能
- システムにより制限の最小値のみ固定されているもの
  - システムにより実行時に上限を引き上げるものもある
  - `sysconf(3)`で取得可能
  - Ex. `NGROUPS_MAX`

#### 未確定値
- システムが定数として実装していないもの
  - SUSv3が定義した最小値を用いる
  - あるいは値を確認せずに使用する
  - あるいは値を予測、推測する関数を自作する
  - Ex. `PATH_MAX`

## オプション機能
- UNIXが実装する機能のうちSUSv3にてオプション扱いとなっている機能
  - Ex. リアルタイムシグナル、POSIX共有メモリ、ジョブコントロール、POSIXスレッド
    非同期IO、POSIXメッセージキュー、プロセススケジューリングetc
  - コンパイル時または実行時に機能が実装されていることを判断するための情報を提供する
    - `<unistd.h>`で定義されているマクロ定数`_POSIX_XXX` / `XOPEN_XXX`
    - 数値`-1` - 非対応
    - 数値`0` - 対応の可能性あり
    - 数値`正の値` - 対応

## API
### `getconf(1)`
- システムが設けた制限や追加したオプションを参照する

```
$ getconf VARIABLE_NAME
```

### `sysconf(3)`
- アプリケーション実行時に制限値を取得する

#### 引数
- `name`を指定する
  - `name` - `<unistd.h>`で定義された`_SC_`で始まるマクロ名

#### 返り値
- 制限値を返す
  - エラー時は数値-1を返す

### `pathconf(3)` / `fpathconf(3)`
- ファイル関連の制限値を取得する

#### 引数
- `pathconf(3)` - `*pathname`、`name`を指定する
  - `name` - `<unistd.h>`で定義された`_PC_`で始まるマクロ名
- `fpathconf(3)` - `fd`、`name`を指定する
  - `fd` - オープン済みのファイルディスクリプタ
  - `name` - `<unistd.h>`で定義された`_PC_`で始まるマクロ名

#### 返り値
- 制限値を返す
  - エラー時は数値-1を返す
