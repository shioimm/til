# 低水準入出力
- 参照: 例解UNIX/Linuxプログラミング教室P107-148 / P271-275

## TL;DR
- カーネルが提供する入出力機能全般
  - `open` / `close`(開け閉め)
  - `read` / `write`(読み書き)
  - `seek`(カレントファイルオフセットを移動させる操作)
- システムコールによって提供される

## バイトストリーム
- Unixにおけるファイル
- バイトが一列に並んだもの
  - ファイルオフセット - 各バイトの位置を示す整数
  - カレントファイルオフセット - ファイルの読み書き位置となるファイルオフセット

## ファイルディスクリプタ
- ファイルを開く際、プロセスとファイルを結びつける記述子
  - ファイルを開くと生成される
  - ファイルを閉じると削除される
- ファイルディスクリプタが開かれている間、
  そのファイルに対するカレントファイルオフセットが保持される
  - カレントファイルオフセットはファイルを開いた時点で0に初期化される

### ファイルディスクリプタのコピー
- `dup2(2)` - file構造体を指すfd1がある時、同じfile構造体を指すfd2を生成する
- `dup(2)` - file構造体を指すfd1がある時、同じfile構造体を指すファイルディスクリプタ(最小値)を生成する
  - file構造体が持っている情報はfd1と新しいファイルディスクリプタに対して同じ内容で共有される
    - ファイル情報フラグ・カレントファイルオフセット・ファイルの実態へのポインタ
  - fd1を既存のファイルディスクリプタfd0に`dup`すると、
    fd0は既存のストリームを閉じてfd1と同じfile構造体を指すようになる

## read
- ファイルにあるバイト列をプロセスのメモリ領域に読み込む
  - バッファ - プロセスのメモリ領域
    - char型の配列としてプログラム上で用意する
  - EOF - ファイルの終わりの位置
    - 読み込む予定のバイト数よりも実際に読み込んだバイト数の方が少ない = EOF
- 10バイト分のバイト列を読む
  -> バッファに10バイト分のデータが入る
  -> カレントファイルオフセットが10バイト分移動する

## write
- バッファの内容をファイルに書き込む
  - 元々のデータは上書きされる
- 10バイト分のバッファをファイルに書き込む
  -> カレントファイルオフセットが10バイト分移動する(EOF)

## 標準入力・出力・エラー出力
- 標準入力・出力・エラー出力のファイルディスクリプタは端末プロセス起動時に生成される
  - STDIN  - 1
  - STDOUT - 2
  - STDERR - 3
- 標準入力にはEOFが無い
  - 出力が常に入力待ちの状態になる
  - `Ctrl + D`でシグナルを送出する

## 穴
- EOFを超えた位置にファイルオフセットを置き、データを書き込んだ場合
  元々あったデータの終端と新しく書き込んだデータの先端の中間に位置するバイト列
  - 中間のバイト列は'0'(NULL文字)で自動的に埋められる
