# プロセスグループ、セッション、ジョブコントロール
- 参照: Linuxプログラミングインターフェース 34章

## TL;DR
- プロセスグループ、セッション - プロセス間に二段階の階層構造を生成するもの
  - プロセスグループ - 関係を持つ複数のプロセスからなる集合
  - セッション - 関係を持つ複数のプロセスグループからなる集合
  - プロセスグループ・セッションはシェルのジョブコントロールを実現するための抽象概念
- ジョブコントロール - コマンドのフォアグランド / バックグラウンド実行に関する操作

### 例示
- インタラクティブログインにおいて
  - 制御端末 - ログインした端末
  - セッションリーダー(制御プロセス) - ログインシェル
  - 新規プロセス・新規プロセスグループ - シェルから実行したコマンド
  - フォアグラウンドプロセスグループ - シェルから実行したコマンド
  - バックグラウンドプロセスグループ - シェルから`&`を付加して実行したコマンド

## プロセスグループ
- 同じプロセスグループIDを共有する一つまたは複数のプロセスの集合
- プロセスグループの作成者であるプロセスをプロセスグループリーダーとする
  - プロセスグループリーダーは自身のプロセスIDをプロセスグループIDとする
- 新規プロセスは親プロセスと同じプロセスグループに入る

### プロセスグループのライフタイム
1. プロセスグループリーダーがプロセスグループを作成する
2. プロセスグループから全てのメンバープロセスがいなくなると終了する

### プロセスがプロセスグループから抜けるケース
- プロセスが終了する
- 他のプロセスグループへ移動する

## セッション
- 同じセッションIDを共有するプロセスの集合であるプロセスグループの集合
- セッションを開始したプロセスをセッションリーダーとする
  - セッションリーダーは自身のプロセスIDをセッションIDとする
- 新規プロセスは親プロセスと同じセッションに入る

### 制御端末との関係
- セッション内の全プロセスは同じ制御端末を共有する
- セッションリーダーが最初に接続を確立(オープン)した端末デバイスを制御端末とする
  = 制御端末との接続を確立したセッションリーダーはその端末の制御プロセスになる
  - 端末デバイスは同時に複数のセッションの制御端末になることができない
  - 制御端末との接続が切断されるとカーネルが制御プロセスへ`SIGHUP`シグナルを送信する
- セッション内のプロセスグループのうち、
  同時に一つだけが端末のフォアグラウンドプロセスグループになれる
  - 残りのプロセスグループはバックグラウンドプロセスグループとして動作する
  - 制御端末からの入力を受け取れるのはフォアグラウンドプロセスグループのみ
    - 割り込みキー、終了キー、一時停止キーが送信するシグナルは
      フォアグラウンドプロセスグループ内の全プロセスが受け取る
