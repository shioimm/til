# 端末
- 参照: 例解UNIX/Linuxプログラミング教室P375-432

## TL;DR
- 端末(ターミナル) = キーボード + ディスプレイ
  - 「端末」の語源はテレタイプ端末
  - 端末エミュレータ - ソフトウェアで実装された端末
- 端末ではシェルが実行されている <-> シェルのデフォルトの標準入出力は端末
```
1. ユーザーがキーボードからコマンドを入力
2. 端末エミュレータがユーザーの入力値をシェルの標準入力に送信
3. シェルが入力値を実行し標準出力から端末エミュレータに送信
4. 端末エミュレータがシェルの出力値をキーボードに出力
```

### プログラマが行う端末処理
- 端末ラインディシプリン(端末回線規約)の設定の取得・変更
- エスケープシーケンスの取得・発行

## デバイスファイル
- Unixにおいてはあらゆるものがファイルとして抽象化されている
  - デバイスファイル(特殊ファイル) - 端末 = デバイス
  - `tty(1)`(`/dev/tty`) - 端末をデバイスファイルとして抽象化したものを取得する
```
$ echo hello > `tty`
hello

$ cat `tty`
hello
     1	hello
```
- デバイスファイルはエスケープシーケンスを解釈する
- デバイスファイルは端末ラインディシプリンを持つ

## エスケープシーケンス
- 端末にとって特殊な文字列
  - 通常の文字では表現できない機能を表現する
```
echo ^V^[[7m abc ^V^[[0m # 反転したabcが表示される
```

## 端末ラインディシプリン
- デバイスドライバとユーザープロセスの間におかれたプログラム

### 役割
1. キーボード入力をディスプレイに書く(`echo(1)`する)
2. 特殊制御文字の解釈
3. 端末入力のバッファリング処理
4. 改行文字の変換
5. 1~4の設定変更
    - `stty(1)` - 端末モードの変更コマンド
    - `tcgetattr(3)` - 端末モードの取得
    - `tcsetattr(3)` - 端末モードの変更

### カノニカルモード
- 入力を行ごとに処理する端末モード
- 入力された文字は改行されるまで一時てなバッファに蓄積する(標準入出力とは別のバッファ)

### `^C`
- 端末ラインディシプリンは端末から入力された`^C`を`SIGINT`に変換する

## `termios`構造体
WIP
