# 端末ログイン
- 参照: 詳解UNIXプログラミング第3版 9. プロセスの関係

## 手順
- (0) 端末装置ごとの設定ファイル`/etc/ttys`を設定
- (1) システムがブート
- (2) プロセスID1でプロセス`init`を作成
- (3) `init`がシステムをマルチユーザーモードに移行
- (4) `init`がファイル`/etc/ttys`を読み取りログイン可能な各端末装置に対して`fork`を実行
- (5) `fork`された子プロセスがプログラム`getty`を`exec`
  - プロセスの実ユーザーID / 実行ユーザーIDは0(スーパーユーザー)
- (6) `getty`が端末装置を読み書きモードで`open`
  - ファイルディスクリプタ0 - `STDIN` / 1 - `STDOUT` / 2 - `STDERR`が設定される
- (7) `getty`がユーザー名の入力を待つ
- (8) ユーザー名が入力されると`getty`が環境を初期化してプログラム`login`を`exec`
- (9) `login`がパスワードファイルのエントリを取得(`getpwnam`)
- (10) `login`がパスワードの入力を待つ
- (11) パスワードが入力されると`login`はパスワードを暗号化(`crypt`)
- (12) 暗号されたパスワードとシャドーパスワードファイルのエントリーフィールド(`pw_passwd`)を比較
  - 不正なパスワードが複数回入力された場合は`login`が
  `exit`を呼び、(4)からやり直し
- (13) 正しくログインできた場合`login`配下の処理を実行
  - ホームディレクトリに移動(`chdir`)
  - 端末装置の所有者をユーザーに変更(`chown`)
  - 端末装置のアクセス許可を変更し、ユーザーに読み書きを許可
  - グループIDを設定(`setgid` / `initgroups`)
  - 環境を初期化
    - `HOME` / `SHELL` / `USER` / `LOGIN` / `PATH`
  - ユーザーのユーザーIDに変更(`setuid`)
  - ユーザーのログインシェルを起動
    - `execle("/bin/sh", "-sh", (char *)0);`
- (14) ユーザーのログインシェルが始動ファイル(`.bash_profile`など)を読み込み
