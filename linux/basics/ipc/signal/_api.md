# API
- 参照: Linuxプログラミングインターフェース 20章

## シグナルの送信
### `kill(2)`
- プロセスから他のプロセスへシグナルを送信する
  - 特権プロセスはどのプロセスに対してもシグナルを送信することができる
  - 非特権プロセスは自身の実ユーザーIDまたは実効ユーザーIDが
    送信先プロセスの実ユーザーIDまたはset-user-IDに一致する場合
    シグナルを送信することができる
- 自プロセスはシグナルを`kill(3)`から戻る前に受信する
- `killpg(2)` - 指定したプロセスグループ内の全プロセスへシグナルを送信する

#### 引数
- `pid`、`sig`を返す
  - `pid` - シグナル送信先プロセスを示すPID
    - `pid > 0` - 指定したPIDを持つ子プロセス
    - `pid == 0` - 親プロセスと同じプロセスグループに属する子プロセス
    - `pid == -1` - 任意の子プロセス(`wait`と同じ)
    - `pid < -1` - プロセスグループIDが指定したPIDの絶対値に等しい子プロセス
  - `sig` - 送信するシグナルを示すマクロ
    - `sig`に0を指定すると、`pid`のプロセスが存在するかどうかを調べることができる
      `EPERM`またはエラーが返ってこなければ存在する

#### 返り値
- 数値0を返す
  - エラー時は数値-1を返す

### `raise(3)`
- 自プロセスへシグナルを送信する
- `kill(getpid(), sig)`と等価
  - スレッド対応システムの場合は`pthread_kill(pthread_self(), sig)`と等価
- 自プロセスはシグナルを`raise(3)`から戻る前に受信する

#### 引数
- `sig`を返す
  - `sig` - 送信するシグナルを示すマクロ

#### 返り値
- 数値0を返す
  - エラー時は数値-1を返す

## シグナルセット
### `sigemptyset(2)` / `sigfillset(2)`
- シグナルセットの初期化
  - `sigemptyset(2)` - 指定のシグナルセットから全てのシグナルを削除
  - `sigfillset(2)` - 指定のシグナルセットに全てのシグナルを追加

#### 引数
- `*set`を指定する
  - `*set` - シグナルセットへのポインタ

#### 返り値
- 数値0を返す
  - エラー時は数値0以外を返す

### `sigaddset(2)` / `sigdelset(2)`
- シグナルセットへのシグナルの追加 / 削除

#### 引数
- `*set`、`sig`を指定する
  - `*set` - シグナルセットへのポインタ

#### 返り値
- 数値0を返す
  - エラー時は数値-1を返す

### `sigismember(2)`
- シグナルセットへシグナルがセットされているかの確認

#### 引数
- `*set`、`sig`を指定する
  - `*set` - シグナルセットへのポインタ

#### 返り値
- 真の場合、数値0を返す
  - 偽の場合、数値-1を返す

## シグナル動作の変更
### `signal(2)`
- 指定のシグナルの動作を変更する
- `sigaction(2)`よりも設定できる機能が少なく、可搬性も低い

#### 引数
- `sig`、`*handler`を指定する
  - `sig` - 動作を変更するシグナルを示すマクロ
  - `*handler` - シグナル受信時に実行する関数へのポインタ

```c
// ハンドラとして設定する関数の形式

void handler(int sig)
{
  // 処理内容
}
```

```c
// handlerをtypedefしておくと便利

#define _GNU_SOURCE

typedef void(*sighandler_t)(int);

sighandler_t signal(int sig, sighandler_t handler);
```

#### 返り値
- 変更前のシグナル動作へのポインタを返す
  - エラー時は`SIG_ERR`を返す

### `sigaction(2)`
- 指定のシグナルの動作を変更する
- `signal(2)`より柔軟性・可搬性に優れる

#### 引数
- `sig`、`*act`、`*oldact`を指定する
  - `sig` - 動作を変更するシグナルを示すマクロ
  - `*act` - 変更前の動作を表す`sigaction`構造体へのポインタ
  - `*oldact` - 変更前の動作を表す`sigaction`構造体へのポインタ
```c
struct sigaction {
  void     (*sa_handler)(int); // シグナルハンドラへのポインタ
  void     (*sa_sigaction)(int, siginfo_t *, void *);  // シグナルハンドラへのポインタ
                                                       //   シグナル捕捉時にシグナル番号以外の詳細な情報も取得できる
                                                       //   *sa_handlerと併用できない
  sigset_t   sa_mask;                                  // ハンドラ実行中にブロックするシグナル
  int        sa_flags;                                 // ハンドラを操作するフラグ
  void     (*sa_restorer)(void);                       // システムが使用する
};
```

```c
// sigactionの設定

struct sigaction xxx;
xxx.sa_hander = シグナルハンドラ
xxx.sa_flags  = シグナルハンドラ実行中の動作を設定
sigemptyset(&xxx.sa_mask);
sigaction(シグナル, &xxx, NULL);
```

#### 返り値
- 数値0を返す
  - エラー時は数値-1を返す

## シグナルの待機
### `pause(2)`
- シグナルハンドラが実行されるまで自プロセスの実行を停止する

#### 返り値
- 数値-1を返す

## シグナルの説明文字列
### `strsignal(3)`
- 配列`sys_siglist`からシグナルの説明文字列を参照する

#### 引数
- `sig`を指定する

#### 返り値
- シグナルを説明する文字列へのポインタを返す

## シグナルマスク
### `sigprocmask(2)`
- シグナルマスクを変更する

#### 引数
- `how`、`*set`、`*oldset`を指定する
  - `how` - シグナルマスクをどのように変更するかを指定するフラグ
  - `*set` - 新しいシグナルマスクへのポインタ
  - `*oldset` - 変更前のシグナルマスクへのポインタ

#### 返り値
- 数値0を返す
  - エラー時は数値-1を返す

### `sigpending(2)`
- 保留中のシグナルセットを参照する

#### 引数
- `*set`を指定する
  - `*set` - 取得したシグナルセットを格納するシグナルセットへのポインタ

#### 返り値
- 数値0を返す
  - エラー時は数値-1を返す
