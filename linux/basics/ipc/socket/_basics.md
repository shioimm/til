# ソケット
- 参照: 例解UNIX/Linuxプログラミング教室P291-322
- 参照: 詳解UNIXプログラミング第3版 16. ネットワークIPC: ソケット
- 参照: Linuxプログラミングインターフェース 56章

## TL;DR
- アプリケーション間でデータを交換するIPC
- ネットワークを介した異なるホスト間でも通信可能
- ソケットに対するIOではファイル操作のためのシステムコール、
  ソケット専用のシステムコールいずれも使用できる
  - デフォルトではブロッキングIO・ノンブロッキングIOも可能

### ソケット
- 通信を可能にする機構
- クライアント / サーバーいずれにもソケットが必要

### well-knownアドレス
- サーバーはソケットをwell-knownアドレスへバインドする
- クライアントはwell-knownアドレスによりサービスを特定する

### 通信ドメイン(通信領域、通信範囲)
- ソケットの特定方法
  - ソケットアドレスの形式
- 通信範囲
  - 同一ホスト上のアプリケーション間通信
  - ネットワーク介した異なるホスト上のアプリケーション間通信

| ドメイン   | 通信方法   | アプリケーション間通信       | アドレス形式              | アドレス構造体 |
| -          | -          | -                            | -                         | -              |
| `AF_UNIX`  | カーネル内 | 同一ホスト内                 | パス名                    | `sockaddr_un`  |
| `AF_INET`  | IPv4経由   | IPv4ネットワーク上の他ホスト | IPv4アドレス + ポート番号 | `sockaddr_in`  |
| `AF_INET6` | IPv6経由   | IPv6ネットワーク上の他ホスト | IPv6アドレス + ポート番号 | `sockaddr_in6` |

### ソケット種類
| 性質                   | ストリーム | データグラム |
| -                      | -          | -            |
| 配送の信頼性           | ○          | ×            |
| メッセージ区切りの維持 | ×          | ○            |
| コネクション(接続)指向 | ○          | ×            |

#### ストリームソケット
- `SOCK_STREAM`
- 信頼性と双方向性を備えたバイトストリームの通信チャネル
- 二つのソケットが接続した状態で動作する
- インターネットドメインではTCPを使用する

#### データグラムソケット
- `SOCK_DRAM`
- 信頼性を保証しないデータグラム(メッセージ区切りを維持する)の通信チャネル
- 他のソケットに接続せず使用する
- インターネットドメインではUDPを使用する

## API
### `socket(2)`
- プロセスに新しいソケットを一つ作成する

#### 引数
- `domain``type``protocol`
  - `domain` - ソケットの通信ドメインを示すマクロ定数
  - `type` - ソケット種類を示すマクロ定数
  - `protocol` - 数値0

#### 返り値
- ソケットディスクリプタを返す
  - エラー時は数値-1を返す
