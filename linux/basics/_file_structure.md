# file構造体
- 参照: 例解UNIX/Linuxプログラミング教室P133

## file構造体
- プロセスが`open(2)`を呼ぶとカーネル内にfile構造体が一つ生成される
- file構造体はopenが返すファイルディスクリプタとファイルの実体をつなぐ

## file構造体が格納する情報
- ファイル状態フラグ
  - フラグの集まり `O_APPEND` `O_NONBLOCK` `O_SYNC` etc
    - <-> ファイル生成フラグ - `O_CREAT` `O_TRUNC` `O_EXCL` `O_NOCITY` etc
- カレントファイルオフセット

## ファイルディスクリプタテーブル
- プロセスはファイルディスクリプタテーブルを持ち、
  各ファイルディスクリプタは対応するfile構造体を持つ
- 子プロセスは親プロセスのファイルディスクリプタテーブルを複製するが
  各ファイルディスクリプタは対応するfile構造体は複製されず、同じfile構造体に紐づく
  - 親子プロセスはそのファイルの操作に関して
    file構造体が格納する情報を共有する
- プロセスAが`close`を呼んだ場合、
  プロセスAのファイルディスクリプタテーブルから対象のファイルディスクリプタが消える
  - 対象のファイルディスクリプタに対応するfile構造体も消える
  - プロセスBのファイルディスクリプタテーブルは変更されない

## ファイル操作の不可分性
- 二つのプロセスが同じファイルを操作する際に操作がコンフリクトした場合
  操作Aが完了してから操作Bを行う
  操作Bが完了してから操作Aを行う のいずれかの挙動を取る
  操作Aと操作Bの結果が混ざることはない
