# メモリ配置
- 参照: 詳解UNIXプログラミング第3版 7. プロセスの環境

## テキストセグメント
- CPUが実行する機械語命令群
- 読み取り専用

## 初期データセグメント
- 初期化した変数を置く
  - 関数外で定義されている変数のうち、ユーザーが初期化値を設定するもの
```c
int i = 99;
```

## 非初期化データセグメント(bss)
- プログラムの実行が始まる前に
  カーネルが数値0やNULLポインタに初期化するものを置く
  - 関数外で定義されている変数のうち、カーネルが初期化値を設定するもの
```c
long sum[1000];
```

## スタック
- 関数を呼び出すごとに保存される情報・自動変数を置く
- 関数の呼び出し側は戻りアドレスやマシンレジスタなど
  呼び出し側の環境に関する情報をスタックに保存する
- 呼び出された関数側はその自動変数や一時変数用の場所をスタックに保存する

## ヒープ
- 動的にメモリを割り付ける場所

### 動的メモリ割り付け
- `malloc(3)`
  - 指定したバイト数のメモリを割り付ける
  - 割り付けられた領域の初期値は不定
- `calloc(3)`
  - 指定したサイズのオブジェクト用に指定した個数分の領域を割り付ける
  - 割り付けられた領域は数値0で初期化される
- `realloc(3)`
  - すでに割り付けた領域のサイズを増減する
  - 増やす場合、追加分の場所を確保するためすでに割り付けた領域を解放し、別の場所で領域を確保し直す場合がある
  - 増やす場合、増やした領域の初期値は不定
- `free(3)`
  - 動的にメモリが割り付けられた領域を解放する
  - 解放した領域は利用可能なメモリプールに保管される(カーネルに返さない)

#### 代替えメモリ割り付け関数
- `alloca(3)`
  - ヒープからではなく、今の関数のスタックフレームからメモリを割り付ける
  - `alloca(3)`の呼び出しによってスタックフレームのサイズが増える
  - 関数を抜けると領域は自動的に解放される

## 典型的なメモリ配置
```
コマンド行引数・環境変数
    |
スタック
    |
ヒープ
    |
非初期化データ(bss) - execが自動的に初期化
    |
初期化データ - execがプログラムから読み取る
    |
テキスト
```
