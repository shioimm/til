# ユーザー / グループ
- システム内のすべてのユーザーには一意なログイン名・ユーザーID(UID)が与えられる
- ユーザーは一つ以上のグループに属し、グループにもグループ名・グループID(GID)が与えられる
- UID / GIDはシステムリソームのオーナーを識別することと
  リソースに対するアクセス権限を管理するために使用される

## ユーザー
- システム上の各ユーザーはパスワードファイル`/etc/passwd`に定義される
- 各行は`:`で区切られた7つのフィールドを持つ
- パスワードファイルが持つユーザー情報は`<pwd.h>`に定義される`passwd`構造体としても表現される

### パスワードファイルが持つユーザー情報
- 一意なログイン名(ユーザー名)
- 暗号パスワード
  - 13文字からなる暗号化されたパスワード
  - shadowパスワードを採用したシステムでは`x`埋めされた文字列になっている
    実際の暗号パスワードはshadowパスワードファイル(`/etc/shadow`)に格納される
- UID
  - `0` - スーパーユーザー(`root`)
- GID
  - ユーザーが最初に属するグループ
  - ユーザーが複数のグループに属する場合、
    二つ目以降のグループはシステムグループファイルに記述される
- コメント
- ホームディレクトリ
- ログインシェル

## グループ
- ユーザーの属するグループは、パスワードファイル内のGIDフィールドと
  グループファイル内のログイン名が書かれたエントリによって決まる
- 複数のユーザーをまとめたグループはグループファイル`/etc/group`に定義される
- 各行は`:`で区切られた4つのフィールドを持つ
- グループファイルが持つグループ情報は`<group.h>`に定義される`group`構造体としても表現される

### グループファイルが持つグループ情報
- 一意なグループ名
- 暗号パスワード
  - 使われていない
  - shadowパスワードを採用したシステムでは文字列`x`になっている
    実際の暗号パスワードはshadowパスワードファイル(`/etc/shadow`)に格納される
- GID
- ユーザーリスト
  - グループに属するユーザー(カンマ区切り)

## 補助グループID
- ユーザーはパスワードファイルのエントリのグループIDに対応するグープに所属するだけでなく、
  追加のグループ(補助グループ)に所属できる
  - ファイルアクセス許可は実行グループID・ファイルのグループIDだけでなく
    補助グループID・ファイルのグループIDを比較する

### API
- `getgroups(3)` - 補助グループIDリストを取得
- `setgroups(3)` - 補助グループIDリストを設定
- `initgroups(3)` - 追加のグループアクセスリストの初期化

## 暗号化とユーザー認証
- ユーザー認証を必要とするUNIXアプリケーションは一般的に
  ログイン名・パスワードの組み合わせで認証を行う
  - Ex. ssh / ftp
- UNIXの暗号パスワードは一方向暗号アルゴリズムを採用している
  暗号化された結果文字列から元の文字列に複合することはできない
  - パスワードの照合には、入力文字列を同じ方法で暗号化し
    shadowパスワードファイル内の暗号パスワードと一致するかどうかを照合する
  - 暗号化アルゴリズムは`crypt(3)`にカプセル化されている

### 平文パスワードを暗号化する
- `crypt(3)`関数に最長8文字の平文と2文字のソルトを渡す
- `crypt(3)`関数はDESアルゴリズムによって暗号化される

## 参照
- 例解UNIX/Linuxプログラミング教室P225-269 / P375-432
- Linuxプログラミングインターフェース 2章 / 8章
