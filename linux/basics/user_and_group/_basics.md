# ユーザー / グループ
- 参照: 例解UNIX/Linuxプログラミング教室P225-269 / P375-432
- 参照: Linuxプログラミングインターフェース 2章 / 8章

## TL;DR
- システム内のすべてのユーザーには一位なログイン名・ユーザーID(UID)が与えられる
- ユーザーは一つ以上のグループに属し、グループにもグループ名・グループID(GID)が与えられる
- UID / GIDはシステムリソームのオーナーを識別することと
  リソースに対するアクセス権限を管理するために使用される

## ユーザー
- システム上の各ユーザーはパスワードファイル`/etc/passwd`に定義される
- 各行は`:`で区切られた7つのフィールドを持つ

### ユーザー情報フィールド
- 一意なログイン名(ユーザー名)
- 暗号パスワード
  - 13文字からなる暗号化されたパスワード
  - shadowパスワードを採用したシステムでは`x`埋めされた文字列になっている
    実際の暗号パスワードはshadowパスワードファイル(`/etc/shadow`)に保管される
- UID
  - `0` - スーパーユーザー(`root`)
- GID
  - ユーザーが最初に属するグループ
  - ユーザーが複数のグループに属する場合、
    二つ目以降のグループはシステムグループファイルに記述される
- コメント
- ホームディレクトリ
- ログインシェル

## グループ
- パスワードファイル内のGIDフィールドと
  グループファイル内のログイン名が書かれたエントリによって
  ユーザーの属するグループが決まる
- 複数のユーザーをまとめたグループはグループファイル`/etc/group`に定義される
- 各行は`:`で区切られた4つのフィールドを持つ

### グループ情報フィールド
- 一意なグループ名
- 暗号パスワード
  - 使われていない
  - shadowパスワードを採用したシステムでは文字列`x`になっている
    実際の暗号パスワードはshadowパスワードファイル(`/etc/shadow`)に保管される
- GID
- ユーザーリスト
  - グループに属するユーザー(カンマ区切り)

## ユーザーID / グループID
- プロセスは実効ユーザーID / 実ユーザーID / 保存セットユーザーIDを持つ
  - 実効ユーザーID - そのプロセスを実行したユーザーのユーザーID
  - 実効ユーザーID / 実効グループIDは実ユーザーID / 実グループIDに等しい
- プロセスは実効グループID / 実グループID / 保存セットグループID / 補助グループID群を持つ
  - 実効グループID - そのプロセスを実行したユーザーのグループID
  - 実効ユーザーID / 実効グループIDは実ユーザーID / 実グループIDに等し
- 各ユーザーのユーザーIDとグループIDはパスワードファイル`/etc/passwd`に登録される

## ユーザーID / グループIDの種類
### 実際に誰であるかを示す
- 実ユーザーID
  - そのプロセスを実行したユーザーを表すユーザーID
- 実グループID
  - そのプロセスを実行したユーザーのグループID

### ファイルアクセス許可の検査に使用
- 実効ユーザーID(アクセス許可の可否の検査に使用される)
  - そのプロセスを実行したユーザーを表すユーザーID
- 実効グループID(アクセス許可の可否の検査に使用される
  - そのプロセスを実行したユーザーのグループID↲
- 補助グループID群(アクセス許可の可否の検査に使用される
  - 一つのプロセスを実行したユーザーが複数のグループに所属できるようにするID群

### `access(2)` / `faccessat(2)`
- 実効ユーザーID / 実効グループIDではなく実ユーザーID / 実グループIDでアクセス検査を行う

## セットユーザーID / セットグループID
- 実行可能ファイルに与える特殊な属性
- ファイルのユーザー / グループ以外のユーザーが対象のファイルを操作できるようにする仕組み

### セットユーザーID
- ファイルの実効許可を持つ任意のプロセスが、
  セットユーザーIDが付与されたファイルを実行しようとした時、
  ファイルのユーザーIDが当該プロセスの実効ユーザーIDに置き換わる

### セットグループID↲
- ファイルの実効許可を持つ任意のプロセスが、
  セットグループIDが付与されたファイルを実行しようとした時、
  ファイルのグループIDが当該プロセスの実効グループIDに置き換わる

### セットユーザーIDの実行
- セットユーザーIDされた実行可能ファイルをプロセスがexecで実行するとき、
  プロセスのユーザーIDは以下のように変更される
  - 実ユーザーID
    - プロセスの元の実ユーザーIDのまま
  - 実効ユーザーID
    - 実行可能ファイルの所有者のユーザーIDに置き換えられる
  - 保存セットユーザーID
    - 実行可能ファイルの所有者のユーザーIDに置き換えられる
- グループIDは影響を受けない

### セットグループIDの実行
- セットグループIDされた実行可能ファイルをプロセスがexecで実行するとき、
  プロセスのグループIDは以下のように変更される
  - 実グループID
    - プロセスの元の実グループIDのまま
  - 実効グループID
    - 実行可能ファイルの所有者のグループIDに置き換えられる
  - 保存セットグループID
    - 実行可能ファイルの所有者のユーザーIDに置き換えられる
- 補助グループID群は影響を受けない
