# スレッド
- 参照: 詳解UNIXプログラミング第3版 11. スレッド

## TL;DR
- プロセスは一つのスレッドを持つ(メインスレッド)
- プロセスはスレッドを追加で作成することができる
- 単一スレッド(スレッドベースモデル)
  - 単一のプロセスの中で一つのスレッドが動作する
    -> 各プロセスは一つの処理を担う
- 複数スレッド
  - 単一のプロセスの中で複数のスレッドが動作する
    -> 各プロセスは複数の処理を担う

### スレッドの持つ情報
- プロセス内での実行状況を表現するために必要な情報
  - スレッドID
  - 一連のレジスタ群の値
  - スタック
  - スケジュール優先度と方針
  - シグナルマスク
  - 変数`errno`
  - スレッド固有のデータ
- プロセス内にあるすべてのものはプロセス内のスレッドによって共有される
  - 実行可能プログラムのテキスト部
  - プログラムの大域メモリ・ヒープメモリ・スタック・ファイルディスクリプタ

## スレッドID
- `pthread_t`型 - 構造体でも可
- スレッドIDを表示するポータブルな方法はない
  - `pthread_equal(3)` - スレッドIDの比較
  - `pthread_self(3)` - 自スレッドIDの取得

## スレッドの作成
- `pthread_create(3)`
- スレッド作成後、新しく作成されたスレッドと呼び出し側のスレッドのうち
  どちらが先に動き出すかについては保証がない
- 新しく作成されたスレッドは呼び出し側のスレッドの浮動小数点数環境とシグナルマスクを継承する
  - 保留中のシグナルセットは破棄される

## スレッドの終了
### プロセスの終了
- プロセス内の任意のスレッドで`exit`関数群を呼ぶとプロセス全体が終了する
- プロセスを終了させるシグナルをスレッドに送ると当該プロセス全体が終了する

### スレッドの終了
- スレッドの始動ルーティンから戻る
  - スレッドの脱出コードが返る
- 同一プロセス内の他のスレッドによってキャンセルされる
- スレッドで`pthread_exit(3)`を呼ぶ

#### スレッドの待機
- 呼び出し側スレッドが`pthread_join(3)`を呼ぶ
  - 指定したスレッドが終了するまで世に出し側のスレッドの処理をブロックする
  - 対象スレッドを自動的にデタッチ状態にしてリソースを解放できる
