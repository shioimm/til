# プロセス
- 参照: 例解UNIX/Linuxプログラミング教室P225-269

## TL;DR
- カーネルが提供しているファイル操作の仕組み
  - データの格納・ファイルの名前付け・ファイルの属性の保持・ファイルの整理などの機能
- ハードディスクの中に作られたデータの集まり
  - ファイル、ディレクトリ、属性情報

## ファイル抽象
- UNIXのファイルシステムにおいて多くの対象をファイルとしてみなす
  - ファイル
    - バイト列を格納するファイル
  - ディレクトリ
    - ファイルシステムの構造を作るファイル
  - 文字型特殊ファイル(端末など)
    - 1バイトごとに入出力する装置を表すファイル
  - ブロック型特殊ファイル(ディスクなど)
    - 512バイトごとに入出力する装置を表すファイル
  - シンボリックリンク
    - ファイルを別の名前で参照するためのファイル
  - 名前付きパイプ
    - プロセス間通信を行うためのファイル
  - ソケット
    - プロセス間通信を行うためのファイル

## アクセス制御
- ファイルに対する操作の許可はプロセスの属性とファイルの属性によって決まる
  - プロセスの属性はパスワードファイルに登録される

### プロセスの属性
- ユーザーID(`uid_t`型) - そのプロセスを実行したユーザーのユーザーID
- グループID(`gid_t`型) - そのプロセスを実行したユーザーのグループID

### ファイルの属性
- ユーザーID - そのファイルを作ったプロセスのユーザーID
- グループID - そのファイルを作ったプロセスのユーザーのグループID
- アクセス許可ビット - 誰にどのような操作を許可するかを決める9ビットのビットフラグ
  - 読み・書き・実行
  - 同ユーザーID・同グループID・どちらでもない

## ユーザーID / グループID
- プロセスは複数のユーザーID / グループIDを持ちうる

### ユーザーIDの種類
- 実ユーザーID
  - そのプロセスを実行したユーザーを表すユーザーID
- 実効ユーザーID(アクセス許可の可否の検査に使用される)
  - そのプロセスを実行したユーザーを表すユーザーID
- 保存セットユーザーID

### グループIDの種類
- 実グループID
  - そのプロセスを実行したユーザーのグループID↲
- 実効グループID(アクセス許可の可否の検査に使用される
  - そのプロセスを実行したユーザーのグループID↲
- 補助グループID群(アクセス許可の可否の検査に使用される
  - 一つのプロセスを実行したユーザーが複数のグループに所属できるようにするID群
- 保存セットグループID

### セットユーザーID / セットグループID
- 実行可能ファイルに与える特殊な属性
- ファイルの実効ユーザー / 実効グループ以外のユーザーが
  対象のファイルを操作できるようにする仕組み
  - セットユーザーIDが付与されたファイルが実行されるとき、
    プロセスの実効ユーザーIDがファイル所有者のユーザーIDに置き換えられる
  - セットグループIDが付与されたファイルが実行されるとき、
    プロセスの実効グループIDがファイル所有者のグループIDに置き換えられる

#### セットユーザーIDの実行
- セットユーザーIDされた実行可能ファイルをプロセスがexecで実行するとき、
  プロセスのユーザーIDは以下のように変更される
  - 実ユーザーID
    - プロセスの元の実ユーザーIDのまま
  - 実効ユーザーID
    - 実行可能ファイルの所有者のユーザーIDに置き換えられる
  - 保存セットユーザーID
    - 実行可能ファイルの所有者のユーザーIDに置き換えられる
- グループIDは影響を受けない

#### セットグループIDの実行
- セットグループIDされた実行可能ファイルをプロセスがexecで実行するとき、
  プロセスのグループIDは以下のように変更される
  - 実グループID
    - プロセスの元の実グループIDのまま
  - 実効グループID
    - 実行可能ファイルの所有者のグループIDに置き換えられる
  - 保存セットグループID
    - 実行可能ファイルの所有者のユーザーIDに置き換えられる
- 補助グループID群は影響を受けない
