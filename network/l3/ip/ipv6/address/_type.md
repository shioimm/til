# 種類
- 先頭のビットパターンでIPアドレスの種類を区別する

#### スコープ
- IPv6アドレスの有効範囲を表す概念
  - リンクローカルスコープ - 同一リンク上を有効範囲とする
  - グローバルスコープ - インターネット全体を有効範囲とする

#### ゾーン
- あるスコープを持つ特定のトポロジを表す範囲
  - リンクローカルスコープに対しては、当該リンクとそのリンクに接続されたネットワークインターフェースによって
    一つのゾーンが形成される
  - グローバルスコープに対しては、インターネットに接続された全リンクとネットワークインターフェースによって
    一つのゾーンが形成される
  - インターフェースローカルスコープに対しては、ノード内の各インターフェースによって
    一つのゾーンが形成される (マルチキャストの場合)
  - 上記以外のスコープについては、ネットワーク管理者によってゾーンが定義され、設定される
- 同一のスコープにおいて、あるインターフェースは単一のゾーンに属する
- ゾーン内のパケットがゾーン外に転送されることは禁止

```
<------------------ グローバルなゾーン -------------------->
ホストA ------------------ ルータ ------------------ ホストB
<- リンクローカルなゾーン1 ->  <- リンクローカルなゾーン2 ->
```

- 同じノードが複数のネットワークインターフェースを持っており、それぞれが別のゾーンに属している場合、
  それぞれのネットワークインターフェースに設定されたリンクローカルユニキャストアドレスが同じものでありうる
- あるインターフェースにおけるグローバルスコープ以外のアドレスがどのゾーンに属するものかを
  ノード内で一意に識別するためにゾーンインデックスが用いられる

```
// ゾーンインデックス
// <IPv6アドレス>%<ゾーンごとの一意な文字列>
fe80::1%3
```

## 不定アドレス
- `::/128` (128ビットすべてが0)
- IPv6アドレスが存在しないことを示すための予約値
- どのスコープにも属さない
- IPv6アドレスの割り当てを受ける前の時点にいるノードの送信元IPv6アドレスなどとして利用される
- 未定義アドレスが送信元アドレスになっているパケットをルータが転送することは禁止

## ループバックアドレス
- `::1/128`
- 自分自身を示すIPアドレス
- リンクローカルスコープ
- ループバックアドレスを送信元 / 宛先アドレスになっているパケットをノード外に送信することは禁止

## マルチキャストアドレス
- `ff00::/8` (先頭8ビットがすべて1、次の4ビットがフラグ、さらに次の4ビットがマルチキャストのスコープ)
- 当該ネットワーク上の特定の複数の端末を表す
- いくつかのノード宛にまとめてパケットを送信するときに使用する
- `ff02::1` - 同一リンク内の全ノードを指すマルチキャストアドレスとしてよく使用される
- `ff02::2` - 同一リンク内の全ルータを指すマルチキャストアドレスとしてよく使用される

#### Solicited-Nodeマルチキャストアドレス
- 近隣探索プロトコルで使用されるマルチキャストアドレス

## ユニキャストアドレス
- 1:1の通信で使用するアドレス
- 特定のネットワークインターフェースを指し示す

### リンクローカルユニキャストアドレス
- 同一リンク内で一意なネットワークインターフェースを示すIPv6アドレス
  - ルータを越えることが想定されていない通信で利用される
  - IPv4のリンクローカルアドレスに相当する
- `fe80::/10`

```
1111 1110 10 + 0... (~ 54ビット) + インターフェースID (~ 64ビット)
```

- 初期化時にネットワークインターフェースに設定される場合が多く、ルーティングプロトコルなどで用いられる
- 送信元・宛先のIPv6 アドレスとしてリンクローカルユニキャストアドレスが記載されたパケットは
  ルータによる転送が禁止されている

### グローバルユニキャストアドレス
- インターネット全体の中で一意なネットワークインターフェースを示すIPv6アドレス (IANAによって割り当てられる)

```
グローバルルーティングプレフィクス (nビット) + サブネットID (mビット) + インターフェースID (128 - n - mビット)
```

- グローバルルーティングプレフィックスはISPから割り当てられる
- サブネットIDは組織内などで自由に割り当てる
- インターフェースIDは64ビット長であることが一般的
- `2000::/3`はIANAによって予約されたグローバルユニキャストアドレス

#### ULA (Unique Local IPv6 Unicast Address)
- ユニークローカルユニキャストアドレス

```
プレフィクス (fc00::/7) + L (1ビット: ローカルかどうか) + グローバルID + サブネットID + インターフェースID
```

- 組織内で自由に割り当てられる一意なアドレス
- 異なるネットワーク上のホストと通信できるが、組織内ネットワークでのみ使用される
- 他のネットワーク内のプライベートアドレスと競合する可能性が低い
  (プライベートネットワークを合併してもアドレスが競合しない)

## エニーキャストアドレス
- アドレス構成はユニキャストアドレスと同じ
- ネットワーク上のいずれかのホストとの通信で使用するアドレス
- 複数の端末に同じグローバルユニキャストアドレスを設定し、
  エニーキャストアドレスであることを明示的に設定すると
  エニーキャストアドレスとして動作する

## 参照
- Linuxプログラミングインターフェース 58章
- Software Design 2021年5月号 ハンズオンTCP/IP
- マスタリングTCP/IP 入門編
- パケットキャプチャの教科書
