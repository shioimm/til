# NAPT (Network Address Port Translation / IPマスカレード / PAT)
- アドレス + ポート番号で変換する技術
- ローカルアドレスごとに同じグローバルアドレスの異なるポート番号へ対応づけることにより、
  一つのグローバルアドレスでローカルネットワーク内の複数のローカルアドレスを識別できるようにする
  - e.g.1 - グローバルIPアドレス`198.51.100.xxx:1234` - プライベートIPアドレス`192.168.0.2`
  - e.g.2 - グローバルIPアドレス`198.51.100.xxx:4567` - プライベートIPアドレス`192.168.0.3`
- インターネットへの接続で一般的に利用されている

## NATタイプ (NAPTの方式)
### ConeNAT
- 内部から送信されたパケットのIPアドレスとポート番号はどの宛先に送信しても同じポート番号へ変換される

#### Full cone NAT
- NATが受信したパケットの宛先ポート番号がNAPTによって変換したポート番号に一致する場合、
  内部の送信元のアドレスにフォワードする (送信したことがないアドレスからも受信可能)

#### Address-Restricted cone NAT
- NATが受信したパケットの宛先ポート番号がNAPTによって変換したポート番号に一致し、
  かつパケットの送信元が過去に内部から送信済みのアドレスである場合 (ポート番号が異なっていても良い)
  内部の送信元のアドレスにフォワードする
- 一度送信した宛先 (NATデバイス上に宛先アドレスのエントリが存在する場合) から受信可能

#### Port-Restricted cone NAT
- NATが受信したパケットの宛先ポート番号がNAPTによって変換したポート番号に一致し
  かつパケットの送信元が過去に内部から送信済みのアドレス + ポート番号である場合
  内部の送信元のアドレスにフォワードする
- 一度送信した宛先 (NATデバイス上に宛先アドレス + 送信元ポート番号のエントリが存在する場合) から受信可能

### Symmetric NAT
- 内部から送信されたパケットのIPアドレスとポート番号は宛先に応じて異なるポート番号へ変換される
- 宛先アドレスとポートを用いて接続先を区別し、一つの接続先に対し一つのアドレス変換を用いる

## 参照
- Linuxで動かしながら学ぶTCP/IPネットワーク入門 7
- [「NAT」の仕組みとルーターへの設定方法 ](https://www.atmarkit.co.jp/ait/articles/1512/03/news018.html)
- ハイパフォーマンスブラウザネットワーキング
- [NATあれこれ](https://tech.zms.co.jp/nat%E3%81%82%E3%82%8C%E3%81%93%E3%82%8C/)
