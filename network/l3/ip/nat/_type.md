# 分類
- 同一のルータでダイナミックNATとスタティックNATの両方が設定されている場合は、スタティックNATの設定が優先

### スタティックNAT (静的NAT)
- ローカルアドレスとグローバルアドレスの対応づけを予め設定ファイルに書き込んでおく
- 変換前アドレスと変換後アドレスが1:1で対応する
- 主にLAN側に設置している特定のWebサーバーをインターネットに公開する際に使用される

### ダイナミックNAT (動的NAT)
- 内部からリクエストがある度、ローカルアドレスとアドレスプールから選択されたグローバルアドレスを紐付け、
  それぞれのIPアドレスをキャッシュしておく
  - グローバルアドレスはアドレスプールの中から値の小さい順にその時点で使われていないアドレスを利用する
  - アドレスプール - 使用可能なアドレスの範囲
- 変換前アドレスと変換後アドレスがN:Nで対応する

### NAPT (Network Address Port Translation / IPマスカレード / PAT)
- アドレス + ポート番号で変換する技術
- ローカルアドレスごとに同じグローバルアドレスの異なるポート番号へ対応づけることにより、
  一つのグローバルアドレスでローカルネットワーク内の複数のローカルアドレスを識別できるようにする
  - e.g.1 - グローバルIPアドレス`198.51.100.xxx:1234` - プライベートIPアドレス`192.168.0.2`
  - e.g.2 - グローバルIPアドレス`198.51.100.xxx:4567` - プライベートIPアドレス`192.168.0.3`
- インターネットへの接続で一般的に利用されている

## NATタイプ (NAPTの方式)
### ConeNAT
- 内部から送信されたパケットのIPアドレスとポート番号はどの宛先に送信しても同じポート番号へ変換される

#### Full cone NAT
- NATが受信したパケットの宛先ポート番号がNAPTによって変換したポート番号に一致する場合、
  内部の送信元のアドレスにフォワードする (送信したことがないアドレスからも受信可能)

#### Address-Restricted cone NAT
- NATが受信したパケットの宛先ポート番号がNAPTによって変換したポート番号に一致し、
  かつパケットの送信元が過去に内部から送信済みのアドレスである場合 (ポート番号が異なっていても良い)
  内部の送信元のアドレスにフォワードする
- 一度送信した宛先 (NATデバイス上に宛先アドレスのエントリが存在する場合) から受信可能

#### Port-Restricted cone NAT
- NATが受信したパケットの宛先ポート番号がNAPTによって変換したポート番号に一致し
  かつパケットの送信元が過去に内部から送信済みのアドレス + ポート番号である場合
  内部の送信元のアドレスにフォワードする
- 一度送信した宛先 (NATデバイス上に宛先アドレス + 送信元ポート番号のエントリが存在する場合) から受信可能

### Symmetric NAT
- 内部から送信されたパケットのIPアドレスとポート番号は宛先に応じて異なるポート番号へ変換される
- 宛先アドレスとポートを用いて接続先を区別し、一つの接続先に対し一つのアドレス変換を用いる

---

## 変換対象となるアドレスによる分類
#### SNAT (Source NAT: マスカレード)
- LAN -> インターネット方向の通信におけるNAT
- パケットの送信元をLAN内のプライベートアドレスからルーターのグローバルアドレスへ変換する
- 送信元がプライベートアドレス、送信先がグローバルアドレスであるケースにおいてルーターによって実行される
  - ルーターは送信元のプライベートアドレスとポート番号を書き換え、記録する
  - ルーターは送信先から返ってきたパケットの送信先を送信元のプライベートアドレスとポートへ書き換える
  - アドレスを書き換えるためのルールはルータープロセスにて`iptables(1)`を使用して設定する

#### DNAT (Destination Nat)
- インターネット -> LAN方向の通信におけるNAT
- パケットの送信先をルーターのグローバルアドレスからLAN内のプライベートアドレスへ変換する
  - 「ポートを開ける」
  - 送信先のポート番号が特定の値になっているパケットのみに対して操作を実行する

## 参照
- Linuxで動かしながら学ぶTCP/IPネットワーク入門 7
- [「NAT」の仕組みとルーターへの設定方法 ](https://www.atmarkit.co.jp/ait/articles/1512/03/news018.html)
- ハイパフォーマンスブラウザネットワーキング
- [NATあれこれ](https://tech.zms.co.jp/nat%E3%81%82%E3%82%8C%E3%81%93%E3%82%8C/)
