# IP
- IPアドレスを元に、インターネット全体にパケットを送り届けるためのプロトコル
  - インターネットに接続される全てのホストマシン・ルーターは必ずIP・TCPの機能を実装する
  - インターネットに接続されないブリッジ・リピータ・ハブはIP・TCPの機能を実装する必要はない
    (IPパケットが単なるビット列やフレームとして扱われるため)

#### 機能
- IPアドレスの定義
- ルーティング (送信元から宛先までのパケットの転送)
- IPフラグメンテーション (IPパケットの分割と再構築)

#### 特長
- コネクションレス指向・信頼性を担保しない・ベストエフォート通信 (機能の簡略化と高速化のため)
- IPデータグラムは20-60バイトのヘッダを持ち、宛先ホストのアドレスや送信元のアドレスを扱う

## 送受信バッファ
- ホストマシン・ルーターはIPパケットを送受信するための送信バッファ・受信バッファを持つ
  IPパケットはホストマシン・ルーターの送受信バッファを介して転送される
- ホストマシン・ルーターの送受信バッファの実体はメモリ
- ホストマシン・ルーターの送受信バッファはキュー構造になっている

#### 送受信バッファが存在することの利点
- 伝送速度が異なるネットワークに対応できる
- 送信先が異なるパケットが混在できる
- 処理能力が異なるホストに対応できる
- パケットの流量の変動に対応できる

## IPアドレス
- 終端ノードを示す識別子

#### グローバルIPアドレスの付与
- IPアドレスはICANN/IANAによって全世界的に一元管理される
- ICANN/IANAはアドレスを地域レベルでアドレスを管理するRIR (Regional Internet Registry) に割り振る
- RIRに割り振られたアドレスは小地域レベルでアドレスを管理するLIR (Local Internet Registry)
  もしくはNIR (National Internet Registry) に割り振られる
- LIRもしくはNIRに割り振られたアドレスはISPを介してエンドユーザーに割り当てられる
- LIRもしくはNIRを介さずにユーザーが直接RIRからIPアドレスの割り当てを受けることもある

## IPv4 / IPv6におけるインターネットプロトコルの制御機能

| 機能                                 | IPv4 | IPv6              |
| -                                    | -    | -                 |
| エラーメッセージ、情報メッセージなど | ICMP | ICMPv6            |
| IPアドレスからリンク層アドレスの解決 | ARP  | 近隣探索 (ICMPv6) |
| リンク層アドレスからIPアドレスの解決 | RARP | 近隣探索 (ICMPv6) |
| マルチキャストの機能                 | IGMP | MLD (ICMPv6)      |

## IPv4 / IPv6におけるIPアドレスとDNSキャッシュサーバの自動設定

| プロトコルバージョン | IPアドレスの自動設定    | キャッシュDNSサーバの設定      |
| -                    | -                       | -                              |
| IPv4                 | DHCP                    | DHCP                           |
| IPv6                 | SLAAC                   | ステートレスDHCPv6             |
| IPv6                 | SLAAC                   | Router Advertisementメッセージ |
| IPv6                 | DHCPv6                  | ステートフルDHCPv6             |

## 参照
- Linuxプログラミングインターフェース 58章
- Software Design 2021年5月号 ハンズオンTCP/IP
- マスタリングTCP/IP 入門編
- パケットキャプチャの教科書
- プロフェッショナルIPv6 5
