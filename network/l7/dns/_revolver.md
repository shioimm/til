# 名前解決
1. クライアントが`www.example.com`ドメインにアクセスを試行する
2. DNSクライアント (スタブリゾルバ) -> ローカルDNSサーバ: 問い合わせを送信
3. ローカルDNSサーバ -> ルートサーバ: 問い合わせを送信
4. ローカルDNSサーバ <- ルートサーバ: 応答 (`com`の権限元のDNSサーバ) を送信
5. ローカルDNSサーバ -> `com`の権限元DNSサーバ: 問い合わせを送信
6. ローカルDNSサーバ <- `com`の権限元DNSサーバ: 応答 (`example.com`の権限元のDNSサーバ) を送信
7. ローカルDNSサーバ -> `example.com`の権限元DNSサーバ: 問い合わせを送信
8. ローカルDNSサーバ <- `example.com`の権限元DNSサーバ: 応答 (`www.example.com`の権限元DNSサーバ) を送信
9. ローカルDNSサーバ -> `www.example.com`の権限元DNSサーバ: 問い合わせを送信
10. ローカルDNSサーバ <- `www.example.com`の権限元DNSサーバ: 応答 (IPアドレス) を送信
11. ローカルDNSサーバがDNSクライアントにIPアドレスを返す

#### スタブリゾルバ (DNSクライアント)
- 解決したいドメイン名の問い合わせリクエストをフルリゾルバへ送信するクライアント
- クライアント端末のOSにAPIとして実装
- フルサービスリゾルバやフォワーダに再帰的問い合わせを送信する
- OSのネットワーク設定の「ネームサーバ」欄に利用するフルサービスリゾルバ、フォワーダのIPアドレスを設定する

#### フルリゾルバ (DNSキャッシュサーバ / フルサービスリゾルバ)
- スタブリゾルバからのリクエストに対して実際に名前解決を行うDNSサーバ
  - 名前解決した結果はキャッシュに保存しておき、再利用する
  - DNSを切り替えた後、キャッシュのTTLが切れると切り替えが成立する
  - フルリゾルバは権威サーバへ再帰的にアクセスを行い、最終的にそのドメインの権威サーバへたどり着く
  - フルリゾルバは最初に問い合わせを行うルートサーバの一覧 (ヒントファイル) を持ち、
    最新のルートサーバ一覧を取得する (プライミング)

#### フォワーダ
- スタブリゾルバや別のフォワーダからのリクエストをフルサービスリゾルバや別のフォワーダに転送するリゾルバ

#### 権威サーバ (ネームサーバ / DNSコンテンツサーバ / 権威DNSサーバ)
- リソースレコードを管理するDNSサーバ
- 自身が設置された階層以下のドメインに関する情報を管理する
  - それぞれのドメインの階層ごとに権威サーバが配置される
- ルートサーバ (ルートネームサーバ) - 全てのTLD (.com、.jpなど) のネームサーバ情報を持つ権威サーバ
- 権威サーバは自身が受け持つゾーンのうち、一部の管理を再起的にサブ権威サーバに任せることが可能 (委任)

## 参照
- DNSをはじめよう ～基礎からトラブルシューティングまで～ 改訂第2版
- サーバ・インフラエンジニアの基本がこれ一冊でしっかり身につく本 3.4
- Real World HTTP 第2版
- 実践パケット解析 第3版
- [RubyKaigiとDNS-over-HTTPSとDDR](https://blog.kmc.gr.jp/entry/2023/05/10/165300)
