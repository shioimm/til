# DNS (Domain Name Service)
- ドメイン名をキーとして様々なリソースレコードを引くことができる階層型の分散データベースシステム
  - 正引き - ドメイン名 -> IPアドレス
  - 逆引き - IPアドレス -> ドメイン名
  - 名前解決はUDP、ゾーン転送はUDPとTCPを利用して実装されている

#### ドメイン名から引くことのできるリソースレコード
- SOA
- NS
- A / AAAA
- CNAME
- PTR
- MX
- TXT

## DNSロードバランス
- 一つのドメインに対して複数のAレコードを設定することにより、
  一つのドメインに複数のIPアドレスを割り当てることが可能
  - その場合、ドメインへリクエストが発生した度にレスポンスとなるIPアドレスが変化する
  - この変化を利用して負荷分散を行う(DNSラウンドロビン)

## トラフィックの誘導
- ドメインから他のドメインへマッピングを返すことが可能 (CNAME)
- CNAMEを利用すると他の権威サーバーへDNSリクエストを移譲できる

### Akamai (CDN) の事例
- CDNを利用するサーバーのCNAMEにAkamaiが管理するドメインを指定する
  - サーバーへのDNSリクエストをAkamaiの権威サーバーへ移譲する
  - Akamaiの権威サーバーはリクエスト元の地域に応じてその近隣のキャッシュサーバーのIPアドレスを返す

## SRVレコード
- サービスディスカバリーのために利用できるレコード
  - サービスディスカバリー - 特定の機能を持ったサービスを探し出す機能
- サービスの種別からホスト名を探すために利用される
- AWS ECSはSRVを利用したサービスディスカバリー機能を提供する

### レコード項目
- サービスの種別
- プロトコル (TCP / UDP)
- サービスが稼働するドメイン名
- TTL
- 優先度 (昇順)
- 重み (同じ優先度の中でのアクセスの割合)
- サービスが稼働するポート番号
- 正確に特定可能なホスト名

## IPv4 / IPv6
- IPのバージョンごとに名前空間が独立しないよう、
  名前管理を行っている組織が運営する権威DNSサーバのうちの少なくとも1つずつが
  IPv4パケットでAAAAレコード、IPv6パケットでAレコードを検索できるような設計となっている
- 一つの名前に対してAレコードとAAAAをレコードをそれぞれ得るためには
  DNSサーバへの問い合わせをそれぞれに行う必要がある
- 通信を開始する側のホストがIPv4とIPv6の両方を利用しており、
  かつDNSによる名前解決でIPv4とIPv6両アドレスが取得できた場合、
  通信を開始する側のホストはまずIPv6による通信を試み、
  IPv6による通信ができない状況であれば、IPv4での通信へのフォールバックする

## 内部名 / 外部名
#### In-domain (内部名)
- 権威サーバのホスト名がNSレコードのowner、またはその子孫 (親ゾーンにグルーレコードの設定)

#### Sibling domain (内部名)
- 権威サーバのホスト名が委任元のドメイン名、またはその子孫
- In-domainな内部名を含む

#### Out-of-bailiwick (外部名)
- 内部名以外のホスト名

## 参照
- DNSをはじめよう ～基礎からトラブルシューティングまで～ 改訂第2版
- サーバ・インフラエンジニアの基本がこれ一冊でしっかり身につく本 3.4
- Real World HTTP 第2版
- 実践パケット解析 第3版
- [RubyKaigiとDNS-over-HTTPSとDDR](https://blog.kmc.gr.jp/entry/2023/05/10/165300)
