# 名前解決
1. クライアントが`www.example.com`ドメインにアクセスを試行する
2. DNSクライアント (スタブリゾルバ) -> ローカルDNSサーバー: 問い合わせを送信
3. ローカルDNSサーバー -> ルートサーバー: 問い合わせを送信
4. ローカルDNSサーバー <- ルートサーバー: 応答 (`com`の権限元のDNSサーバー) を送信
5. ローカルDNSサーバー -> `com`の権限元DNSサーバー: 問い合わせを送信
6. ローカルDNSサーバー <- `com`の権限元DNSサーバー: 応答 (`example.com`の権限元のDNSサーバー) を送信
7. ローカルDNSサーバー -> `example.com`の権限元DNSサーバー: 問い合わせを送信
8. ローカルDNSサーバー <- `example.com`の権限元DNSサーバー: 応答 (`www.example.com`の権限元DNSサーバー) を送信
9. ローカルDNSサーバー -> `www.example.com`の権限元DNSサーバー: 問い合わせを送信
10. ローカルDNSサーバー <- `www.example.com`の権限元DNSサーバー: 応答 (IPアドレス) を送信
11. ローカルDNSサーバーがDNSクライアントにIPアドレスを返す

#### スタブリゾルバ (DNSクライアント)
- 解決したいドメイン名の問い合わせリクエストをフルリゾルバへ送信する
- クライアント端末のOSにAPIとして実装
- フルサービスリゾルバやフォワーダに再帰的問い合わせを送信する
- OSのネットワーク設定の「ネームサーバー」欄に利用するフルサービスリゾルバ、フォワーダのIPアドレスを設定する

#### フォワーダ
- スタブリゾルバや別のフォワーダから受け取った問い合わせを
  フルサービスリゾルバや別のフォワーダに転送するリゾルバ

#### フルリゾルバ (DNSキャッシュサーバー / フルサービスリゾルバ)
- スタブリゾルバから送信されるリクエストに対して、リソースレコードをネームサーバーに問い合わせを行うサーバー
  - 名前解決した結果はキャッシュに保存しておき、再利用する
  - フルリゾルバは自分よりも更に上位のサーバーへ再帰的にアクセスを行い、
    最終的にそのドメインの権威サーバーへたどり着く

#### 権威サーバー (ネームサーバー / DNSコンテンツサーバー / 権威DNSサーバー)
- リソースレコードを管理するホストやソフトウェア
- 自身が設置された階層のドメインに関する情報を管理する
  - それぞれのドメインの階層ごとに権威サーバーが配置される

#### ルートサーバー (ルートネームサーバー)
- 全てのトップレベルドメイン (.com、.jpなど) のネームサーバー情報を持つサーバー

#### 委任
- 各ネームサーバーが受け持つゾーンのうち、一部を他のネームサーバーに任せること
- ゾーンを委任されたネームサーバーはそのドメインについて権威を持つ
  - サブドメインを作った受け持つゾーンのうちその一部を更に他のネームサーバーに委任することができる

#### TTL
- 名前解決のキャッシュ保持時間
- DNSを切り替えた後、TTLが切れると切り替えが成立する -> DNSが浸透する

#### DNSゾーン
- DNSサーバーが管理を任された名前空間 (DNS名のグループ)
- 一つのゾーンファイル (DB) で管理するドメイン名の範囲

#### ゾーン転送
- 通常冗長化を行う目的で2つの機器 (サーバー) の間でゾーンデータを転送する際に発生する
- ゾーン内のプライマリDNSコンテンツサーバーのゾーンファイルを
  セカンダリDNSコンテンツサーバーに同期することで冗長化を図る仕組み
- バージョン確認 - セカンダリサーバーがプライマリサーバーへSOAレコードを要求すること (UDP)
- 完全ゾーン転送 - 機器間でゾーン全体を転送する
- 増分ゾーン転送 - ゾーン情報の一部のみを転送する

## 参照
- DNSをはじめよう ～基礎からトラブルシューティングまで～ 改訂第2版
- サーバ・インフラエンジニアの基本がこれ一冊でしっかり身につく本 3.4
- Real World HTTP 第2版
- 実践パケット解析 第3版
