# 暗号化方式
## ブロック暗号アルゴリズム
- 特定のビット数のまとまり(ブロック)を一度に処理する暗号アルゴリズム
- ブロック長単位で処理が完了するため、どこまで暗号化されたかを管理するための内部状態を持たない
- データ攪拌部と鍵生成部から構成される

### パディング
- 平文がブロック長に満たない場合、ブロック長に足りない部分に特定のデータを埋め込む
  - パディングは暗号化と復号いずれの処理でも一意である必要があるため、標準的に規定されたパディング方式を利用する
  - パディング方式は暗号文の送信者から受信者へ知らされる

#### パディングオラクル攻撃
- 攻撃者は受信者(サーバー)に対し、パディング内容を少しずつ変化させて暗号文を何度も送信する
- 攻撃者はサーバーが正しく復号できなかった場合に返すエラーから平文の一部を得ようとする

### 暗号化利用モード
- 1ブロック以上の平文を暗号化する際、ブロック暗号化を繰り返し適用する(モード = 繰り返しの方法)
  - 平文ブロック - ブロック暗号アルゴリズムで暗号化の対象となる平文
  - 暗号文ブロック - ブロック暗号アルゴリズムを使って平文ブロックを暗号化した暗号文

#### ECBモード
- 一つ一つの平文ブロックを個別に暗号化し、個別に復号する
- 暗号文ブロック同士を入れ替えることで暗号を解読しなくても平文を改竄できてしまう

#### CBCモード
- 一つ前の暗号文ブロックと平文ブロックのXORを取り、暗号化したものを暗号文ブロックとする
  - 最初の平文ブロックを暗号化する際は一つ前の暗号文ブロックの代わりに初期化ベクトル(IV)を使う
    - IV(Initialization Vector) - 毎回異なる1ブロック分のランダムなビット列
    - 予測可能なIVに対してはビット反転による改竄がが可能

#### CFBモード
- 一つ前の暗号文ブロックを暗号化し、平文ブロックとのXORを取ったものを暗号文ブロックとする
  - 最初の平文ブロックを暗号化する際は一つ前の暗号文ブロックの代わりに初期化ベクトル(IV)を使う
- CFBモードは、鍵ストリームを利用して平文のデータを1ビットずつ暗号化するに等しい
  - 鍵ストリーム - 一つ前の暗号文ブロックを暗号化してできたビット列
- 攻撃者が暗号文ブロックを過去の暗号文ブロックへすり替える再生攻撃が可能
- パディング不要

#### OFBモード
- 一つ前の暗号アルゴリズムの出力と平文ブロックのXORを取ったものを暗号文ブロックとする
- 一つ前の暗号アルゴリズムの出力を次の暗号アルゴリズムの入力とする
  - 最初の暗号アルゴリズムの入力の代わりに初期化ベクトル(IV)を使う
- 暗号文ブロックのビットを反転させることで複合化した時の平文ブロックのbittogahantendekiteshimau
- パディング不要

#### CTRモード
- ブロックを暗号化するごとに一つずつ増加していくカウンタを暗号化し、鍵ストリームを作り出す
  - カウンタ = nonce(暗号化のたびに異なる値) + ブロック番号(カウントアップする)
  - カウンタの初期値はnonceを元にしてつくる
- カウンタを暗号化したビット列と平文ブロックとのXORを取った結果を暗号文ブロックとする
- 暗号文ブロックのビットを反転させることで複合化した時の平文ブロックのbittogahantendekiteshimau
- パディング不要

## ストリーム暗号アルゴリズム
- データの流れ(ストリーム)を順次処理する暗号アルゴリズム
- どこまで暗号化されたかを管理するための内部状態をもつ
- 擬似乱数生成器が生成する乱数(鍵ストリーム)を使い、1ビット単位で鍵ストリームと平文のXORを取ることにより暗号化する
- 鍵ストリームの各バイトがどの位置にあるかを攻撃者に予測されなければ安全

## 参照
- プロフェッショナルSSL/TLS
- マスタリングTCP/IP 情報セキュリティ編
- 暗号技術入門 第3版
