# モバイルネットワーク
## モバイルネットワークの世代
| 世代 | データ転送速度 | レイテンシ | 解説                                                         |
| -    | -              | -          | -                                                            |
| 1G   | データ転送なし | -          | アナログシステム                                             |
| 2G   | 100-400Kbit/秒 | 300-1000ms | アナログシステムと重複or並行して運用されるデジタルシステム   |
| 3G   | 0.5-5Mbit/秒   | 100-500ms  | アナログシステムと並行して運用される専用デジタルネットワーク |
| 4G   | 1-50Gbit/秒    | < 100ms    | デジタル、パケットのみのネットワーク                         |

## RRC
- Radio Resource Controller
- 各デバイスの電波状況やその他の状態変数の管理とスケジューリングを行う機能
  - いつ誰がデータを送信するか、どの帯域を割り当てるか、どの程度の強度の信号を受信するかなど
  - レイテンシ・スループット・バッテリー持続時間に直接影響を与える
- ワイヤレスチャネル上でデータを受信する際は、RRCに問い合わせて電波リソースを割り当てる
- インターネットからデータを受信する際にはそのデータが到着するタイミングをRRCが通知する

### RRCの特徴
- ワイヤレス規格はネットワーク上のデバイスが取りうる状態を表現するステートマシンを定義する
- RRCステートマシンはワイヤレス規格によって異なる
- RRCステートマシンは無線ネットワークによって管理される
- RRC高出力状態への遷移はデータが送受信されなければならないときに発生する
- RRC省電力状態への遷移はネットワークによって設定されたタイムアウトにより発生する
- 全てのネットワーク送受信はその大きさに関わらず無駄な電力消費が発生する

## ネットワークワークフローの基本
1. 基幹ネットワークと外部ネットワークを接続するP-GW(パケットゲートウェイ)にデータが到着する
    - デバイスが通信事業者のネットワークに接続されている時、
      デバイスのIPアドレスはP-GWによって割り当てられ管理される
2. P-GWでルーティングが行われ、パケットポリシーが適用される
3. データはP-GWから一つ以上のS-GW (Serving Gateway) にルーティングされる
    - S-GWは無線ネットワーク内でデバイスをつなぐ役割を持つ
4. MIME (Mobility Management Entity) が認証・課金・提供サービスの確認・ユーザー位置情報の確認を行う
    - MIMEはネットワーク上の全てのユーザーの状態を管理する実質的なユーザーデータベース
5. 無線ネットワーク内のユーザーの位置の確認が取れ次第、データはS-GWから該当する基地局にルーティングされる
6. 基地局はターゲットデバイスに必要なリソースの割り当てとネゴシエーションを行い、
   無線インターフェースでデータを配信する

## モバイルネットワークの最適化
- バッテリー消費量を抑える
  - 無線機能はバッテリーを消耗させる
  - 無線出力の要件は規格の世代が進むほど上がる
  - 無線はディスプレイに続いて2番目に大きい電力を消費する
  - 無線のエネルギー消費量とデータ転送量は比例しない
  - アプリケーションは無線がアクティブ状態のときに転送するデータ量を最大化し、
    追加のデータ送信を行う回数を最小化する
- 非効率な定期的データ送受信を排除する
  - ポーリングはモバイルネットワークにおいてコスト高であるため必要時以外使用しない
  - 可能であればプッシュ通知を使用する
  - データの送受信は結合し、まとめる
  - 重要度の低いリクエストは電波がアクティブになるまで控える
- 不要なアプリケーションのKeep-Aliveを排除する
- ネットワークレイテンシのオーバーヘッドを予想する
  - 制御プレーン + DNSルックアップ + TCPハンドシェイク + TLSハンドシェイク + HTTPリクエスト
- ユーザーインタラクションとネットワークコミュニケーションを非同期化する
- ネットワークの変化に対応する
  - 現在の接続状態を把握し、その時点で有効なリクエスト戦略を利用する
  - ネットワーク状態データをキャッシュしない
  - 一時的なエラーに備えて再送戦略を利用する
  - リクエストのリトライにバックオフアルゴリズムを使用する
  - オフライン時、送信リクエストを保存し、後で送信する
  - HTML5 AppCacheやlocalStorageを利用する
- バースト的に送受信し、アイドル状態へ戻る
  - できるだけ多くのデータをできるだけ早くダウンロードし、無線インターフェースをアイドル状態に戻す
- WiFiネットワークへオフロードさせる

## 参照
- ハイパフォーマンスブラウザネットワーキング
