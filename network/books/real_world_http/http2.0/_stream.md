# Real World HTTP 歴史とコードに学ぶインターネットとウェブ技術 まとめ
- 渋川よしき 著

### ストリームによる通信の高速化
- TCP接続
  - HTTP/1.1まで
    - 一つのリクエストがTCPのソケットを占有する
    - 一つのオリジンサーバーに対して複数のTCP接続を行い並列化する
  - HTTP/2
    - 1本のTCP接続の内部にストリーム(擬似的なTCPソケット)を作って通信を行う
    - ストリームはハンドシェイクが不要
    - 並列化が容易
    - それぞれ接続状態のステートマシンが定義される
    - TCP
      - クローズ状態からLISTENし、クライアントからの接続リクエストによりESTABLISH状態になる
    - HTTP/2のストリーム
      - 最初からIDLE(LISTENとほぼ同じ)状態で、ヘッダーを受け取ると即座に通信可能なOPENになる
```
// 各フレームの共通ヘッダー
- Length -> ペイロードのサイズ
- Type -> フレームの種類
- Flags
- R -> 予約領域
- Stream Identifier -> ストリームの識別子 / 同じ数値なら同じストリームの関連フレーム
  - 同じStream Identifierを持つ一連のフレームが受信時にグループ化され「同じストリームから出て来たデータ」として扱われる
  - 奇数はクライアント -> サーバー / 偶数はクライアント <- サーバー
- Frame Payload -> フレームの実データ
```
```
// フレームの種類
- HEADERS -> ヘッダー
- DATA -> データ
- PRIORITY -> 依存するストリーム、優先度、排他フラグ
- SETTINGS -> エラーコード
- PUSH_PROMISE -> 識別子、設定値の組
- PING -> 8バイト分のデータ
- GOAWAY -> 最終ストリームID、エラーコード
- WINDOW_UPDATE -> ウィンドウサイズ
- CONTINUATION -> HEADERS、PUSH_PROMISEの続きのデータ
```

### フローコントロール
- HTTP/2はアプリケーション層にありつつトランスポート層の特徴を内部に持っている
```
OSI参照モデル
7.  アプリケーション層
6.  プレゼンテーション層
5.  セッション層
4.  トランスポート層
3.  ネットワーク層
2.  データリンク層
1.  物理層
```
- フローコントロール -> ストリームを効率よく流すために用いられる通信量の制御処理
  - 速度差が大きい機器同士の組み合わせで、速い方が遅い方が処理しきれないほどのパケットを送信することを防ぐ
  - 通信先のウィンドウサイズ(受け取ることができる空きバッファサイズ)の管理によって行う
  - SETTINGSフレームによって速度に関するパラメータをチューニングする
