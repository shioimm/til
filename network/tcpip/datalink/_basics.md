# データリンク層
- ネットワークの物理リンク上へフレームを送信し、宛先からの確認応答を受信する
  - ネットワーク層からのデータグラムをフレーム単位にカプセル化して送受信する
- 送信時には各フレームの宛先アドレス・フレームサイズをヘッダとして付加する
  - フレームサイズ上限をMTU(最大転送ユニット)という
  - MTUの最大値はPath MTU Discovery技術(内部的にICMPを使用する)によって探索される
- 物理層で発生した誤りを検出したり、訂正したりする
  - 送信元はビットストリームを不連続なフレームに区切り、フレームごとにチェックサムを付与する
  - 送信先はビットストリームを不連続なフレームに区切り、フレームごとにチェックサムを再計算する

### 副層
#### MAC層(Media Access Control: 媒体アクセス制御層)
- EthernetやFDDIなどのデータリンクごとに決まっているヘッダや制御

#### LLC層(Logical Link Control: 論理リンク制御層)
- データリンクの違いによらず共通になっているヘッダや制御

## ブリッジ(L2スイッチ)
- データリンク層でネットワーク同士を接続する機器
  - 物理アドレス(MACアドレス)で処理を行う
- ブリッジはフレームの転送及びフォワーディングテーブルの保持・更新を行う
- Ethernetで使用されるスイッチングハブはブリッジの一種
  - ケーブルを接続するポートが全てブリッジになっているかのように機能する

### フォワーディングテーブル
- ブリッジの各ポートとポートに接続された各ネットワーク機器のMACアドレスの対応表
- データリンク層の各通過点はパケットを受け取った際、
  そのパケットの送信元MACアドレスとインターフェースの組み
  フォワーディングテーブルに書き込み、一定時間保持する

### 動作の仕組み
1. ブリッジはフレームを受信し、ブリッジ内部のメモリに一旦蓄積する
2. ブリッジはフレームの送信先MACアドレスを読み取り、フォワーディングテーブルを利用して送信先を確認する
3. ブリッジは該当MACアドレスを持つ機器の接続されたポートに向かってフレームを送信する
- ブロードキャスト通信においては、同じブリッジが担う範囲において複数のネットワーク機器へフレームを送出する
 データリンク層のハードウェアはフロー制御の必要がない程度に十分に早く動作するよう設計される

### スパニングツリー
- ブリッジ間の通信のループを検出し、解消する機能

### リンクアグリゲーション
- LANスイッチ間を複数のリンクで接続することで耐障害性の向上と高速化を図る仕組み

### LLDP
- ネットワークに接続されている機器の情報を収集する仕組み
  - ネットワーク機器は自身のホスト名や機器情報、ポート・インターフェース情報を
    定期的にマルチキャストMACアドレスへ送信する
  - 情報を収集する機器はLLDPパケットを受信することで情報を収集する

## MACアドレス
- データリンクに接続しているノードを識別するための48ビットのアドレス
  - 物理的なNICの場合はROMに焼き込まれている
  - 位置情報を含まず、機器の電源投入時に自動的にROMから読み込まれて設定される

### アドレスフォーマット
- 1ビット - ユニキャストアドレス(0) or マルチキャストアドレス(1)を示すビット
- 2ビット - ユニバーサルアドレス(0) or ローカルアドレス(1)を示すビット
- 3~24ビット - IEEEがベンダごとに重複しないよう管理するアドレス(ベンダ識別子
- 25~48ビット - ベンダが製品ごとに重ならないようにするアドレス

## 誤り検出・訂正戦略
- ブリッジはフレームに含まれるFCS(Frame Check Sequence)フィールドでフレームの誤りを検出し、
  壊れたフレームを他のセグメントへ送信しないようにする

#### 誤り率が低く再送コストが低い場合(光ファイバなど):
- 誤り検出符号をチェックサムとして付与する
  - ハミング符号
  - 2乗畳み込み符号
  - リード・ソロモン符号
  - 低密度パリティ検査符号

#### 誤り率が高く再送コストが高い場合(無線リンクなど):
- 誤り訂正符号をチェックサムとして付与する
  - パリティ
  - チェックサム
  - 巡回冗長検査(CRC)

## 通信種別
- ユニキャスト - 1:1通信
- マルチキャスト - 複数ノードへ一斉同報
- ブロードキャスト - 特性のネットワーク内の全ノードへ一斉同報
- エニーキャスト - 同じIPアドレスを持つ複数ノードへ一斉同報

## ネットワークの接続形態
### 媒体共有型ネットワーク
- 通信媒体を複数のノードで共有するネットワーク
- 同じ通信路を利用してデータの送受信する制御も行う
  - 半二重通信(送信している間は受信できず、受信している間は送信できない通信)
  - 通信の優先権を制御する仕組みが必要

### 媒体共有型ネットワークの実装方式
- CSMA方式 - 同じ通信媒体を共有するノード同士でデータの送信権を競争で奪い取る方式
- CSMA/CD方式 - CSMA方式を改良し、衝突を早期に検出して素早く通信路を解放する制御を加えた方式
- トークンパッシング方式 - トークンパケットを巡回させ、トークンによって送信権を制御する方式

### 媒体非共有型ネットワーク
- ノード同士で通信媒体を共有せずにそれぞれ専有する方式
- ノードはスイッチに直接接続され、スイッチがフレームを転送する
  - 全二重通信(送信と受信を同時に行える通信)
  - 衝突が発生しないため効率良く通信可能
  - スイッチに高度な機能を持たせることにより仮想的なネットワークの構築やデータ流量の制御も可能
  - スイッチ技術をEthernetなどでも利用できるようにした機器 - スイッチングハブ・Ethernetスイッチ
    - Ethernetスイッチは複数のポートを持ったブリッジに等しい

## VLAN(Virtual LAN)
- 物理的なネットワーク接続とは別に仮想的なLANセグメントを構成する技術
  - スイッチの接続ポート、MACアドレス、プロトコルなどに応じてLANセグメントを分離することにより、
    ネットワークの配線を変えずにネットワーク構成を変えることができる
  - VLAN技術を利用できるブリッジ(スイッチ)を使用する

## 参照
- Linuxプログラミングインターフェース 58章
- サーバ・インフラエンジニアの基本がこれ一冊でしっかり身につく本 2.8-9
- Linuxで動かしながら学ぶTCP/IPネットワーク入門 4.5
- コンピュータネットワーク
- マスタリングTCP/IP 入門編
