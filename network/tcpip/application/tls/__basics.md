# SSL/TLS
- SSL(Secure socket layer)
  - クライアント-サーバー間で間で機密情報を送信するため、インターネット接続を安全に行う技術
- TLS(Transport layer security)
  - より安全なSSLの上位互換バージョン
- HTTPS (Hyper text transfer Protocol SECURE)
  - SSL/TLSで保護されたデータの転送に使用されるHTTPプロトコル(HTTP + SSL/TLS)

#### 目標
1. 暗号学的なセキュリティ(Cryptographic security)
    - 情報を交換しようとする二者間で安全な通信ができるようにする
2. 相互運用性(Interoperability)
    - 独立して開発されたプログラム間でも同じパラメータを使って暗号通信ができるようにする
3. 拡張性(Extensibility)
    - フレームワークとして提供することによりプロトコルは変更せず個別の新しい要素技術に対応できるようにする
4. 効率性(Efficiency)
    - コストがかかる暗号処理を最小限にし、後続のセッションでの再計算を避けるキャッシュ方式を用意する

#### 技術的要素
- 暗号化 -> 盗聴防止
- ハッシュ化 -> 改竄防止
- デジタル証明書 -> なりすまし防止

| フェーズ         | 技術           | 役割                           | 種類                         |
| -                | -              | -                              | -                            |
| 事前準備         | 公開鍵暗号方式 | 共通鍵の素を配送               | RSA, DH/DHE, ECDH/ECDHE      |
| 事前準備         | デジタル署名   | 認証局による認証               | RSA, DSA, ECDSA, DSS         |
| 暗号化データ通信 | 共通鍵暗号方式 | アプリケーションデータの暗号化 | 3DES, AES, AES-GCM, Camellia |
| 暗号化データ通信 | MAC            | 改竄・なりすましの検知         | SHA-256, SHA-384             |

## 特徴
- [OSI参照モデル] セッション層で動作し、アプリケーション層のプロトコルと組み合わせて使用される
- [TCP/IPプロトコル] アプリケーション層で実装され、TCPの直接の上位層で動作する
  - アプリケーション層の動作に影響を与えることなくネットワーク通信時の安全性を提供する
- 433番ポートで受信したデータは暗号化されているとみなされ、
  受信側のSSLサーバーにて復号してアプリケーションに渡される
- 最も広く使用されているSSLライブラリはOpenSSL
  - その他LibreSSL、GnuTLS、NSS

### TLSが提供する機能
- 盗聴対策 - ハイブリッド暗号方式による情報の内容の暗号化
- 改竄対策 - MAC関数による改竄検知
- なりすまし対策 / 否認対策 - デジタル署名による通信相手の認証

## HTTP/2における仕様
- TLS1.2以上
- TLS SNIのサポート
- 圧縮機能無効化 -> HTTP/2自身が圧縮を行う
- 再ネゴシエーション禁止 -> クライアント証明書の要求はコネクションプリフェイス前に実行される必要がある
- 暗号スイート
  - `TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256`をサポート
  - 仕様で禁止されている暗号スイートの使用禁止

### 暗号スイートの条件が合わない場合
- `INADEQUEATE_SECURITY`エラーコネクションによって切断される場合がある -> コネクションエラー
  - ALPNネゴシエーションと暗号スイートの選択が独立して行われるため、
    暗号スイートの条件が一致しない場合がある

## 参照
- [How is data secure over https?](https://blog.joshsoftware.com/2019/08/23/how-is-data-secure-over-https/)
- よくわかるHTTP/2の教科書P18-20/124-125
- SSLをはじめよう ～「なんとなく」から「ちゃんとわかる！」へ～
- [図解で学ぶネットワークの基礎：SSL編](https://xtech.nikkei.com/it/article/COLUMN/20071002/283518/)
- ハイパフォーマンスブラウザネットワーキング
- 食べる！SSL！　―HTTPS環境構築から始めるSSL入門
- 暗号技術入門 第3版
- パケットキャプチャの教科書
