# 電子メール
### 電子メールの構成要素
- メールアドレス
- データ形式
  - MIME
- 転送プロトコル
  - SMTP - 送信ホストからメールサーバーまで電子メールを配送するプロトコル
  - POP / IMAP - 受信ホストがメールサーバーから電子メールを受け取るプロトコル

## SMTP
- Simple Mail Transfer Protocol
- 一つのTCPコネクションを確立し、その上で制御・応答・メッセージの転送を行う
  - ポート番号25を利用する
  - クライアントはテキストコマンドで要求を出す
  - サーバーは3桁のステータスコードで応答を返す
  - クライアント・サーバー双方のメッセージの最後には改行文字が付加される
- SMTPは認証の仕組みを持っておらず、迷惑メールなどの悪用が比較的容易に可能

### 迷惑メール対策の仕組み
#### 送信元ユーザーを認証する仕組み
- POP before SMTP
  - メール送信前にPOPによるユーザー認証を行う
- SMTP認証
  - メール送信時にSMTPサーバーでユーザー認証を行う(SMTPの拡張)

#### 送信元ドメインを認証する仕組み
- SPF(Sender Policy Framework)
  - 送信元メールサーバーのIPアドレスをDNSサーバーに登録しておく
  - 受信したメールのIPアドレスと送信元メールサーバーのIPアドレスを比較検証する
- DKIM(DomainKeys Identified Mail)
  - 送信元メールサーバーで電子署名を付与し、受信側で電子署名を認証する
    - 送信元メールサーバーで署名に利用する公開鍵をDNSサーバーに登録しておき、
      受信側が公開鍵を取得して署名を認証する
- DMARK(Domain bsaed Message Authentication, Reporting and Conformance)
  - SPFやDKIMにおいて、認証が失敗した時のメールの取り扱いについて
    送信者がDNSサーバーに登録して公開する

## POP
- Post Office Protocol
- ユーザー認証を行い、POPサーバーに保存されたメールを取得する
- 電子メールの管理はクライアント側で行う
- 一つのTCPコネクションを確立し、その上で制御・応答・メッセージの転送を行う
  - クライアントはテキストコマンドで要求を出す
  - サーバーは3桁のステータスコードで応答を返す
  - クライアント・サーバー双方のメッセージの最後には改行文字が付加される

## IMAP
- Internet Message Access Protocol
- ユーザー認証を行い、IMAPサーバーに保存されたメールを取得する
- 電子メールの管理・MIMEの処理はサーバー側で行う

## 参照
- マスタリングTCP/IP 入門編
