# TCP/IPプロトコルスイート
- 現在主流のインターネットワークプロトコル
- 「インターネット」はTCP/IPのインターネットワーク
- ホスト - IPアドレスが付けられており、経路制御を行わない機器
  - ネットワークの終端端末
- ルーター - IPアドレスが付けられており、経路制御を行う機器
  - 異なるEthernetネットワークを繋ぎ、IPパケットを転送する
- ノード - ホストとルーターの総称

## レイヤ

| 階層               | 送信データ                  | 形態                       | メモリ領域   |
| -                  | -                           | -                          | -            |
| アプリケーション層 | アプリケーションデータ      | アプリケーションプログラム | ユーザー空間 |
| トランスポート層   | TCPセグメント, データグラム | OS                         | カーネル空間 |
| ネットワーク層     | IPデータグラム              | OS                         | カーネル空間 |
| データリンク層     | データフレーム              | デバイスドライバ           | ハードウェア |

- トランスポート層ではアプリケーション層間の通信を`SOCK_STREAM` / `SOCK_DGRAM`によって行う
- 物理層ではデバイスとしてリピータ・ハブを利用してビットを伝送する

### 物理層
- `0`と`1`を電圧の高低や光の点滅に変換する
- コネクタやケーブルの形状を規定する

#### ネットワーク機器

| 機器                   | 必要とするレイヤ | 役割                                                         |
| -                      | -                | -                                                            |
| NIC                    | 物理層           | コンピュータをネットワークに接続する                         |
| リピータ・リピータハブ | 物理層           | ネットワークの延長(0と1の波形を整形して転送する)             |
| ブリッジ(L2スイッチ)   | データリンク層   | ネットワークの延長(フレームを識別し、再構成して転送する)     |
| ルーター(L3スイッチ)   | ネットワーク層   | パケットの転送(ネットワーク全体の経路を判断し宛先へ転送する) |
| L4-7スイッチ           | トランスポート層 | トランスポート層より上の情報でトラフィックを処理する         |
| ゲートウェイ           | トランスポート層 | トランスポート層より上の情報でプロトコルを変換する           |

#### NIC
- Network Interface Card(LANカード / Ethernetカード)
- ノードやスイッチ、ルータのIPアドレスを持つ物理デバイス

### データリンク層(ネットワークインターフェース層)
- 同じ種類のデータリンクで接続されているノード間の通信を実現する役目を担う
  - データフレームの識別と転送を行う
  - ビット列を意味のある固まり(フレーム)に分けて相手に伝える

#### デバイスドライバ
- OSとハードウェアの橋渡しを行うソフトウェア

#### データリンク層のサービス例
- 確認通知なしコネクションレスサービス(Ex. Ethernet)
- 確認通知付きコネクションレスサービス(Ex. IEEE802.11(WiFi))
- 確認通知付きコネクション指向サービス
- ARP(IPv4)、NDR(IPv6)

### ネットワーク層(インターネット層)
- 終端ノード間の通信を実現する(宛先までデータを届ける)役目を担う
  - アドレスの管理と経路の選択を行う
  - 通信経路になっているデータリンクの違い(MTUなど)を抽象化し、
    異なるデータリンク同士でも連携を取りながらパケットを配送する

#### ネットワーク層のサービス例
- IP、ICMP、DHCP
  - インターネットはインターネット層の機能を備えたネットワーク

### トランスポート層
- 両端ノード間のデータ転送の管理を行う
- データ転送の信頼性を提供する

#### トランスポート層のサービス例
- UDP、TPC、SCTP、DCCP

### アプリケーション層
- 利用されるアプリケーションの中で通信に関する部分を定めているもの(OSI: アプリケーション層)
- データ表現形式を管理する(OSI: プレゼンテーション層)
  - アプリケーションが扱う情報を通信に適したデータ形式に変換する
  - 下位層から来たデータをアプリケーションが取り扱うデータ形式に変換する
- 通信の管理を行う(OSI: セッション層)
  - コネクションの確立・切断
  - トランスポート層以下の層の管理

#### アプリケーション層のサービス例
- HTTP、SMTP、POP、IMAP、MIME、TELNET、SSH、FTP、DNS、SSL/TLS、SMTP etc

#### WWW(World Wide Web)
- インターネットアプリケーション
  - HTTP - WWWにおけるアプリケーション層のプロトコル
  - HTML - WWWにおけるプレゼンテーション層のプロトコル

## データリンクを流れるパケットの状態
```
| Ethernetヘッダ | IPヘッダ | TCP/UDPヘッダ | アプリケーションヘッダ・データ | Ethernetトレイラ |
```

- Ethernetヘッダ(データリンク層)
  - 宛先MACアドレス
  - 送信元MACアドレス
  - Ethernetタイプ - ネットワーク層のプロトコルの種類を示す
- IPヘッダ(ネットワーク層)
  - 送信元IPアドレス
  - 宛先IPアドレス
  - プロトコルタイプ - トランスポート層のプロトコルの種類を示す
- TCP/UDPヘッダ(トランスポート層)
  - 送信元ポート番号
  - 宛先ポート番号
    - 送信元・宛先のうちいずれかサーバー側のポート番号がアプリケーション層のプロトコルの種類を示す
- アプリケーションヘッダ・データ(アプリケーション層)
- Ethernetトレイラ(データリンク層)
  - FCS

## 参照
- Linuxプログラミングインターフェース 58章
- サーバ・インフラエンジニアの基本がこれ一冊でしっかり身につく本 2.8-9
- Linuxで動かしながら学ぶTCP/IPネットワーク入門 4.5
- コンピュータネットワーク
- マスタリングTCP/IP 入門編
