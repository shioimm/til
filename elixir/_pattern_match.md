# パターンマッチ
- プログラミングElixir 第2章 / 第5章

## TL;DR
- `パターン = 値` - 値に対してパターンを等しくする方法を探す

```exs
# パターンマッチする場合: パターンに値がセットされる

# 変数aに数値1が束縛される
a = 1 # => 1

# 変数aに数値1が束縛されているためマッチするケース
1 = a # => 1

# 変数aに数値2が束縛されていないためマッチしないケース
2 = a # => ** (MatchError) no match of right hand side value: 1
```

## パターンマッチの条件
- パターンに対して値が同じ構造を持ち、
  パターンのそれぞれの項が値の中の対応する項と等しい
  - パターンマッチ内のリテラル値 - その値そのものとマッチする
  - パターンマッチ内の変数 - 対応する値が自身にセットすることでマッチする

```exs
list = [1, 2, 3] # => [1, 2, 3]

# パターンマッチが成功するケース: 変数bに数値3が束縛される
[a, 2, b] = list # => [1, 2, 3]

# パターンマッチが失敗するケース
[a, 1, b] = list # => ** (MatchError) no match of right hand side value: [1, 2, 3]
```

## パターンマッチ時に値を無視する
- `_` = 値を捕捉しない場合のパターン

```exs
[1, _] = [1, 2] # => [1, 2]

_ # => ** (CompileError) invalid use of _. "_" represents a value to be ignored in a pattern and cannot be used in expressions
```

## 変数の束縛
- パターンマッチ中に値に束縛された変数は、パターンマッチ処理が終了するまで保持される
  (パターンマッチ中に同じパターンに対して値をセットし直すことはできない)

```exs
# パターンマッチが成功するケース: マッチ対象の値が一度変数に束縛された値と等価である場合
[a, a] = [1, 1] # => [1, 1]

# パターンマッチが失敗するケース
[a, a] = [1, 2] # => ** (MatchError) no match of right hand side value: [1, 2]

# パターンマッチ処理が一度終了すると同じ変数に別の値を束縛できるようになる
a = 2 # => 2

# 前回パターンマッチで変数に束縛された値を参照する場合はピン演算子^を使用する
# ^aは数値2に束縛されているためマッチエラーとなる
^a = 1 # => ** (MatchError) no match of right hand side value: 1
```

### `<-`演算子
- `=`でパターンマッチしなかった場合: `MatchError`が返る
- `with` + `<-`でパターンマッチしなかった場合: `nil`が返る

```exs
with [a, _] <- [1, 2], do: a # => 1
with [a, _] <- nil, do: a    # => nil
```

### 関数の引数
- 実引数は仮引数に対してパターンマッチされる

```exs
swap = fn({ a, b }) -> { b, a } end # => #Function<7.126501267/1 in :erl_eval.expr/5>
swap.({ 1, 2 })                     # => {2, 1}
```
