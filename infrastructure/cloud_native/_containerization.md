# コンテナ技術
- 仮想化技術の一種
- Linuxカーネルのnamespaceによる作業空間の分離
  - プロセス空間の分離
  - コマンドやライブラリの取得
  - ネットワーク空間の分離
  - ファイルシステム空間の分離
  - その他

### 特徴
- 参照: [コンテナの3つの特徴とは？](https://news.mynavi.jp/article/zerocontena-4/)
- 起動・停止が迅速
  - 使用するOSをホストと共有していることにより、OSの起動プロセスが不要であるため
- アプリケーションを動作させるために必要なシステムリソースやライブラリ群が少ない
  - 使用するOSをホストと共有していることにより、OSそのものを動作させるためのリソースやライブラリが不要であるため
- 必要になった時だけ作成し、不要になったら削除する使い方が一般的
  - Immutable Infrastructure

### 構成要素
- ホスト - コンテナを稼働させる場所
- コンテナエンジン - ホストのOSに常駐し、コンテナの操作・管理を行うプロセス

### 周辺技術
- Docker - コンテナ型アプリケーションの実行環境
- Kubernetes - 大量のコンテナ管理や負荷分散を実現するコンテナオーケストレーター」

## 志向性
### システムコンテナ
- OS全体をコンテナ化する
- コンテナ技術を用いてサーバー仮想化に近いことを実現する
  - LXC

### アプリケーションコンテナ
- 特定のアプリケーションプログラムのプロセスをコンテナ化する
  - Docker

### アプリケーションコンテナ

## 仮想マシンとの違い
- 参照・引用: [コンテナ技術入門 - 仮想化との違いを知り、要素技術を触って学ぼう](https://employment.en-japan.com/engineerhub/entry/2019/02/05/103000)

#### 仮想マシン
- ハイパーバイザによって作成された仮想的なハードウェア環境
- 仮想マシンにOS、実行するアプリケーション、ライブラリをインストールし、独立した実行環境を構築する

#### コンテナ
- コンテナランタイムによって作成されたプロセス(ホストOSのリソースを隔離・制限したプロセス)
- 実行するアプリケーション、ライブラリを個別に用意し、
  アプリケーション実行時にプロセスの属性を変更してホストOSのリソースを隔離・制限することにより、
  独立した実行環境を構築する

### 主な違い
- オーバーヘッド
  - 仮想マシンは個別のOS実行のためのシステムリソースが必要
  - コンテナはホストOSとシステムリソースを共有している
- 隔離レベル
  - 仮想マシンは仮想的なハードウェアレベルで隔離されている
  - コンテナはホストOSのプロセスのひとつとして動作するため、他のプロセスに影響を与える可能性がある

## 技術的要素
- 参照・引用: [コンテナ技術入門 - 仮想化との違いを知り、要素技術を触って学ぼう](https://employment.en-japan.com/engineerhub/entry/2019/02/05/103000)

- `Namespace`
  - プロセスID番号空間やマウントポイントなどのカーネルリソースを他のプロセスから隔離する機能
- `cgroup`
  - グループ化したプロセスに対し、カーネルリソースやハードウェアリソースを制限することができる機能
  - `cgroupfs` - cgroupによってマウントされる仮想ファイルシステム
- `Capability`
  - root権限を細分化してプロセスやファイルに設定する機能
- `chroot`
  - プロセスのルートディレクトリが指すパスを変更する機能
- `pivot_root`
  - プロセスのルートファイルシステムそのものを入れ替える機能
- `OverlayFS`
  - 2つのディレクトリを重ね合わせ、ひとつのディレクトリとして見せるファイルシステム

## コンテナオーケストレーション
- 参照: [3分でわかる コンテナオーケストレーション](https://xtech.nikkei.com/atcl/nxt/keyword/18/00002/080500086)
- コンテナ化された複数のアプリケーション群のデプロイ、スケーリング、管理などを自動化する技術
- 本番環境におけるコンテナの運用数の増加に伴い、その管理の複雑さを解決するために必要とされる
  - コンテナはマイクロサービスアーキテクチャとの相性の良さから、複数同時に運用されるケースが多い

### 期待される役割(例)
- コンテナのスケジューリング
- コンテナのクラスター管理
- コンテナの死活監視
- ロードバランシング

### Kubernetes
- 事実上のデファクトスタンダードであるコンテナオーケストレーションツール
- Googleによって開発が開始され、現在はCNCFが開発を行っている

## 参照
- [ソフトウェア開発の課題を解決するコンテナ技術](https://www.atmarkit.co.jp/ait/articles/1901/29/news005.html)
- [コンテナとは？(3)仮想化技術編](https://news.mynavi.jp/article/zerocontena-3/)
- [【連載】世界一わかりみが深いコンテナ & Docker入門 〜 その1:コンテナってなに？ 〜](https://tech-lab.sios.jp/archives/18811)
- サーバ・インフラエンジニアの基本がこれ一冊でしっかり身につく本 5
