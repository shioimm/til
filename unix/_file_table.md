# ファイルを管理するためのデータ構造
### プロセステーブル
- 実行中の各プロセスに関する情報を保持するテーブル
- プロセステーブルには一つのプロセスごとに一つのプロセステーブルエントリが保存される
- プロセステーブルエントリにはファイルディスクリプタを管理する表が保存される
  - ファイルディスクリプタを管理する表には一つのファイルディスクリプタごとに一つのエントリが保存される

#### 各ファイルディスクリプタごとに保存されるもの
- ファイルディスクリプタフラグ (close-on-exec)
- ファイルテーブルエントリへのポインタ

### ファイルテーブル
- オープンしているすべてのファイルに関する情報を保持するテーブル

#### ファイルテーブルエントリごとに保存されるもの
- ファイルステータスフラグ
- カレントファイルオフセット
- 当該ファイルのvノードテーブルエントリへのポインタ

```c
// UNIXカーネルにおいてファイルテーブルエントリはfile構造体として保持される
// file構造体はopen file discriptionとも呼ばれる
// 実際の実装では必ずしもstruct file型を持っているとは限らない

// Linux
struct file {
  struct path                   f_path;       // ファイルのパス情報
  struct inode                 *f_inode;      // 対応するinode構造体
  const struct file_operations *f_op;         // ファイル操作関数ポインタ
  loff_t                        f_pos;        // ファイルの現在位置
  unsigned int                  f_flags;      // ファイルフラグ
  fmode_t                       f_mode;       // アクセスモード
  void                         *private_data; // ドライバ固有データ
  // ...
};
```

### vノードテーブル
- ファイルの種類とファイル操作関数へのポインタ、iノードテーブルエントリへのポインタを保持する
- vノードテーブルには一つのオープンしているファイルごとに一つのエントリが保存される
- (Linuxには存在しない)

#### vノードテーブルエントリごとに保存されるもの
- vノード情報
- vデータ (iノードテーブルエントリへのポインタ)

### iノードテーブル
#### iノードテーブルエントリごとに保存されるもの
- iノード情報
- カレントファイルサイズ
- `i_v`ノード
