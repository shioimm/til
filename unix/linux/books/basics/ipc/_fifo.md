# FIFO(名前付きパイプ)
- 参照: 例解UNIX/Linuxプログラミング教室P257-289
- 参照: 詳解UNIXプログラミング第3版 15. プロセス間通信
- 参照: Linuxネットワークプログラミング Chapter7 プロセス間通信 7-7
- 参照: Linuxによる並行プログラミング入門 第4章 リダイレクトとパイプ 4.5
- 参照: Linuxプログラミングインターフェース 44章

## TL;DR
- 任意のプロセス間でのデータ通信機構
  - プロセス同士の関連を問わずに使用できる
  - 意味的にはパイプとほぼ等価
- ファイルシステム上で名前を持ち、通常ファイルと同じAPIで操作できる
- プロセスからのファイルディスクリプタが全てクローズされても存続する

## FIFOの性質
### ファイルオープン
- FIFOを読み取り用にオープンすると、
  別プロセスがFIFOを書き込み用にオープンするまでブロックする
  - `O_NONBLOCK`追加時はブロックしない
- FIFOを書き込み用にオープンすると、
  別プロセスがFIFOを読み取り用にオープンするまでブロックする
  - `O_NONBLOCK`追加時は`ENXIO`が発生する
- FIFOを`O_RDWR`フラグでオープンすると、
  読み書き両用のファイルディスクリプタが返るが動作は未定義

### パイプライン内分岐
- シェルのパイプラインは通常線形だが、FIFOを使用することでパイプライン内での分岐が可能

```
$ mkfifo fifo
$ wc -l < fifo &
$ ls -l < tee fifo | sort -k5n
```

```
ls -> tee -> sort
       |
      fifo -> wc
```

## FIFOを用いたクライアント - サーバーアーキテクチャ
- FIFOをデータの待ち合わせ場所(ランデブー場所)とする

```
client1  ←   client1 FIFO
   ↓                  ↑
  リクエスト        レスポンス
     ↓                  ↑
    サーバーFIFO   →   server
     ↑                  ↓
  リクエスト        レスポンス
   ↑                  ↓
client2  ←   client2 FIFO
```

## API
### `mkfifo(2)` / `mkfifo(1)`
- FIFOを作成する
- `mkfifoat(2)`

#### 引数
- `*pathname`、`mode`を指定する
  - `*pathname` - 作成するFIFOの名前を示す文字列へのポインタ
  - `mode` - パーミッションを示すマクロ定数

#### 返り値
- 数値0を返す
  - エラー時は数値-1を返す
