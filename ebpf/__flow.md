# 動作フロー
1. (ユーザー空間)
   eBPFプログラムを含むユーザープログラムがeBPFプログラムのソースコードをコンパイルしeBPFバイトコードに変換
2. (ユーザー空間)
   bpf(2)システムコールを呼び出し
3. (カーネル空間)
   BPF VerifierがeBPFバイトコードの安全性を検証
   カーネルをクラッシュさせる可能性のあるコードの場合はロード自体に失敗
4. (カーネル空間)
   eBPFをProbe (イベントが発生するトレース可能な場所) にアタッチ
5. (カーネル空間)
   ユーザープログラムがeBPFプログラムをアタッチしたイベントが発生
6. (カーネル空間)
    eBPF ExecutorがeBPFプログラムを実行し、処理結果をBPF Mapやperf bufferへ格納
7. (ユーザー空間)
   ユーザープログラムがBPF Mapやperf bufferを参照してeBPFプログラムの実行結果を取得

### Probeの種類
#### kprobes
#### uprobes
#### tracepoint
#### USDT (User Statically Defined Tracepoints)

### フック可能なカーネルイベント
- ソケット操作に関するイベント
  - パケットフィルタリング、コネクション確立・タイムアウトなどのソケット属性変更、パケットのリダイレクトなど
- トンネリング (ネットワークスタック内のパケットカプセル化フレームワーク) に関するイベント
- 帯域制御を実現するためのイベント
- XDP (Xpress Data Path: NICから受け取ったパケットデータを直接操作する) に関するイベント
- トレーシングに関するイベント
  - カーネル関数呼び出し、カーネル関数内のイベント発生、パフォーマンスカウンタなど
- Cgroups (プロセスをグループ化してリソース割り当てを制御する機構) におけるイベント

## 参照
- [eBPFに3日で入門した話](https://caddi.tech/archives/3880)
- SoftwareDesign 2020年10月号
