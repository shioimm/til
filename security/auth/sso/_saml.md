# SAML
- Security Assertion Markup Language
- OASISにて策定された認可認証プロトコル
- 認証情報の交換によって連携するサービス間で安全なSSOを実現できる
- 認証に加え、属性情報の交換による認可とアクセス制御情報の交換による認可も可能
- SAMLの利用者は本人性を確認した上で登録・管理され、
  利用者の認証情報は、管理者があらかじめ想定したサーバーへ転送される

## 構成概念
#### IdP(Identity Provider)
- 認証認可を提供する(サーバー)
  - 認証方法は実装に依存する

#### SP(Service Provider)
- IdPが発行した認証認可情報に応じてサービスを提供するWebアプリケーションサーバー

#### トラストサークル
- IdPとSPの間で事前に結ばれた信頼関係
- ルールやポリシーへの合意、メタデータの交換によって信頼性を確立する
  - メタデータ - 連携先のSPの情報・公開鍵などトラストサークルを構築する情報(XML形式)

#### Name Identifier
- IdPとSPがID連携する際に利用する、両者のID情報を保持した識別子

## 動作フロー
- SAMLではSAMLリクエストとSAMLレスポンスの手順が定められている
- SAMLリクエストとSAMLレスポンスはXMLによるアサーションとして実現される
  - アサーション - 利用者の認証情報、属性情報、リソースに関する認可権限情報の証明書
- SAMLリクエストのアサーションでは認証、属性、認可決定に関する要求がされる
- SAMLレスポンスのアサーションではステータスコード、認証情報などを返す

#### IdP-Initiated SSOの動作フロー
1. 利用者がSPへアクセスする
2. SPがSAMLリクエストを生成し、IdPへHTTPリダイレクトさせる
3. IdPが利用者を認証する
4. IdPがSAMLレスポンスを生成し、SPへ転送する
5. SPはSAMLレスポンスを元にアクセス制御を行い、サービスを提供する

## 実装例
- Shibboleth
- OpenSAML

## 参照
- Real World HTTP 第2版
- マスタリングTCP/IP 情報セキュリティ編
