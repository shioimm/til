# フロー制御
- ストリームはTCPのようなフロー制御機能を内包する
- フロー制御によって各ストリームの通信量が制御される
- 通信先のウィンドウサイズ(空きバッファサイズ)の管理を行うことにより、
  通信されるデータがオーバーフローしないようにする
  - デフォルトのウィンドウサイズは64KB
  - ウィンドウサイズが0になるとそれ以上DATAフレームを送信することができなくなり、
    受信者から`WINDOW_UPDATE`フレームが送られてウィンドウサイズが更新されるまで待機状態となる

## 仕組み
1. 送信側は受信側のバッファサイズの限界量のデータを送信する
2. 受信側は送信されてきたデータを順に処理する
3. 受信側はバッファに余裕が出てきたら`WINDOW_UPDATE`を使い余裕ができたサイズを送信側に返信する
4. 送信側は`WINDOW_UPDATE`を受け取り、送信できるサイズの続きのデータを送信する

## フロー制御ウィンドウ
- 受信側が受信できるデータ量を表す数値
- 送信側が`DATA`フレームを送信するたび、送信した分だけ数値が減っていく
- フロー制御ウィンドウが0になると、それ以上`DATA`フレームを送信することができなくなる
  - ウィンドウ数0時にデータが送信された場合、エラーになりコネクションが切断される
- 受信側から`WINDOW_UPDATE`フレームが送信されることによってウィンドウ数が増加する
- ウィンドウ数の初期値は`SETTINGS`フレームの`SETTINGS_WINDOW_INITIAL_SIZE`で設定される
  - デフォルト値は65535

### コネクションレベルフロー制御ウィンドウ
- 全てのストリームでの`DATA`フレーム送信によって減算される

### ストリームレベルフロー制御ウィンドウ
- ストリームごとに独立したフロー制御ウィンドウを持ち、
  該当するストリームの`DATA`フレーム送信によってのみ減算される

## `WINDOW_UPDATE`フレーム
- Window Size Incrementという値(フロー制御ウィンド増加させる量)を格納するフレーム
- `WINDOW_UPDATE`フレームは当該ストリームのフロー制御ウィンドウを増加させる
  - ストリームID 0の`WINDOW_UPDATE`フレームは、コネクションレベルフロー制御ウィンドウを増加させる

## 参照
- よくわかるHTTP/2の教科書
- Real World HTTP 第2版
