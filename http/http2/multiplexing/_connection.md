# コネクション
- HTTP/2はHTTP/1.xと同じTCPポートを利用して接続を行う
- クライアント -> サーバーへHTTP/2での通信開始をネゴシエーションする
- ネゴシエーション後、クライアント-サーバー間で最終的な接続確認(コネクションプリフェイス)を行なった後
  HTTP/2通信に移行する

## コネクションの再利用
- HTTP/2通信においては、ストリームを並列に多重化して送信するために
  一つのTCPコネクションを再利用している
- コネクション再利用時、サーバーがリクエストされたURLにレスポンスを提供できない場合、
  ステータスコード421を返す
  - クライアント側は新しいTCPコネクションを生成し、接続し直す

### コネクションを再利用するメリット
- コネクションを開始する手間が省ける
  - TCP 3wayハンドシェイク
  - TLSハンドシェイク
  - HTTP/2プリフェイス
- 帯域を効率よく使用できる
  - TCPスロースタートの回避
- ヘッダ圧縮による効率化

### コネクションの再利用条件
#### http接続の場合
- 接続しようとしているサーバーのIPアドレスが同じであること

#### https接続の場合
- 接続しようとしているサーバーのIPアドレスが同じであること
- 接続しようとしているサーバーの 証明書が有効であること

## コネクションプリフェイス
- ネゴシエーション完了後にサーバーとクライアントが送信し合うメッセージ
  - 送信相手がHTTP/2に対応していることを確かめる最終確認
  - コネクションプリフェイスの送信が完了するとHTTP/2による通信を開始できる
- クライアントコネクションプリフェイス
  - `0x505249202a20485454502f322e300d0a0d0a534d0d0a0d0a` + SETTINGSフレーム
    - 文字列表現: `"PRI * HTTP/2.0\r\n\r\nSM\r\n\r\n"`
- サーバーコネクションプリフェイス
  - SETTINGSフレーム

## 参照
- [普及が進む「HTTP/2」の仕組みとメリットとは](https://knowledge.sakura.ad.jp/7734/)
- [HTTP の進化](https://developer.mozilla.org/ja/docs/Web/HTTP/Basics_of_HTTP/Evolution_of_HTTP)
- [そろそろ知っておきたいHTTP/2の話](https://qiita.com/mogamin3/items/7698ee3336c70a482843)
- [Request and Response](https://youtu.be/0cmXVXMdbs8)
- [HTTP/2とは](https://www.nic.ad.jp/ja/newsletter/No68/0800.html)
- [HTTP/2](https://hpbn.co/http2/#binary-framing-layer)
- よくわかるHTTP/2の教科書P83-88/96-97
