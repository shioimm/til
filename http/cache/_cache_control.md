# Cache-Control
- リクエストヘッダに含まれるCache-Controlに関しては基本的に経路上のキャッシュでは考慮しない
- ExpiresよりもCache-Control: max-ageの方が優先して使用される

### キャッシュの保存方法
- (未指定)
- public
  - sharedキャッシュに格納することを指定(あまり使うべきではない)
- private
  - privateキャッシュに格納することを指定

| 種類    | 対象    | クライアントとの対応 | 経路上への格納 | ローカルへの格納 | 強制的にキャッシュ |
| -       | -       | -                    | -              | -                | -                  |
| 未指定  | shared  | 1:n                  | ○              | ○                | ×                  |
| public  | shared  | 1:n                  | ○              | ○                | ○                  |
| private | private | 1:1                  | ×              | ○                | ○                  |

### キャッシュの使われ方
- no-store
  - キャッシュを格納しない
- no-cache
  - キャッシュを格納する・キャッシュを使用する場合は毎回オリジンへ再検証を要求する
  - キャッシュが有効(304)な場合はキャッシュを使用する
  - キャッシュが無効な場合は新たにオリジンからレスポンスを返す(200)

#### キャッシュさせない場合のCache-Control
```
Cache-Control: private, no-store, no-cache, must-revalidate
```

### キャッシュの更新方法
- must-revalidate
  - キャッシュの期限切れ時はオリジンへ再検証を要求する
  - 再検証できない場合は504を返す
  - privateキャッシュに適用される
- proxy-revalidate
  - キャッシュの期限切れ時はオリジンへ再検証を要求する
  - 再検証できない場合は504を返す
  - privateキャッシュに適用されない
- immutable
  - キャッシュしたオブジェクトを変更しない(あまり使うべきではない))

### オブジェクトの取り扱い方
- no-transform
  - 経路上(データセーバーなど)でオブジェクトに対して操作を行うことを許可しない
  - 実装が対応していないケースがあるためno-transformを使用するのではなくHTTPS化する方が適切

### キャッシュの期限指定
- max-age
  - オリジンがレスポンスを生成した時刻を起点とした相対的なキャッシュの期限
  - 起点としてクライアントがリクエストを開始した時間を設定するのが安全
  - 実際の有効期限 = max-age - Ageヘッダ(キャッシュに格納された後の経過時間)
- s-maxage
  - 経路上のキャッシュにのみ有効なmax-age
  - 経路上においてmax-ageより優先される
- stale-while-revalidate
  - 期限切れ時にバックグラウンドで再検証を行う間に古いキャッシュを使うことを許容する期限
- stale-if-error
  - 期限切れ時の際kん商でオリジンがダウンしていた場合に古いキャッシュを使うことを許容する期限

#### キャッシュの状態
- Fresh - TTLの期限内であり、そのまま使える・検証が成功しキャッシュが有効な状態
- Stale - TTLの期限切れ済みであり、条件付きで使える・検証が無効な状態

## 参照
- Web配信の技術
