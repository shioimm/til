# マスタリングTCP/IP 入門編 まとめ01
- 井上直也・村山公保・竹下隆史・荒井透・苅田幸雄 共著

## IP(Internet Protocol)
- ネットワーク層のプロトコル -> 終点ノード間の通信を実現するための仕様
  - ノード -> ホスト + ルーター
    - ホスト -> IPアドレスを持つ機器(経路制御を行わない)
    - ルーター -> IPアドレスを持つ機器(経路制御を行う)
- IPは接続前に通信相手とのコネクション確立を行わない
- IPを利用して通信を行う際、データにIPヘッダをつけて送信する
  - IPヘッダはIPv4とIPv6で仕様が異なる

### IPアドレス
- ネットワークに接続されている全てのホストの中から宛先を識別するアドレス
  - ホストが接続されているデータリンクの種別を問わない
    - 中継することだけを目的にした機器(ブリッジ、スイッチングハブ)はIPアドレスを必要としない

### IPv4アドレス
- 32ビット
- ネットワーク部 + ホスト部
  - ネットワーク部 -> 同一セグメント内では統一 / 異なるセグメント同士では一意
  - ホスト部 -> 同一セグメント内で一意

####ネットワーク部とホスト部の区切りを判別する方法
- クラス
  - クラスA -> 先頭1ビットが0から始まる
  - クラスB -> 先頭2ビットが10から始まる
  - クラスC -> 先頭3ビットが110から始まる
  - クラスD -> 先頭4ビットが1110から始まる
- サブネットマスク
  - IPアドレス + サブネットマスク(ネットワーク部を示す)の組をIPアドレスとする
  - IPアドレスと別にサブネットマスクを記述するか、IPアドレスの末尾にネットワーク部の位置を示す

#### ブロードキャストアドレス
- ホスト部のビットを全て1にするとブロードキャストアドレスになる
  - 同一リンクに接続された全てのホストにパケットを送信するためのアドレス
  - ローカルブロードキャスト -> 自分の属するリンク内のブロードキャスト
  - ダイレクトブロードキャスト -> 自分と異なるリンク宛のブロードキャスト(転送する)

#### IPマルチキャスト
- 特定のグループに属するホスト宛にマルチキャストを行う
- クラスDのIPアドレス + 残り28ビットにマルチキャストの対象となるグループ番号を割り当てる

### IPv6アドレス
-  128ビット
- グローバルユニキャストアドレス
  - インターネット内で一意になるアドレス
  - グローバルルーティングプレフィクス + サブネットID + インターフェースID
- ユニークローカルアドレス
  - インターネットと接続しないプライベートネットワークのアドレス
  - 1111111010 + L + グローバルID(乱数) + サブネットID + インターフェースID
- リンクローカルユニキャストアドレス
  - イーサネット上の同一セグメント内で通信する際のアドレス
  - 1111111010 + 0 + インターフェースID

### 経路制御
- 宛先IPアドレスのホストまでパケットを届けるための仕組み
- 全てのホスト・ルーター(パケットを転送する仕組みを持った機器)が経路制御表を持つ
  - 経路制御表(ルーティングテーブル)
    - 宛先ネットワークと送信先ルーターの対応を行うテーブル
      - デフォルトルート -> 0.0.0.0/0
      - ホストルート -> IPアドレス/32
      - ループバックアドレス -> 127.0.0.1
      - リンクローカルアドレス -> 164.254/16
    - 経路制御表は集約によってダウンサイズする

### 経路MTU探索
- データリンクによってMTU(最大転送単位)が異なる場合がある
- パケットのサイズがルーターのMTUを超過している場合、ルーターはパケットを分割する
- 分割されたパケットは最終的に終点の宛先ホストで再構築される
- 分割はコストが高いため、送信元ホストが経路上最小値のMTUに合わせて予めパケットを分割する -> 経路MTU探索
