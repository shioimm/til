# 安全なWebアプリケーションの作り方(脆弱性が生まれる原理と対策の実践) まとめ
- 徳丸浩 著

## アカウント管理
- ユーザーが入力したメールアドレスは必ず受信確認を行う
- 重要な処理に際して再認証を行う
- 重要な処理に際してメール通知を行う

### ユーザーIDの重複防止
- ユーザーIDにDB上の一意制約をつける

### ユーザーの自動登録への対処
- ユーザー登録画面にてCAPCHA/reCAPCHA/パズル認証を使用する

### パスワード変更
- 現在のパスワードを確認する
- パスワード変更時にメール通知を行う
- 管理者側で設定した仮パスワードは、ユーザーの初回ログイン時に変更させる
- SQLインジェクション脆弱性対策
  - 再認証を回避させない
  - 別ユーザーのパスワードを変更させない
  - 全ユーザーのパスワードを一斉変更させない
- CSRF脆弱性対策
  - 再認証によって防止可能

### パスワードリセット
- 管理者向けパスワードリセット
  - [1]問い合わせを受け、ユーザーの本人確認を行う
    - 本人確認時のユーザー情報照会機能
  - [2]管理者がパスワードをリセットし、仮パスワードを発行する
    - 仮パスワード発行機能(メール通知)
  - [3]ユーザーは仮パスワードでログインし、パスワードを変更する
    - 仮パスワードではパスワード変更のみができる

- ユーザー向けパスワードリセット
  - [1]本人確認
    - 登録済みメールアドレスの確認
    - 二段階認証
  - [2]パスワード通知
    - a. 現在のパスワードをメール通知×
    - b. パスワード変更画面のURLをメール通知×
    - c. 仮パスワードを発行、メール通知◯
    - d. パスワード変更画面に直接遷移◯

### メールアドレス変更
- セッションハイジャック対策
- CSRF脆弱性対策
- SQLインジェクション脆弱性対策
- 新規メールアドレスに対する受信確認
  - メールにトークン付URLを添付し、そのURLから処理を継続する
  - メールアドレス入力後にトークン遷移する
    - 確認メールに届いたトークンを入力させる
- 再認証
- メール通知

### アカウント停止
- ユーザー本人からの依頼時
- 不正アクセス発覚時
- ユーザー不正利用時

### アカウント削除
- パスワードの再確認を実装
  - なりすましユーザーからの悪用防止
  - CSRF脆弱性対策
- SQLインジェクション脆弱性対策
