# なるほどUNIXプロセス まとめ05
- Jesse Storimer 著
- 島田浩二・角谷信太郎 翻訳

## Chapter17
- プロセス間通信 -> 複数のプロセス間で情報をやり取りする
  - プロセス間通信にはパイプとソケットがよく利用される

### パイプ(IO.pipe)
- パイプ -> プロセスからプロセスへの単方向の通信
- 「パイプを開く」 -> プロセスの片方の端を、別のプロセスの片方の端につなぐ
- 片方のプロセスが書き込み側となり、もう片方が読み込み側となる

```
読み込み側のIOオブジェクトと書き込み側のIOオブジェクトの二要素から成る配列を返す

IO.pipe <-> pip(2)
IOオブジェクトはFileオブジェクトのように扱えるが、ファイルではない
```

```ruby
reader, writer = IO.pipe

fork do
  # 子プロセス
  reader.close # 使わないパイプの端を閉じる

  10.times do
    writer.puts "I am a child"
  end
end

# 親プロセス

writer.close # 使わないパイプの端を閉じる

while message = reader.gets
  $stdout.puts message
end
```
- パイプはリソースであり、親子プロセスで共有される
  - 子プロセスにはファイルディスクリプタがコピーされるため、不要なファイルディスクリプタは閉じる必要がある
- パイプはストリームによって通信を行うため、区切り文字としてデリミタが必要
  - ストリーム -> 開始と終了の概念を持たずにデータの読み書きを行う

#### ソケット
- ストリームではなく、メッセージを使った通信を行う場合、ソケットが必要
  - ソケットはデータグラムによって通信を行い、メッセージ全体を読み書きするためデリミタは不要
- ソケットは双方向の通信

```
相互に結合されたソケットのペアを配列にして返す

require 'socket'
Socket.pair <-> socketpair(2)
```

#### リモートでプロセス間通信(IPC)する方法
- TCPソケットを使う
- RPCやZeroMQのようなメッセージングシステムを使う
- 分散システムを使う
