# 認証・認可機構
- 参照: Real World HTTP 第2版

## シングルサインオン
- 各システム間のアカウント管理を一元化し、一度サインインすると他の全システムが有効になる仕組み

### 実装
- 各サービスが認証サーバーに自前でアクセスする
- 各サービスの前段にHTTPプロキシを置き、認証を代行する
- 各サービスに認証を代行するエージェントを置き、サインイン時に中央サーバーにサインインの有無を問い合わせる
- Kerberos認証
- SAML(Security Assertion Markup Language)

#### Kerberos認証
- LDAP規格(情報を一元管理するデータベース)とSASL認証機能のセットで使用されるシングルサインオン機構
1. チケット保証サーバーからのアクセストークンとセッションキーを取得する
2. チケット保証サーバーへアクセストークンとセッションキーを送信し、チケットとセッションキーを取得する
3. サービスへチケットとセッションキーを送信することでシングルサインオンが実現する

#### SAML(Security Assertion Markup Language)
- OASISにて策定されたシングルサインオン機構
- Cookieを使用してセッションを管理するWebの仕組みに準じ、
  ドメインをまたいだサービス間で認証を共有するシングルサインオン機構
  - SAML SOAPバインディング
  - リバースSOAP(PAOS)バインディング
  - HTTPリダイレクトバインディング
  - HTTP POSTバインディング
  - HTTPアーティファクトバインディング
  - SAML URIバインディング

## OpenID
- すでに登録されているWebサービスのユーザー情報を使い、他のサービスにサインインする機構
- 後続のOpenID Connectを利用するケースの方が増えている

### 概念
- OpenIDプロバイダ - ユーザー情報を持つWebサービス
- リライニングパーティ - ユーザーが新たに使用したいサービス
- ユーザー入力識別子 - OpenIDプロバイダが提供するユーザー情報(URL形式)

## OpenSocial
- ソーシャルネットワークの共通API
  - 認証以外にも様々な機能を有するプラットフォーム
    - Person & Friend API
    - Activities API
    - Persistence API、
    - requestSendMessage

### 概念
- ソーシャルネットワークサービス事業者 - ユーザー情報を持つ事業者
- サードパーティアプリケーション - ユーザーが新たに使用したいサービス

## OAuth
- 認証ではなく認可のための仕組み

### 概念
- 認可サーバー - ユーザー情報を持つサーバー
- リソースサーバー - ユーザーが認可した権限で自由にアクセスできる対象
- クライアント - ユーザーが新たに使用したいサービス

### フロー
#### Authorization Code
- 通常のフロー

#### Clients Credentials Grant
- ユーザーの同意なしに`client_id`と`client_secret`を使用してアクセスできるようにするフロー

#### Device Code Grant
- パスワード入力用のキーボードがないような組み込み危機向けのフロー

#### Resource Owener Password Credentials Grant
- 認可サーバーに信頼されているクライアントが使用するフロー
- クライアント自身がユーザーのID/PWに触れる

#### Implicit Code
- `client_secret`無しでアクセスするフロー

## OpenID Connect
- OAuth2.0をベースに、認可だけでなく認証まで行えるように拡張したもの
- OAuthとの違いはユーザープロフィールへのアクセス方法が規格化された点

### エンドポイント
#### 認可エンドポイント
- クライアントが認可リクエストを送信するエンドポイント
- クライアント認証を行うフロー: 認可コード(トークンエンドポイントにアクセスするための鍵)を返す
- クライアント認証を行わないフロー: アクセストークンとIDトークンを返す

#### トークンエンドポイント
- アクセストークンとIDトークンを返すエンドポイント
- クライアントを認証することで強い権限のトークンを返す

### フロー
#### Authorization Code Flow
- OAuthのAuthorization Codeと同じ
- 認可エンドポイントにアクセスしてコード取得後、トークンエンドポイントにアクセスしてトークンを得る

#### Implicit Flow
- OAuthのImplicit Codeと同じ

#### Hybrid Flow
- Implicit Flowと似ている
- 認可エンドポイントで通信に必要なトークンと追加で情報を得るための認可コードを得る
- 認可コードを利用してトークンエンドポイントにアクセスする
