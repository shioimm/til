# Cookie
- 参照: [サードパーティクッキーって何だっけ？ 今さら聞けないHTTP Cookieのキホン](https://webtan.impress.co.jp/e/2017/10/03/27016)
- 参照: よくわかるHTTP/2の教科書P34-37
- 参照: Real World HTTP 第2版

## TL:DR
- HTTPにおける状態管理の仕組み
- ブラウザの状態を継続的に管理するための情報を保存するためのストレージ
- 容量は最大4KB
- ドメインごとに50 Cookie程度
- ブラウザごとに3000 Cookie程度

## 送受信
- Cookieはヘッダを介してサーバー <-> クライアント間を関連づける
  - Set-Cookieレスポンスヘッダ(サーバー -> クライアント)
  - Cookieリクエストヘッダ(クライアント -> サーバー)

## 分類
- 発行元
  - ファーストパーティ - ユーザーが訪れたサイトが発行したCookie
  - サードパーティ - それ以外のサイトが発行したCookie
- 使用期間
  - セッションCookie - ブラウザを閉じると消える
  - 永続Cookie - ブラウザを閉じても残る
- 目的
  - 厳密に必要なCookie
  - 環境設定Cookie
  - 統計Cookie
  - マーケティングCookie

## 属性
#### Expires / Max-Age
- 有効期限
  - Expires - 指定日時
  - Max-Age - 現在時刻から有効期限が切れるまでの秒数
- 省略時はセッションCookieとなる

#### Domain
- クライアントからCookieを送信する対象のサーバー
- 省略時はCookieを発行したサーバー

#### Path
- クライアントからCookieを送信する対象のサーバーのパス
- 省略時はCookieを発行したサーバーのパス

#### Secure
- 有効時、HTTPSでの接続時以外はクライアントからサーバーへCookieを送信しない

#### HttpOnly
- JavaScriptエンジンからCookieを操作できないようにする

#### SameSite
- ファーストパーティCookieまたは同じサイトのコンテキストでのみCookieを送信する

## オリジン
- ユーザーが訪れたサイト
- Cookieはオリジン単位で扱われる
- POSTリクエストなどを別のオリジンに送信する際はCORSの許可が必要

### オリジンの判定
- パス名違いは同一オリジンとみなされる
- ドメイン違いは別オリジンとみなされる
- スキーム違いは別オリジンとみなされる
- ポート番号違いは別オリジンとみなされる

## 認証のためのCookie
- フォームを使ったログイン + Cookieを使ったセッション管理の組み合わせによる認証が一般的に使用される
  - ユーザーIDとパスワードを直接送信するため、SSL/TLSによる通信の暗号化が必須
