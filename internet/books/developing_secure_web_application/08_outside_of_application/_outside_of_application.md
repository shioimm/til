# 安全なWebアプリケーションの作り方(脆弱性が生まれる原理と対策の実践) まとめ
- 徳丸浩 著

## Webサイトの安全性を高めるために
### Webサーバーへの攻撃
- 基盤ソフトウェアの脆弱性
  - サーバー
    - サーバー管理用ソフトウェア
  - ネットワーク機器

#### 対策
1. 適切なサーバー基盤を選定する
  - Iaas/VPS/専用サーバー
    - ユーザーがプラットフォームのパッチ適用・アプリケーションの脆弱性対処・パスワード管理を行う
  - Paas/レンタルサーバー
    - ユーザーがアプリケーションの脆弱性対処・パスワード管理を行う
  - Saas
    - ユーザーがパスワード管理を行う
2. 機能提供に必要なソフトウェアのみ稼働させる
3. 脆弱性の対処をタイムリーに行う
  - ソフトウェア選定時、サポートの提供期限を確認する
  - ソフトウェア選定時、パッチ適用の方法を決定する
    - 新バージョンをフルインストール
    - ソースレベルでパッチを適用
    - パッケージ管理システムを利用
    - パッチ適用ソフトを利用
  - 脆弱性情報を監視する
  - 脆弱性を確認したらパッチの提供状況や回避策を調べる
    - セキュリティパッチを適用する
    - 脆弱性を解決したバージョンへupgradeする
    - 回避策を実施する」
  - 脆弱性を確認したら対処計画を立てる
    - テスト環境での検証
    - 作業スケジュールの決定
    - Webサイトの停止告知
    - サーバーのバックアップ手順
    - 作業項目の詳細化・作業後の確認方法の詳細化
  - 脆弱性対処を実行する
4. 一般公開する必要のないポートやサービスはアクセス制限する
  - 外部からは専用線かVPN経由でのみ接続する
  - 特定のIPアドレスのみ接続を許可する
    - ルーター・ファイアウォール
    - サーバーOS機能
    - ソフトウェアのアクセス制限機能
  - ポートスキャンでアクセス制限の状態を確認
5. 認証の強度を高める
  - SSH系のサービスのみを稼働させる
  - SSHサーバーの設定により公開鍵認証のみを有効にする
  - クラウドサービスの管理者アカウントを管理する

### なりすまし
#### 事例
- DNSに対する攻撃
  - ドメイン名を管理するレジストリ・レジストラを狙った攻撃
  - DNSサーバに対する攻撃によりDNSの設定内容を書き換える
    - ドメイン名ハイジャック
  - DNSキャッシュポインズニング攻撃
    - ユーザーが参照しているDNSキャッシュサーバーに対して再帰問い合わせを行い、
      本物のDNSサーバーが応答を返す前に偽の応答を送り込む
  - 失効したドメイン名を第三者が購入して悪用する
- ARPスプーフィング
  - ARPの偽応答を返すことでIPアドレスを偽装し、偽のゲートウェイのなりすます
  - 同一ネットワーク上の機器を経由する必要がある
- フィッシング
  - 正規サイトにそっくりな入力画面を用意してメールなどで利用者を誘導し、ID/PWを盗み取る

#### 対策
- ネットワーク的な対策
  - 同一セグメント内に脆弱なサーバーを置かない(ARPスプーフィングに有効)
  - DNS運用の強化
- TLSの導入
  - 正規のサーバ証明書を購入して導入
    - ドメイン認証証明書
    - 組織認証証明書
    - EV SSL証明書
- 確認しやすいドメイン名の採用
  - 属性型ドメイン名の利用

### 盗聴・改ざん
#### 攻撃経路
- 無線LANの盗聴・改ざん
  - 暗号化されていない無線LAN
  - 解読方法が判明している暗号化手法を利用している無線LAN
  - 共通のパスフレーズを利用している公衆無線LAN
  - 偽のアクセスポイントの設置
- ミラーポートの悪用
- プロキシサーバーの悪用
  - プロキシサーバーを流れるHTTPメッセージを盗聴
- 偽のDHCPサーバー
  - DNSやデフォルトゲートウェイのIPアドレスを偽装
- DNSキャッシュポインズニング・ARPスプーフィング
- 中間者攻撃
  - 中継型の盗聴用機器を通信経路に割り込ませる場合は
    通信が暗号化されていても通信内容の盗聴・改ざんが可能
  - 中間者攻撃中はブラウザの証明書エラーとなる

#### 対策
- 正規の証明書を購入してTLSを運用する
  - 入力画面からHTTPSにする
  - クッキーのセキュア属性を適切につける
  - アセットもHTTPSで指定する
  - frame/iframeを使わない
  - ブラウザのデフォルト設定でエラー表示されないようにする
  - アドレスバーを隠さない
  - ステータスバーを隠さない
  - 右クリックメニューを無効化しない

### マルウェア
- Webサーバーがマルウェアに感染している
  - 情報漏洩
  - サイト改ざん
  - 不正な機能実行
  - 他サイトへの攻撃
- Webサイトを通じてマルウェアを公開している
  - Webサイトのユーザーがマルウェアに感染

#### 感染経路
- ファイルアップロード機能の悪用
- Webサイトの脆弱性を悪用したコンテンツ改ざん
- サーバー管理ソフトに対する不正ログイン
- マルウェアに感染したPCからの接続
- 正規コンテンツがマルウェアに感染

#### 対策
- サーバーの脆弱性対処をタイムリーに行う
- 出所不明のプログラムをサーバーに持ち込まない
- サーバー上で運営に関係ない操作を行わない
- サーバーに外部メディアを装着しない
- サーバーのネットワークを他と切り離す
- クライアントPCにウイルス対策ソフトを導入してパターンファイルを最新に保つ
- クライアントPCに最新のセキュリティパッチを導入する
- マルウェア対策のポリシーをユーザーに公開
- ウイルス対策ソフトの導入
