# クロスサイトリクエストフォージェリ(CSRF)
- ユーザーに意図しない操作を強制させる
1. ユーザーが被害サイトへログインする
2. ユーザーを悪意のあるサイトへ誘導する
3. ユーザーに被害サイトへ意図しないリクエストを送信(Cookieを発行)させる
   - ユーザーのログイン状態は維持されたままの状態であるため、
     ユーザーの権限で被害サイト上の任意の操作を実行させることができる

#### 発生箇所
- Cookieのみでセッション管理が行われているサイト・HTTP認証、
  TLSクライアント証明書のみで利用者の識別が行われているサイト

#### 影響範囲
- CSRF脆弱性のあるページ

#### 影響の種類
- 被害者の権限で重要な処理を実行させられる

#### 原因
- HTMLの仕様を悪用
  - form要素のaction属性にはどのドメインのURLでも指定できる
  - Cookieに保管されたセッショントークンは対象サイトに自動的に送信される

#### 対策
- フォームを設定する際に隠しフィールドにランダムな値のトークンを埋め込んでおき、
  POSTリクエストが送信された際にサーバー側で正規ユーザーの送ったトークンであることを検証する
- Cookieに`SameSite`属性を付与する(リクエストを送信するページが同一サイトにある場合のみCookieを送信する)

## 参照
- 安全なWebアプリケーションの作り方(脆弱性が生まれる原理と対策の実践)
- Real World HTTP 第2版
