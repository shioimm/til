# プロトコル
## OSI参照モデルにおける暗号化技術

| 階層                           | 暗号化技術                                                        |
| -                              | -                                                                 |
| アプリケーション層             | SSH, SSL-Telnet, PETなど遠隔ログイン, PGP, S/MIMEなど暗号化メール |
| セッション層・トランスポート層 | SSL/TLS, SOCKSv5の暗号化                                          |
| ネットワーク層                 | IPSec                                                             |
| データリンク層                 | Ethernet, WANの暗号化装置, PPTP                                   |

## IPSec/VPN
- VPN(Virtual Private Netowork) - 仮想的な私的ネットワーク
- IPSec - VPNの構築に用いられるIP拡張

### IPSec
- IPヘッダの後ろに暗号化のためのヘッダを付加し、以降のデータを暗号化するプロトコル(RFC4301)
- IPパケット単位での暗号化・認証を提供する
- ESP(暗号ヘッダ) + AH(認証ヘッダ) + IKE(鍵交換)から構成される
  - ESP - パケットの暗号化に関するヘッダ拡張
  - AH - 認証に関するヘッダ拡張・パケットが改竄されていないことを保証する
  - IKE - ESPとAHの共通鍵を規定する(UDPポート500番)
- IPSecで通信する機器同士はピアの関係となり、IPSecピア間でSAを確立する
  - SA(Security Association) - ピア間で確立される単方向のコネクション
    - セキュリティプロトコル、通信モード、暗号化方式などIPSec通信に必要なパラメータの集合
    - 双方向の通信を行う場合はSAを双方に対して一本ずつ張る

#### 動作フロー
1. IKEにより共通鍵を生成するためのパラメータを相互に交換し、お互いに共通鍵を生成する
2. ISAKMP SAを確立し、ピアの認証を行う
3. IPSec SAを確立するためのパラメータをISAKMP SAによる暗号っか通信でやりとりし、IPSec SAを確立する
4. IPSec SAのセキュリティ通信モード、暗号化方式などに従って暗号化通信を行う
5. 受信後は複合して認証の検証を行い、上位レイヤにパケットを渡す

## TLS/SSL
- HTTP通信の暗号化を行う技術
- 暗号化処理に共通鍵暗号化方式を利用する
- 暗号化を行う共通鍵の交換に公開鍵暗号化方式を利用する

## IEEE802.1X
- 認められた機器のみがネットワークにアクセスできるように認証する仕組み
  - 無線アクセスや構内LANで使用される
- クライアントの端末 + アクセスポイントとしての無線基地局 + 認証サーバーから構成される

#### 動作フロー
1. 未確認の端末からアクセスポイントへ接続要求が発生する
2. 無条件で端末を接続確認用のVLANへ接続し、一時的なIPアドレスを付与する
3. 利用者は認証サーバーからユーザーIDやパスワードの入力を要求される
4. 認証サーバーがユーザーIDやパスワードを認証する
5. 利用者が利用可能なネットワーク情報がアクセスポイントと端末に通知される
6. 端末がネットワークに接続するために必要となるVLAN番号へ、アクセスポイントが接続の切り替えを行う
7. VLANの切り替え後、端末がIPアドレスをリセットして再設定を行うことでネットワークが利用可能になる

## 参照
- マスタリングTCP/IP 入門編
