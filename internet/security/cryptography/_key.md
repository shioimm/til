# 鍵
- 暗号化・復号に必要となる大きな数字(ビット列)
- 鍵空間が大きいほど(= 鍵のビット長が長いほど)可能な鍵の総数が増えるため安全

#### 鍵の役割
- 共通鍵暗号・公開鍵暗号 - 機密性を保つために使用する
- MAC・デジタル署名 - 認証を行うために使用する

#### 鍵の利用回数
- セッション鍵 - 通信ごとに新しく作成されて使用される鍵(SSL/TLSなど)
- マスター鍵 - 繰り返し使われる鍵

#### 暗号化の対象
- CEK(Contents Encrypting Key) - ユーザーが利用するコンテンツを暗号化する鍵
- kEK(Key Encrypting Key) - 鍵を暗号化する鍵

## 鍵の作成
- 疑似乱数生成器で生成した値を利用する
- パスワード・パスフレーズにソルト(乱数)を付加し、一方向ハッシュ関数でハッシュ化した値を利用する(PBE)
  - ソルトとCEKのみを保存しておき、KEKは削除する

## 鍵の配送
### 鍵配送問題の解決方法
- 鍵の事前配布による解決
- 鍵配布センターによる解決
- Diffie-Hellman鍵交換
- 公開鍵暗号による解決

### Diffie-Hellman鍵交換
- インターネットなどの通信路で、暗号鍵(共通鍵暗号化方式の暗号鍵)を交換するための技術
- SSL/TLSやIPSecで利用される
- DH鍵交換アルゴリズムはMTML攻撃に対して脆弱
  - 中間者が乱数x、yを偽造して主体にB、Aに返すことができるため

#### 動作フロー
1. 鍵を交換する主体A、Bはあらかじめ素数pとpに依存する原始根gを交換しておく
    - 素数pと原始根gはDiffie HellmanグループとしてGroup1・Group2・Group5が定義されている
2. 鍵共有時、主体Aは乱数a、主体Bは乱数bをそれぞれ生成し、秘密に管理する
3. 主体Aは`n = (g ** a) mod p`を計算する
4. 主体Bは`m = (g ** b) mod p`を計算する
5. 主体A・Bはネットワークを介してn、mを交換する
6. 主体A・Bは交換された値と自身が管理する乱数からそれぞれ同じ`x = (g ** (x * y)) mod p`を得る
7. 主体A・Bとで共有する暗号鍵の素材として値xを使用する

## 参照
- マスタリングTCP/IP 情報セキュリティ編
- 暗号技術入門 第3版
