# メッセージ認証コード(MAC: Message Authentication Code)
- メッセージの認証を行う技術
  - 改竄・なりすましの検出を行う
  - 否認の防止を行うことはできない
- 任意長のメッセージと送信者・受信者が共有する鍵を入力とし、固定長ビットの出力(MAC値)を計算する関数
  - 鍵に依存する一方向ハッシュ関数に等しい

## 動作フロー
1. 送信者・受信者は前もって鍵を共有しておく
2. 送信者はメッセージを元にして共有鍵を使用しMAC値を計算する
3. 送信者はメッセージとMAC値を送信する
4. 受信者はメッセージを元にMAC値を計算する
5. 受信者は計算したMAC値と受信したMAC値を比較し、認証を行う

## 実装方法
- 一方向ハッシュ関数
- ブロック暗号
- その他(ストリーム暗号、公開鍵暗号

#### HMAC
- 一方向ハッシュ関数を持ちいてメッセージ認証コードを構成する手法
    - ハッシュ鍵を安全な方法でメッセージに織り交ぜる
1. ハッシュ関数のブロック長に合わせて鍵をパディングする
2. パディングした鍵とipad(ビット列`00110110`をブロック長と同じ長さ繰り返したもの)のXORをとる
3. `2`で得られたビット列の後ろにメッセージを結合する
4. `3`で得られた値を一方向ハッシュ関数へ入力し、ハッシュ値を計算する
5. パディングした鍵とopad(ビット列`01011100`をブロック長と同じ長さ繰り返したもの)のXORをとる
6. `4`で得られたビット列の後ろに`4`のハッシュ値を結合する
7. `6`で得られた値を一方向ハッシュ関数へ入力し、ハッシュ値を計算する(= MAC値)

## 認証付き暗号(AE、AHEAD)
- 共通鍵暗号とMACを組み合わせることで機密性・真正性・認証を同時に満たす仕組み
  - Encrypt-then-MAC - 平文を共通鍵暗号で暗号化し、その後で暗号文のMAC値を計算する
  - Encrypt-and-MAC - 平文を共通鍵暗号で暗号化し、それとは別に平文のMAC値を計算する
  - MAC-then-Encrypt - 予め平文のMAC値を得て、平文とMAC値をまとめて暗号化する

#### GCM
- 認証付き暗号の一種
- 128ビットブロック暗号をCTRモードで用いる
- MAC値を得るために加算と乗算を繰り返す一方向ハッシュ関数を用いる
- GMAC - GCMをメッセージ認証専用として用いたもの

## 利用例
- SWIFT
  - 国際的な銀行間の送金に利用
- IPSec
  - 通信内容の認証と真正性のチェックに利用
- SSL/TLS
  - 通信内容の認証と真正性のチェックに利用

## 参照
- 暗号技術入門 第3版
