# 暗号化方式
### ストリーム暗号化方式
- 平文をバイト単位で暗号化する
  - 鍵ストリーム(ランダムなデータの無限列)の指定バイトと平文の指定バイトとの排他的論理和を取る
  - 同じ鍵ストリームと暗号文との排他的論理和を求めることによって復号が可能

#### 作り方
1. TLSレコードのシーケンス番号、Recordヘッダ、平文データを結合したもののMACを計算する
2. MACと平文データとを暗号化することで暗号文をつくる

```
                  ----------------------------------
                  | シーケンス番号 | ヘッダ | 平文 |
           -----------------------------------------
           | 平文 |               MAC              |
----------------------------------------------------
|  ヘッダ  |                 暗号文                |
----------------------------------------------------
```

### ブロック暗号化方式
- データの塊(ブロック)をまとめて暗号化する
  - 固定長の平文を入力として受け取り、平文と同じ長さの暗号文を出力する

#### 暗号化利用モード
- ブロック暗号化方式を拡張して任意の長さのデータを暗号化できるようにした処理

#### 作り方
1. TLSレコードのシーケンス番号、Recordヘッダ、平文データを結合したものMACを計算する
2. 暗号化する前のデータの長さが暗号化ブロックの長さの整数倍になるようにパディングを作る(16バイトのブロック長)
3. 暗号化ブロックと同じ長さで、IV(Initialization Vector: 初期化ベクター)を生成する
    - IVにより、同じ平文から異なる暗号文を生成できる
4. 平文データ、MAC、およびパディングをCBCモードで暗号化する
5. IVと暗号文を一緒に送る

```
                      ----------------------------------
                      | シーケンス番号 | ヘッダ | 平文 |
               ------------------------------------------------------
               | 平文 |               MAC              | パディング |
---------------------------------------------------------------------
|  ヘッダ | IV |                        暗号文                      |
---------------------------------------------------------------------
```

### AHEAD
- Authenticated Encryption with Associated Data: 認証付き暗号
- 暗号化および完全性の検証を1つのアルゴリズムにまとめたもの
- nonce(乱数)を使用する

#### 作り方
1. 64ビットのnonceを作る
2. 平文データをAEADのアルゴリズムで暗号化する
    - 完全性を検証するための付加的なデータとしてシーケンス番号とRecordヘッダも暗号化アルゴリズムに渡す
3. nonceと暗号文を一緒に送る

```
                  ---------------------------    --------
                  | シーケンス番号 | ヘッダ |    | 平文 |
---------------------------------------------------------
|  ヘッダ | nonce |                 暗号文              |
---------------------------------------------------------
```

## 参照
- 食べる！SSL！　―HTTPS環境構築から始めるSSL入門
- プロフェッショナルSSL/TLS
