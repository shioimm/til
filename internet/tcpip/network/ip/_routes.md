# ルーティング(経路制御)
- 宛先IPアドレスのホストまでパケットを届けるための仕組み
- IPの経路制御はホップバイホップルーティング(1区間ごとに次のルートが決定される)によって行われる

## ルーター(L3スイッチ)
- ルーティングテーブルに基づきパケットの経路を決定してパケットを中継し、
  ネットワークの負荷を仕切る機器

## ルーティングテーブル(経路制御表)
- ネットワークアドレスと次に配送するべきルーターのアドレスの組みを格納する
  - 一致するネットワークアドレスが複数ある場合、
    一致するビット列が長い方のネットワークアドレスを選択する
- ノードはルーティングテーブルを保持・更新する
- ノードはルーティングテーブルに基づき、データグラムをルーターに向かって送出する
- IPはルーティングテーブルが正しい前提で機能するが、
  実際にルーティングテーブルが正しいかどうかを調べる機能を持たない
  - ルーティングテーブルが正しいかどうかはICMPが調べる

### 静的ルーティング
- 管理者がルーティングテーブルを予め定義する方法

### 動的ルーティング
- ルーター自身が他のルーターと情報を交換してルーティングテーブルを自動的に定義する方法
  - BGP - ネットワークの集合をASとしてまとめ、AS単位で一意なAS番号を振り、経路を制御する
  - AS - 自律システム

### デフォルトルート
- ルーティングテーブルに登録されているどのアドレスにもマッチしない場合に採用される経路
  - `0.0.0.0/0` または `default`で表される
  - デフォルトゲートウェイ - デフォルトルートになっているルーター

### ホストルート
- ルーターがパケットをホストへ転送するための経路
  - ネットワークインターフェースにつけたIPアドレスに基づいて経路制御を行う
  - IPアドレスの全てのルートを使って経路制御を行う
  - `IPアドレス/32` で表される
- Ex. ルーターのローカルルート、ループバックインタフェースのIPアドレス、PPPネイバールート

### リンクローカルアドレス
- ルーターを超えない同一リンク内の通信に利用される経路
  - `169.254/16` で表される
- Ex. 固定IPが設定されていないホストでDHCPによるIPアドレスの取得ができなかった場合に設定されることがある

### ルーティングテーブルの集約
- 複数のサブネットワークから構成されているテーブルを、
  ネットワークアドレスのビットのパターンによって階層的に配置することによって
  ルーティングテーブルを集約することができる
- ノードが管理するルーティングテーブルのサイズを小さくすることにより、
  メモリ空間やCPUパワーを削減しIPの転送能力を向上させる

## 参照
- Linuxプログラミングインターフェース 58章
- Software Design 2021年5月号 ハンズオンTCP/IP
- マスタリングTCP/IP 入門編
