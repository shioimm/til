# IPアドレス
- 終端ノードを示す識別子
- ネットワークインターフェースごとに割り当てられる
  - ホストには1つ以上、ルーターには2つ以上のIPアドレスが割り当てられる
- グローバルIPアドレスはICANNによって全世界的に一元管理される

## IPv4アドレス
- 32ビットサイズ(ドット区切りの10進数)
- `ネットワーク部 . ホスト部 / プレフィックス長`
  - ネットワーク部はデータリンクのセグメントごとに重複しない値が割り当てられる
    - 同じセグメントに接続されているノードのネットワークインターフェースには同じ値が設定される
    - IPパケットが途中のルーターで転送される際は宛先IPアドレスのネットワーク部を利用する
  - ホスト部は同一セグメント内で重ならない値が割り当てられる
- ループバックアドレス - 127.0.0.1

### ネットワーク部とホスト部の区切り方
#### クラスによる区切り(初期のIPで使用)
- Aクラス - 先頭1ビットが0、先頭から8ビットまでがネットワーク部
  - 0.0.0.0 ~ 127.255.255.255.255
- Bクラス - 先頭2ビットが10、先頭から16ビットまでがネットワーク部
  - 128.0.0.0 ~ 191.255.255.255.255
- Cクラス - 先頭3ビットが110、先頭から24ビットまでがネットワーク部
  - 192.0.0.0 ~ 223.255.255.255.255
- Dクラス - 先頭4ビットが1110、先頭から32ビットまでがネットワーク部
  - 224.0.0.0 ~ 239.255.255.255.255

#### CIDR(Classless InterDomain Routing)による区切り
- クラスA・B・Cのネットワークを小さく区切るサブネットワークアドレスを利用する
  - ホスト部をサブネットワークアドレス部として使うことにより複数の物理ネットワークに分割する
  - サブネットマスク - IPアドレスと同じ構造を持つ32ビットの正値
    - ネットワーク部を表すビット数と同じ桁の部分が1
    - ホスト部を表すビット数と同じ桁の部分が0
- プレフィックス長を用いてネットワークIDとホストIDの区切りを示す(CIDR記法)

```
192.0.2.1/24

192.0.2.0     - ネットワーク部
       .1     - ホスト部
          /24 - プレフィックス長
```

## IPv6アドレス
- 128ビットサイズ(コロン区切りの16ビットの16進数)
- 先頭のビットパターンでIPアドレスの種類を区別する
  - IPv6では複数のIPアドレスを一つのネットワークインターフェースに割り当てることができ、
    必要に応じてIPアドレスを使い分ける
- IPv4射影IPv6アドレス - IPv4にのみ対応しているホストと通信する際のIPv4-mappedアドレス

| 種類                               | アドレス  | 用途                                                   |
| -                                  | -         | -                                                      |
| 未定義                             | ::/128    | -                                                      |
| ループバックアドレス               | ::1/128   | ノード自身のアドレス                                   |
| ユニークローカルアドレス           | fc00::/7  | インターネットの通信を行わない場合に利用されるアドレス |
| リンクローカルユニキャストアドレス | fe80::/10 | データリンクの同一リンク内で一意に決まるアドレス       |
| グローバルユニキャストアドレス     | その他全部| -                                                      |

### IPv6が提供する機能
- IPアドレスの拡大とルーティングテーブルの集約
  - IPアドレスの構造をインターネットに適した階層構造にする
  - アドレス構造に適するようにIPアドレスの配布を行い、ルーティングテーブルサイズを小さく保つ
- パフォーマンスの向上
  - ヘッダ長固定・ヘッダチェックサムの削除などヘッダの構造を簡素化
  - 経路MTU探索を行う(IPv6における最小のMTU定義は1280オクテット)
- プラグ&プレイ機能の必須化
  - DHCPサーバーがない場合でもIPアドレスを自動的に割り当てる
- 認証機能・暗号化機能
  - IPアドレスの偽造に対するセキュリティ機能の提供
  - 盗聴防止機能(IPSec)の提供
- マルチキャスト、Mobile IPの機能をIPv6の拡張機能として定義

## ブロードキャストアドレス
- 同一リンクに接続されたすべてのホストにパケットを送信するためのアドレス
- ホスト部のビットを全て1にしたもの

## ローカルブロードキャスト
- 自身が属しているリンク内のブロードキャスト

## ダイレクトブロードキャスト
- 異なるIPネットワークへのブロードキャスト

## マルチキャストアドレス
- 特定のグループに属する全てのホストにパケットを送信するために利用されるクラスDのIPアドレス
- 先頭1110を除くネットワーク部28ビットでマルチキャストの対象となるグループ番号を示す
  - 224.0.0.0 ~ 239.255.255.255(IPv4) / ff00::/8(IPv6)

## 参照
- Linuxプログラミングインターフェース 58章
- Software Design 2021年5月号 ハンズオンTCP/IP
- マスタリングTCP/IP 入門編
