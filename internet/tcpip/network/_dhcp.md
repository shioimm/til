# DHCP
- Dynamic Host Confuguration Protocol
- 動的ホスト設定プロトコル
- TCP/IPのネットワークを使用するために必要な設定作業を自動化する
  - ネットワークインターフェースにIPアドレスを付与する
  - デフォルトルートのルーティングエントリをルーティングテーブルに追加する
  - 名前解決に利用するネームサーバーを指定する

## 要素
- DHCPサーバー - ネットワークの設定を配布するサーバープロセス
  - 予め配布するIPアドレス、サブネットマスク、経路制御、デフォルトルート、DNSサーバーのアドレスなどが設定される
  - デフォルトルートとなるルーターが兼任するケースが多い
- DHCPクライアント - ネットワークの設定を受け取るクライアントプロセス

## 仕組み
1. DHCPクライアントがDHCP発見パケットをブロードキャストする
  - IPアドレスやネットマスクなどのネットワークの設定を要求する
2. DHCPサーバーがDHCP提供パケットを送信する
  - 使用して良いネットワークの設定を通知する
3. DHCPクライアントがDHCP要求パケットをブロードキャストする
  - `2`で通知された設定を使用したいことを通知する
4. DHCPサーバーがDHCP確認応答パケットを送信する
  - `3`の要求に対する許可を通知する
5. IPアドレスが不要になった場合、DHCPクライアントがDHCP解放パケットをブロードキャストする

### IPアドレスの重複の確認
- DHCPサーバーはIPアドレスを配布する前にICMPエコー要求パケットを送信し、
  応答がないことを確認する
- DHCPクライアントはDHCPサーバーから配布されたIPアドレスに対してARP要求パケットを送信し、
  応答がないことを確認する

## DHCPリレーエージェント
- 複数のEthernetセグメントで構築されるネットワークにおいて、
  複数の異なるセグメントのIPアドレスの割り当てを一台のDHCPサーバーで一元管理・運用する仕組み

### 仕組み
1. それぞれのセグメントにDHCPサーバーを置く代わりにDHCPリレーエージェントを設置する
2. 各DHCPリレーエージェントにはDHCPサーバーのIPアドレスを設定する
3. DHCPサーバーにはそれぞれのセグメントごとに配布するIPアドレスの範囲を登録する
4. DHCPリレーエージェントはDHCPクライアントが送信したDHCP要求パケットを受信し、
   ユニキャストパケットにしてDHCPサーバーへ転送する
5. DHCPサーバーはDHCPリレーエージェントから転送されたDHCPパケットを処理し、
   DHCPリレーエージェントへ応答を返す
6. DHCPリレーエージェントはDHCPサーバーから受信した応答をDHCPクライアントへ転送する

## 参照
- Linuxプログラミングインターフェース 58章
- サーバ・インフラエンジニアの基本がこれ一冊でしっかり身につく本 2.8-9
- Linuxで動かしながら学ぶTCP/IPネットワーク入門 4.5
- コンピュータネットワーク
- マスタリングTCP/IP 入門編
