# IP
- 参照: Linuxプログラミングインターフェース 58章
- 参照: Software Design 2021年5月号 ハンズオンTCP/IP

## 特徴
- IPがデータとして扱うIPデータグラムは20-60バイトのヘッダを持ち、
  宛先ホストのアドレスや送信元のアドレスを扱う
- IPはコネクションレスであり信頼性を担保せず、ベストエフォートで通信される
- IPのデータグラムサイズがデータリンク層のMTUよりも大きい場合、
  IPがデータグラムを分割し、サイズを小さくする
  - 分割されたデータグラムはオフセットフィールドに元のデータグラム内での位置を持つ
  - 分割されたデータグラムは宛先のIPによって復元される
  - [TCP]IPフラグメンテーション防止のためホスト間でのMTUを決定し、IPへデータを渡す前に分割しておく
  - [UDP]TCPのような機構が無くIPがデータを分割するためIPフラグメンテーションが発生する可能性がある

## ルーティング
- IPはルーティングテーブルが正しい前提で機能するが、
  ルーティングテーブルが正しいかどうかを調べる機能を持たない
  - 実際にルーティングテーブルが正しいかどうかはICMPが調べる

## 送受信バッファ
- ホストマシン・ルーターはIPパケットを送受信するための送信バッファ・受信バッファを持つ
  IPパケットはホストマシン・ルーターの送受信バッファを介して転送される
- ホストマシン・ルーターの送受信バッファの実体はメモリ
- ホストマシン・ルーターの送受信バッファはキュー構造になっている

### 送受信バッファの利点
- 伝送速度が異なるネットワークに対応できる
- 送信先が異なるパケットが混在できる
- 処理能力が異なるホストに対応できる
- パケットの流量の変動に対応できる

## IPアドレス
- ネットワークID(ホストを接続したネットワーク) + ホストID(ネットワーク上のホスト)

### IPv4アドレス
- 32ビットサイズ(ドット区切りの10進数)
  - ネットワークアドレス - ネットワークID + ホストID
    - プレフィックス長を用いてネットワークIDとホストIDの区切りを示す(CIDR記法)
    - Ex. `192.0.2.1/24`の場合は`192.0.0.0`がネットワークID、`.1`がホストID、`/24`がプレフィックス長
  - ネットワークマスク - ネットワークID部: すべて1 + ホストID部: すべて0
  - サブネット化 - ホストIDをサブネットIDとホストIDへ分割する
    - 拡張ネットワークID - ネットワークID + サブネットID
    - サブネットマスク - 拡張ネットワークID部：すべて1 + ホストID部: すべて
- ループバックアドレス - 127.0.0.1
- IPv4ワイルドカード - 0.0.0.0
  - 自ホストの全てのIPアドレス宛のUDPデータグラム・TCP接続要求を処理する

### IPv6アドレス
- 128ビットサイズ(コロン区切りの16ビットの16進数)
  - 先頭数ビットはフォーマットプレフィックスを用いてアドレス種類を示す
- ループバックアドレス - ::1
- IPv6ワイルドカード - 0::0
- IPv4射影IPv6アドレス - IPv4にのみ対応しているホストと通信する際のIPv4-mappedアドレス
