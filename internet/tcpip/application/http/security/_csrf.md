# クロスサイトリクエストフォージェリ(CSRF)
- ユーザーに意図しない操作を強制させる
  1. ユーザーの意図しないサーバーリクエストを送信させる
  2. ブラウザは誘導されたページに対してもCookieを発行する
  3. ユーザーのログイン状態は維持されたままの状態であるため、
     以降ユーザーの権限で任意の操作を実行させることができる

#### 発生箇所
- Cookieのみでセッション管理が行われているサイト・HTTP認証、
  TLSクライアント証明書のみで利用者の識別が行われているサイト

#### 影響範囲
- CSRF脆弱性のあるページ

#### 影響の種類
- 被害者の権限で重要な処理を実行させられる

#### 原因
- HTMLの仕様を悪用
  - form要素のaction属性にはどのドメインのURLでも指定できる
  - Cookieに保管されたセッショントークンは対象サイトに自動的に送信される

#### 対策
- フォームを設定する際に隠しフィールドにランダムな値のトークンを埋め込んでおき、
  POSTリクエストが送信された際にサーバー側で正規ユーザーの送ったトークンであることを検証する
- Cookieに`SameSite`属性を付与する(リクエストを送信するページが同一サイトにある場合のみCookieを送信する)

## 参照
- 安全なWebアプリケーションの作り方(脆弱性が生まれる原理と対策の実践)
- Real World HTTP 第2版
