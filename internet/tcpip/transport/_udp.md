# UDP
- 参照: Linuxプログラミングインターフェース 58章
- 参照: Software Design 2021年5月号 ハンズオンTCP/IP

## 特徴
- IPの性質を引き継ぎ、信頼性のないデータグラム型の通信サービスを提供する
- パケットは損失する可能性がある
- パケットに含まれるデータが破損していないことを保証する機能を提供する
- IPにポート番号・データチェックサムを追加し、送信データのエラー検出を可能にする
- 送信するデータグラムのサイズを576バイトのIPv4最小再構成バッファサイズよりも小さくすることで
  IPフラグメンテーションを回避する
- UDPヘッダ(8バイト) + IPヘッダ(20バイト以上) + データグラム本体(残りバイト)
- 参照: Software Design 2021年5月号 ハンズオンTCP/IP

## UDPによるソケットプログラミングの流れ
### サーバー
1. ソケットの作成(`socket(2)`)
2. 接続を待つIPアドレスとポート番号を設定
3. ソケットに名前をつける(`bind(2)`)
4. 受信する(`recv(2)` / `recvfrom(2)`)
5. ソケットを閉じる(`close(2)`)

### クライアント
1. ソケットの作成(`socket(2)`)
2. 接続する相手のIPアドレスとポート番号を設定
3. 送信する(`send(2)` / `sendto(2)` / `sendfrom(2)`)
4. ソケットを閉じる(`close(2)`)

## 送信バッファ
- UDPはホスト・ルーターの送受信バッファを使った送受信管理を行わない
- 送信操作を行うと送信が実行される
- 受信側には受信バッファがあるが、空き容量を相手に伝える機能はない

## UDPを使用するアプリケーション

| 名称 | 用途             | UDPを使用する理由                                         |
| -    | -                | -                                                         |
| DHCP | IPアドレスの設定 | ブロードキャストを使用する                                |
| NTP  | 時刻同期         | TCPではバッファ機能により時刻を正確に合わせられないため 　|
| QUIC | HTTP/3           | TCPのコネクション管理と再送処理における課題を解決するため |
| RTP  | IP電話           | 双方向でのリアルタイム通信では再送処理は悪影響なため      |

- HTTP/3はWebの通信を高速効率化する
  - TCPと同等の輻輳制御を行った上でより効率の良いコネクション管理・再送処理・暗号化を行う

## IPマルチキャスト
- 特定の宛先ではなくグループを指すIPアドレスへの通信
  - 送信者はマルチキャストグループに対してパケットの送信を行う
  - 受信者はマルチキャストグループに参加するとマルチキャストパケットを受信する

```c
#include <netinet/in.h>

// マルチキャストグループ
struct group_req {
  uint32_t                gr_interface;
  struct sockaddr_storage gr_group;
};
```
