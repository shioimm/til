# QUICの通信
- コネクション単位で管理され、各QUICコネクションはコネクションIDで識別される
  - クライアント・サーバーがそれぞれ送信元コネクションIDと送信先コネクションIDを持つ
- QUICのデータはUDPパケットに格納され、QUICパケットとして送信される
  - 1つのUDPパケットは複数のQUICパケットを持つ場合がある
  - 1つのQUICパケットが複数のUDP パケットにまたがることはない

## QUICパケット
- ヘッダ(コネクションID、パケット番号etc) + ペイロード(QUICフレーム)

### ロングヘッダパケット
- QUICコネクション確立時に使用
- QUICのバージョンを格納
- 送信元コネクションID・送信先コネクションIDを格納
  - QUICコネクション確立時のハンドシェイク中に双方のコネクションIDを示し合う
  - サーバーは受信したパケットに対して応答する際、パケットの送信元コネクションIDを送信先コネクションIDに設定してデータを返送する

#### 種類
- Initial - ハンドシェイク時にクライアントから最初に送信される
- 0-RTT - 0-RTTハンドシェイク時に使用される
- Handshake - ハンドシェイク時にInitialの次のパケットとして送信される
- Retry - ハンドシェイクをやりなおすときに送信される

### ショートヘッダパケット
- QUICコネクション確立後に使用
- スピンビットと暗号鍵のフェーズを格納
- 送信先コネクションIDを格納

#### 種類
- 1-RTT

## QUICフレーム
| タイプ名               | タイプ値    | 説明                                                           |
| -                      | -           | -                                                              |
| `PADDING`              | 0x00        | QUICパケットのサイズの調整用                                   |
| `PING`                 | 0x01        | 疎通確認用                                                     |
| `ACK`                  | 0x02 / 0x03 | 確認応答 / 輻輳状況の通知                                      |
| `RESET_STREAM`         | 0x04        | ストリームの終了                                               |
| `CRYPTO`               | 0x06        | 暗号ハンドシェイク用のデータ送信                               |
| `NEW_TOKEN`            | 0x07        | 再接続が必要な場合のハンドシェイク用のトークン送信             |
| `STREAM`               | 0x08 ~ 0x0f | ストリーム作成、ストリームデータ(アプリケーションデータ)送信   |
| `NEW_CONNECTION_ID`    | 0x18        | 通信中にコネクションIDを変更する際の新しいコネクションIDを通知 |
| `RETIRE_CONNECTION_ID` | 0x19        | `NEW_CONNECTION_ID`発行されたコネクションIDを使用しない通知    |
| `PATH_CHALLENGE`       | 0x1a        | コネクションマイグレーションにおいて新しい通信経路が有効性確認 |
| `PATH_RESPONSE`        | 0x1b        | コネクションマイグレーションにおいて`PATH_CHALLENGE`への応答   |
| `CONNECTION_CLOSE`     | 0x1c / 0x1d | コネクションのクローズ                                         |
| `HANDSHAKE_DONE`       | 0x1e        | ハンドシェイクの完了通知                                       |

## 参照
- WEB+DB PRESS Vol.123 HTTP/3入門
