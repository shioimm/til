# TCP/IPプロトコルスイート
- 参照: Linuxプログラミングインターフェース 58章

## TL;DR
- 現在主流のインターネットワークプロトコル
- 「インターネット」はTCP/IPのインターネットワーク

## レイヤ

| プロトコル       | 階層               | 送信データ             | メモリ領域   |
| -                | -                  | -                      | -            |
| アプリケーション | アプリケーション層 | アプリケーションデータ | ユーザー空間 |
| TCP / UDP        | トランスポート層   | TCPセグメント          | カーネル空間 |
| IP               | ネットワーク層     | IPデータグラム         | カーネル空間 |
| ハードウェア     | データリンク層     | データフレーム         | ハードウェア |

- トランスポート層 - アプリケーション層間の通信を
  `SOCK_STREAM` / `SOCK_DGRAM`によって行う

## データリンク層
- ネットワークの物理リンク上へフレームを送信し、宛先からの確認応答を受信する
  - ネットワーク層からのデータグラムをフレーム単位にカプセル化して送受信する
- 送信時には各フレームの宛先アドレス・フレームサイズをヘッダとして付加する
  - フレームサイズ上限をMIU(最大転送ユニット)という

## ネットワーク層
- 送信元ホストから宛先ホストへパケットを送信する
  - インターネットワーク上の宛先を決定する
  - トランスポート層へ機能を提供する
- IPがデータとして扱うIPデータグラムは20-60バイトのヘッダを持ち、
  宛先ホストのアドレスや送信元のアドレスを扱う
- IPはコネクションレスであり信頼性がない
- IPのデータグラムサイズがデータリンク層のMIUよりも大きい場合、
  IPがデータグラムを分割し、サイズを小さくする
  - 分割されたデータグラムはオフセットフィールドに元のデータグラム内での位置を持つ
  - 分割されたデータグラムは宛先のIPによって復元される
  - [TCP]IPフラグメンテーション防止のためホスト間でのMIUを決定し、IPへデータを渡す前に分割しておく
  - [UDP]TCPのような機構が無くIPがデータを分割するためIPフラグメンテーションが発生する可能性がある

### IPアドレス
- ネットワークID(ホストを接続したネットワーク) + ホストID(ネットワーク上のホスト)

#### IPv4アドレス
- 32ビットサイズ(ドット区切りの10進数)
  - ネットワークアドレス - ネットワークID + ホストID
  - ネットワークマスク - ネットワークID部: すべて1 + ホストID部: すべて0
  - サブネット化 - ホストIDをサブネットIDとホストIDへ分割する
    - 拡張ネットワークID - ネットワークID + サブネットID
    - サブネットマスク - 拡張ネットワークID部：すべて1 + ホストID部: すべて
- ループバックアドレス - 127.0.0.1
- IPv4ワイルドカード - 0.0.0.0
  - 自ホストの全てのIPアドレス宛のUDPデータグラム・TCP接続要求を処理する

#### IPv6アドレス
- 128ビットサイズ(コロン区切りの16ビットの16進数)
  - 先頭数ビットはフォーマットプレフィックスを用いてアドレス種類を示す
- ループバックアドレス - ::1
- IPv6ワイルドカード - 0::0
- IPv4射影IPv6アドレス - IPv4にのみ対応しているホストと通信する際のIPv4-mappedアドレス
