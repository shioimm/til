# DNS
- 参照: DNSをはじめよう ～基礎からトラブルシューティングまで～ 改訂第2版

## DNSの仕組み
1. クライアントがドメインにアクセスを試行する
2. フルリゾルバがルートネームサーバーにリソースレコードを問い合わせる
    - ルートネームサーバーにリソースレコードが存在しない場合は
      ルートネームサーバー以下にゾーンを持つ各ネームサーバーに問い合わせる
3. ネームサーバーがフルリゾルバにIPアドレスを返す
4. フルリゾルバがクライアントにIPアドレスを返す

### リソースレコード
- ドメイン名とIPアドレスの紐付け
  - Aレコード  - ドメイン名に紐づくIPアドレス
  - NSレコード - ドメイン名のゾーンを管理するネームサーバー
  - MXレコード - ドメイン名に紐づくメール受信サーバー
  - TXT        - このドメイン名のメール送信元サーバー
  - SOA        - ドメイン名のゾーンの管理情報
  - GNAME      - このドメイン名の別名でリソースレコードの参照先

### ネームサーバー(DNSコンテンツサーバ / 権威DNSサーバー)
- リソースレコードを管理する
- ゾーン
  - 各ネームサーバーが受け持つドメインの範囲
- 委任
  - 各ネームサーバーが受け持つゾーンのうちその一部を他のネームサーバーに任せること
  - ゾーンを委任されたネームサーバーはそのドメインについて権威を持つ
    - サブドメインを作ったり
      受け持つゾーンのうちその一部を更に他のネームサーバーに委任することができる

### フルリゾルバ(DNSキャッシュサーバー / フルサービスリゾルバ)
- リソースレコードをネームサーバーに問い合わせる
- 問い合わせ結果はキャッシュで保存される
- クライアントが使用するフルリゾルバはISPなどによって設定される
- サーバーが使用するフルリゾルバは`/etc/resolver.conf`にて設定される(Linuxの場合)
- TTL - 名前解決のキャッシュ保持時間
  - DNSを切り替えた後、TTLが切れると切り替えが成立する -> DNSが浸透する

## ドメイン
### ドメイン名の構造
```
example.co.jp

左からラベルによって区切られている

名前空間     -> jp / co
ドメイン     -> jp
サブドメイン -> co.jp(jpのサブドメイン)
                example.co.jp(jpのサブドメイン)
                example.co.jp(cojpのサブドメイン)

ラベル       -> jp / co / example
ドメイン名   -> ラベルを'.'でつないだもの
```

### FQDN(Fully Qualified Domain Name)
- 完全修飾ドメイン名
  - ドメイン名(`example.co.jp`) + ホスト名(`www`)
    - ドメイン - インターネット上の個別のネットワーク
    - ホスト   - ドメインの中の個別のコンピュータ

### ドメイン売買
- 一般ユーザーはリセラやレジストラを仲介してレジストリとドメイン名登録契約を結ぶ

#### ドメイン売買事業者
- ICANN
  - TLD(トップレベルドメイン)を策定する
  - TLDを管理するレジストリを承認する
  - ルートネームサーバーを管理する
- レジストリ(登録管理組織)
  -TLDを管理する
    - 一つのTLDにつき一つのレジストリが管理する
    - `.jp` `.com` `.net` `.org` etc
  - ドメイン名をレジストラに卸す
- レジストラ(登録事業者)
  - ドメイン名をリセラに卸す
  - ドメイン名を一般ユーザーに販売する
- リセラ(再販事業者)
  - ドメイン名を一般ユーザーに販売する

#### Whois
- ドメインを所有している組織・担当者名・連絡先・有効期限
- レジストリが管理・公開を行う
- 最低一年に一回は更新を行う

## 事例
### サイト移管時の確認・変更点
1. ドメイン名の管理者
2. ドメイン名のレジストラ(リセラ)
3. ネームサーバー
4. webサーバー
