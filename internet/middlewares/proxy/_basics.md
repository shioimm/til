# プロキシ
- HTTP通信を中継するサーバー
- パフォーマンス向上とセキュリティ向上のために利用される
- フォワードプロキシ - システムから外部へアクセスする際に経由する
- リバースプロキシ - 外部からシステムへアクセスする際に経由する

## フォワードプロキシ

```
サーバー -> フォワードプロキシ -> インターネット -> 外部システム
```

### 用途
- 内部ネットワークから外部ネットワークにアクセスする際、
  接続元にとって好ましくない接続先への接続を制限する
- Webシステムが外部システムにアクセスする際、
  外部システムからのレスポンスを一定期間キャッシュし、
  同じAPIを何度も叩かずに済むようにする

## リバースプロキシ

```
利用者 -> インターネット -> リバースプロキシ -> サーバー
```

### 用途
- 参照: [リバースプロキシ（Reverse Proxy）](https://www.atmarkit.co.jp/ait/articles/1608/25/news034.html)

- サーバーに対するアクセスの流量制限やリクエストの検査を行う
- 負荷分散によるスループット向上(ロードバランサー)
- DoS / DDoSをサーバーに代わって被弾する(CDN)
- キャッシュや圧縮による高速化・スループット向上(CDN)
- TLSの終端(アプリケーションデータを復号化)
- SSLの集中管理

## Forwardedヘッダ
- [Forwarded](https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Forwarded)
- リクエストパスにプロキシが含まれている場合に変更、または失われたプロキシサーバーのクライアント側の情報
  - X-Forwarded-For、X-Forwarded-Host、X-Forwarded-Proto

```
Forwarded: by=<identifier>;    # リクエストがプロキシサーバーに入ってきたインターフェイス
           for=<identifier>;   # リクエストを発行したクライアントと、その後のプロキシチェーン内のプロキシ
           host=<host>;        # プロキシから受信したときのHostリクエストヘッダ
           proto=<http|https>  # リクエスト作成時に使用されたプロトコル

# identifier - 変更または失われた情報を公開する識別子(IPアドレス、難読化された識別子、etc)
```

## 参照
- よくわかるHTTP/2の教科書P26-27
- サーバ・インフラエンジニアの基本がこれ一冊でしっかり身につく本 5
- Real World HTTP 第2版
